<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POSPal</title>
    <script src="./static/vendor/tailwindcdn.js"></script>
    <link rel="stylesheet" href="./static/css/fonts.css">
    <link rel="stylesheet" href="./static/vendor/fontawesome/css/all.min.css">
    <link rel="stylesheet" href="/assets/desktop-support.css">
    <style>
        body {
            font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', sans-serif;
        }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-thumb { background-color: #6b7280; border-radius: 3px; }
        ::-webkit-scrollbar-track { background: transparent; }
        .product-card h3 { display: -webkit-box; -webkit-box-orient: vertical; -webkit-line-clamp: 2; line-clamp: 2; overflow: hidden; text-overflow: ellipsis; min-height: 2.5em; }
        .options-badge { font-weight: 500; color: white; border-radius: 3px; white-space: nowrap; background-color: #4b5563; }
        .option-pill { display: inline-flex; align-items: center; background-color: #4b5563; color: white; padding: 0.4rem 0.8rem; border-radius: 16px; font-size: 0.9em; line-height: 1; }
        .option-pill .remove-option-btn { background: none; border: none; color: white; margin-left: 0.6rem; cursor: pointer; font-size: 1.2em; padding: 0; line-height: 0.5; font-weight: bold; }
        .option-pill .remove-option-btn:hover { color: #d1d5db; }
        .order-item.selected-for-numpad { background-color: #e5e7eb; border-left: 3px solid #374151; }
        input:focus, select:focus, textarea:focus { border-color: #111827; box-shadow: 0 0 0 2px #9ca3af; outline: none; }
        .management-form input:focus, .management-form select:focus, .management-form textarea:focus { border-color: #111827; box-shadow: 0 0 0 2px #9ca3af; }
        .btn-primary { background-color: #111827; color: white; }
        .btn-primary:hover { background-color: #1f2937; }
        .btn-primary:disabled { background-color: #6b7280; cursor: not-allowed; }
        .btn-secondary { background-color: #e5e7eb; color: #1f2937; border: 1px solid #d1d5db; }
        .btn-secondary:hover { background-color: #d1d5db; }
        .btn-danger { background-color: #ef4444; color: white; }
        .btn-danger:hover { background-color: #dc2626; }
        .btn-warning { background-color: #f59e0b; color: white; }
        .btn-warning:hover { background-color: #d97706; }
        .btn-success { background-color: #16a34a; color: white; }
        .btn-success:hover { background-color: #15803d; }
        .management-tab-container { position: relative; z-index: 10; }
        .management-content { position: relative; z-index: 1; }
        .option-selectable.selected { border-color: #111827 !important; background-color: #f3f4f6; }
        .date-range-btn.active { background-color: #111827; color: white; font-weight: 600; }
        .copy-btn { background-color: #d1d5db; color: #1f2937; border: 1px solid #9ca3af; padding: 0.25rem 0.75rem; border-radius: 0.375rem; font-size: 0.875rem; cursor: pointer; transition: background-color 0.2s; }
        .copy-btn:hover { background-color: #9ca3af; }
        .gradient-bg { background: linear-gradient(135deg, #111827 0%, #1f2937 100%); }
        
        /* Enhanced License Validation UI Components */
        .license-status-message { font-size: 0.95rem; line-height: 1.5; margin-bottom: 0.5rem; }
        .progressive-warning { animation: warningPulse 2s ease-in-out infinite; }
        @keyframes warningPulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.85; } }
        .connectivity-status { transition: all 0.3s ease; backdrop-filter: blur(4px); }
        .connectivity-status:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.15); }
        .trial-mode-indicator { animation: trialBlink 3s ease-in-out infinite; }
        @keyframes trialBlink { 0%, 85%, 100% { opacity: 1; } 90%, 95% { opacity: 0.7; } }
        .warning-notification { animation: slideInDown 0.4s ease-out; }
        @keyframes slideInDown { from { transform: translate(-50%, -100%); opacity: 0; } to { transform: translate(-50%, 0); opacity: 1; } }
        .offline-grace-progress { background: linear-gradient(90deg, #f59e0b 0%, #d97706 50%, #dc2626 100%); }
        .license-badge-active { background: linear-gradient(45deg, #10b981, #047857) !important; animation: successGlow 2s ease-in-out; }
        @keyframes successGlow { 0%, 100% { box-shadow: 0 0 5px rgba(16, 185, 129, 0.3); } 50% { box-shadow: 0 0 20px rgba(16, 185, 129, 0.6); } }
        .connection-help-modal { backdrop-filter: blur(8px); }
        .status-indicator-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .7; } }

        /* Settings gear status halo + label */
        .settings-gear {
            position: relative;
            isolation: isolate;
        }
        .settings-gear::after {
            content: '';
            position: absolute;
            inset: -8px;
            border-radius: 9999px;
            background: var(--gear-halo, transparent);
            opacity: 0.9;
            z-index: -1;
            transition: background 0.25s ease, opacity 0.25s ease;
        }
        .settings-gear.status-live    { --gear-halo: rgba(16,185,129,0.35); }
        .settings-gear.status-polling { --gear-halo: rgba(245,158,11,0.45); }
        .settings-gear.status-offline { --gear-halo: rgba(239,68,68,0.45); }
        .settings-gear.status-checking{ --gear-halo: rgba(148,163,184,0.4); }

        .gear-status-label {
            display: none;
            margin-top: 0.5rem;
            padding: 4px 10px;
            border-radius: 9999px;
            font-size: 12px;
            font-weight: 600;
            color: #ffffff;
            align-self: center;
            background: #4b5563;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            text-align: center;
            min-width: 7rem;
            letter-spacing: 0.02em;
        }
        .gear-status-label.status-polling { background:#92400e; }
        .gear-status-label.status-offline { background:#7f1d1d; }
        .gear-status-label.status-checking { background:#475569; }
        .gear-status-label.active { display: inline-flex; justify-content: center; }

        /* ==================================================================================
           TABLE MANAGEMENT MODE SWITCHING CSS
           ================================================================================== */

        /* Default: Hide table features */
        .table-mode-only { display: none !important; }
        .simple-mode-only { display: block; }

        /* Show table features when enabled */
        body.table-mode .table-mode-only { display: block !important; }
        body.table-mode .simple-mode-only { display: none !important; }

        /* Table selection enhancement */
        body.table-mode #header-table-container {
            background: linear-gradient(135deg, #374151 0%, #1f2937 100%);
            transition: all 0.3s ease;
            position: relative;
        }

        body.table-mode #header-table-container:hover {
            background: linear-gradient(135deg, #4b5563 0%, #374151 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        body.table-mode #header-table-container::after {
            content: 'üìã';
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 14px;
            opacity: 0.7;
        }

        /* Table grid styles */
        .table-card {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .table-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .table-card.available {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border-color: #10b981;
        }

        .table-card.occupied {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border-color: #ef4444;
            animation: tablePulse 3s ease-in-out infinite;
        }

        /* Offline interruption modal */
        #offlineInterruptionModal { display: none; }

        .offline-interruption-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.75);
            backdrop-filter: blur(6px);
            z-index: 120;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem 1rem;
        }

        .offline-interruption-card {
            background: #ffffff;
            border-radius: 18px;
            box-shadow: 0 25px 70px rgba(15, 23, 42, 0.25);
            width: min(640px, 100%);
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }

        .offline-interruption-header {
            padding: 1.75rem;
            border-bottom: 1px solid rgba(226, 232, 240, 0.6);
            background: linear-gradient(135deg, rgba(30, 64, 175, 0.1), rgba(30, 64, 175, 0));
        }

        .offline-interruption-icon {
            width: 56px;
            height: 56px;
            border-radius: 16px;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(37, 99, 235, 0.05));
            color: #1d4ed8;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .offline-interruption-body {
            padding: 1.75rem;
            overflow-y: auto;
        }

        .offline-interruption-body section {
            background: #f8fafc;
            border-radius: 14px;
            padding: 1.25rem 1.5rem;
            border: 1px solid rgba(226, 232, 240, 0.9);
        }

        .offline-interruption-body section:nth-child(2) {
            background: #fff7ed;
            border-color: rgba(251, 191, 36, 0.4);
        }

        .offline-interruption-actions {
            padding: 1.5rem 1.75rem;
            border-top: 1px solid rgba(226, 232, 240, 0.6);
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            align-items: center;
            justify-content: space-between;
            background: #f8fafc;
            border-bottom-left-radius: 18px;
            border-bottom-right-radius: 18px;
        }

        .offline-interruption-actions .action-primary {
            background: #1d4ed8;
            color: white;
            padding: 0.75rem 1.25rem;
            border-radius: 10px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .offline-interruption-actions .action-secondary {
            color: #1d4ed8;
            font-weight: 500;
            text-decoration: underline;
            cursor: pointer;
        }

        .offline-interruption-actions .action-muted {
            color: #475569;
            font-size: 0.85rem;
        }

        .offline-status-strip {
            position: fixed;
            bottom: 12px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(15, 23, 42, 0.92);
            color: #f8fafc;
            border-radius: 9999px;
            padding: 0.6rem 1.1rem;
            display: none;
            align-items: center;
            gap: 0.85rem;
            font-size: 0.9rem;
            box-shadow: 0 18px 40px rgba(15, 23, 42, 0.35);
            z-index: 110;
        }

        .offline-status-strip.offline-visible { display: inline-flex; }

        .offline-status-strip .badge {
            background: rgba(248, 113, 113, 0.25);
            padding: 0.15rem 0.6rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .offline-status-strip .retry-btn {
            background: rgba(248, 250, 252, 0.15);
            border: 1px solid rgba(248, 250, 252, 0.25);
            color: #e2e8f0;
            padding: 0.35rem 0.9rem;
            border-radius: 9999px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.4rem;
            transition: all 0.2s ease;
        }

        .offline-status-strip .retry-btn:hover {
            background: rgba(248, 250, 252, 0.25);
        }

        .offline-status-strip .help-link {
            color: rgba(226, 232, 240, 0.8);
            font-size: 0.75rem;
            text-decoration: underline;
            cursor: pointer;
        }

        @keyframes tablePulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.9; }
        }

        /* Table status indicators */
        .table-status-indicator {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            border: 2px solid white;
        }

        .table-status-indicator.available {
            background-color: #10b981;
        }

        .table-status-indicator.occupied {
            background-color: #ef4444;
            animation: statusBlink 2s ease-in-out infinite;
        }

        @keyframes statusBlink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Mobile responsive table grid */
        @media (max-width: 640px) {
            .table-card {
                min-height: 100px;
                display: flex;
                align-items: center;
                justify-content: center;
            }

            .table-card .text-2xl {
                font-size: 1.5rem;
            }
        }

        /* Enhanced mobile table navigation */
        body.table-mode #mobile-order-toggle::after {
            content: 'üçΩÔ∏è';
            position: absolute;
            top: -2px;
            right: -2px;
            font-size: 12px;
            background: #f97316;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Simple mode indicators */
        body.simple-mode #header-table-container {
            background: #4b5563;
        }

        /* Table management modal animations */
        .table-modal-enter {
            animation: tableModalSlideIn 0.3s ease-out;
        }

        @keyframes tableModalSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-10px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        /* Loading states for table data */
        .table-loading {
            position: relative;
            overflow: hidden;
        }

        .table-loading::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            animation: tableShimmer 1.5s infinite;
        }

        @keyframes tableShimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* Table filter buttons */
        .table-filter-btn {
            background-color: #f3f4f6;
            color: #6b7280;
            border: 1px solid #d1d5db;
            transition: all 0.2s ease;
        }
        .table-filter-btn:hover {
            background-color: #e5e7eb;
            color: #374151;
        }
        .table-filter-btn.active {
            background-color: #111827;
            color: white;
            border-color: #111827;
        }

        /* Table status badges */
        .table-status-available {
            background-color: #d1fae5;
            color: #065f46;
            border-color: #6ee7b7;
        }
        .table-status-occupied {
            background-color: #fef3c7;
            color: #92400e;
            border-color: #fbbf24;
        }
        .table-status-paid {
            background-color: #fee2e2;
            color: #991b1b;
            border-color: #fca5a5;
        }

        /* Accessibility improvements */
        .table-card:focus {
            outline: 3px solid #3b82f6;
            outline-offset: 2px;
        }

        body.table-mode #header-table-input:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
        }

        /* Dark mode support for table features */
        @media (prefers-color-scheme: dark) {
            .table-card.available {
                background: linear-gradient(135deg, #064e3b 0%, #065f46 100%);
                color: #d1fae5;
            }

            .table-card.occupied {
                background: linear-gradient(135deg, #7f1d1d 0%, #991b1b 100%);
                color: #fee2e2;
            }
        }

        /* Responsive layout adjustments */
        body.table-mode #main-content {
            padding-bottom: 4rem; /* Account for mobile navigation */
        }

        body.simple-mode #main-content {
            padding-bottom: 7rem; /* Account for floating button */
        }

        @media (min-width: 768px) {
            body.table-mode #main-content,
            body.simple-mode #main-content {
                padding-bottom: 1rem; /* Reset on desktop */
            }
        }

        /* Mobile table mode specific adjustments */
        @media (max-width: 767px) {
            body.table-mode #mobile-table-nav {
                display: block;
            }

            body.table-mode #mobile-order-toggle {
                display: none;
            }
        }

        /* Active mobile tab styling */
        .mobile-tab-active {
            background-color: #f3f4f6 !important;
            color: #111827 !important;
            font-weight: 600 !important;
        }

        /* ==================================================================================
           MOBILE TABLE SELECTION - HEADER BADGE & BOTTOM SHEET
           ================================================================================== */

        /* Header Badge for Table Selection */
        #mobileTableBadge {
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 200px;
            max-width: 250px;
        }

        #mobileTableBadge:active {
            transform: scale(0.97);
        }

        #mobileTableBadge.no-selection {
            background: linear-gradient(135deg, #4b5563 0%, #374151 100%);
            border: 2px solid #6b7280;
        }

        #mobileTableBadge.table-selected {
            background: linear-gradient(135deg, #374151 0%, #1f2937 100%);
            border: 2px solid #4b5563;
        }

        #mobileTableBadge.takeaway-selected {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border: 2px solid #1d4ed8;
        }

        /* Bottom Sheet Overlay */
        #tablePickerOverlay {
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        #tablePickerOverlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        /* Bottom Sheet */
        #tablePickerSheet {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            border-radius: 1.5rem 1.5rem 0 0;
            max-height: 70vh;
            z-index: 1000;
            transform: translateY(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.15);
            display: flex;
            flex-direction: column;
        }

        #tablePickerSheet.active {
            transform: translateY(0);
        }

        /* Sheet Handle */
        .sheet-handle {
            width: 48px;
            height: 4px;
            background-color: #d1d5db;
            border-radius: 2px;
            margin: 0.75rem auto 0.5rem;
        }

        /* Table Card in Sheet */
        .table-picker-card {
            border: 2px solid #e5e7eb;
            border-radius: 0.75rem;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            min-height: 120px;
            justify-content: center;
        }

        .table-picker-card:active {
            transform: scale(0.95);
        }

        .table-picker-card.available {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border-color: #10b981;
        }

        .table-picker-card.occupied {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border-color: #ef4444;
        }

        .table-picker-card.takeaway {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border-color: #3b82f6;
        }

        .table-picker-card.selected {
            border-width: 3px;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
            font-weight: 600;
        }

        .table-picker-card .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 0.375rem;
            border: 2px solid white;
        }

        .table-picker-card .status-dot.available {
            background-color: #10b981;
        }

        .table-picker-card .status-dot.occupied {
            background-color: #ef4444;
            animation: mobileDotBlink 2s ease-in-out infinite;
        }

        @keyframes mobileDotBlink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Slide up animation */
        @keyframes slideUp {
            from {
                transform: translateY(100%);
            }
            to {
                transform: translateY(0);
            }
        }

        .animate-slide-up {
            animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Payment Method Modal Styles */
        .payment-method-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
            border: 2px solid #d1d5db;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
            cursor: pointer;
            background: white;
        }

        .payment-method-btn:hover {
            border-color: #6b7280;
            background-color: #f9fafb;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .payment-method-btn.selected-payment {
            border-color: #10b981 !important;
            background-color: #d1fae5 !important;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .payment-method-btn:active {
            transform: translateY(0);
        }

    </style>
</head>
<body class="bg-white text-gray-800">

    <div id="main-content"> 
        <header class="bg-gray-900 text-white shadow-lg sticky top-0 z-40">
            <div class="container mx-auto px-4 py-3 flex justify-between items-center">
                <div class="flex items-center">
                    <h1 class="text-2xl font-bold tracking-wider">POS<span class="text-green-400">Pal</span></h1>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-right">
                        <div class="text-xs text-gray-400"><span data-i18n="ui.order.headerNumber">Order #</span><span id="header-order-number" class="font-semibold">...</span></div>

                        <!-- Simple Mode: Classic Table Input -->
                        <div id="header-table-container" class="simple-mode-only mt-1 flex items-center space-x-2 bg-gray-700 hover:bg-gray-600 transition-colors px-3 py-1 rounded-md">
                            <label for="header-table-input" class="cursor-pointer">
                                <i class="fas fa-chair text-white"></i>
                            </label>
                            <input type="text" id="header-table-input" class="bg-transparent text-white font-semibold w-24 focus:outline-none placeholder-gray-400" data-i18n-attr='{"placeholder":"ui.table.placeholder"}' placeholder="Table #">
                        </div>

                        <!-- Table Mode: Selection Badge -->
                        <div id="mobileTableBadge" class="table-mode-only no-selection mt-1 px-4 py-2 rounded-lg text-white text-sm font-semibold" onclick="openMobileTablePicker()">
                            <div id="mobileTableBadgeContent" class="flex items-center justify-center gap-2">
                                <i class="fas fa-utensils"></i>
                                <span>Tap to Select Table</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Table Status Panel (Table Mode Only) -->
        <section id="table-status-panel" class="table-mode-only py-2 bg-gradient-to-r from-gray-800 to-gray-900 text-white sticky top-[68px] z-35 border-b border-gray-600">
            <div class="container mx-auto px-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="text-sm">
                            <span class="text-gray-300">Tables:</span>
                            <span id="tableStatusSummary" class="font-semibold">Loading...</span>
                        </div>
                        <button onclick="showTableSelectionModal()" class="text-xs bg-blue-600 hover:bg-blue-700 px-2 py-1 rounded transition-colors">
                            <i class="fas fa-th-large mr-1"></i>View All
                        </button>
                    </div>
                    <div class="text-xs text-gray-300">
                        <i class="fas fa-circle text-green-400 mr-1"></i>Available
                        <i class="fas fa-circle text-red-400 ml-3 mr-1"></i>Occupied
                    </div>
                </div>
            </div>
        </section>

        <section id="category-section" class="py-3 bg-white border-b border-gray-300 sticky z-30" style="top: 68px;">
            <style>
                body.table-mode #category-section { top: 106px !important; }
            </style> <div class="container mx-auto px-4">
                <div id="categories" class="flex space-x-2 overflow-x-auto pb-2"> <p class="text-gray-500 italic">Loading categories...</p>
                </div>
            </div>
        </section>

        <section id="product-section" class="py-4 bg-gray-50">
            <div class="container mx-auto px-4">
                <div id="products" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3">
                    <p class="text-gray-500 italic col-span-full text-center">Select a category to see items.</p>
                </div>
            </div>
        </section>
    </div>

    <!-- Mobile Navigation (Table Mode) -->
    <div id="mobile-table-nav" class="table-mode-only fixed bottom-0 left-0 right-0 bg-white border-t border-gray-300 z-50 md:hidden">
        <div class="grid grid-cols-3 h-16">
            <button onclick="switchToMenuTab()" class="flex flex-col items-center justify-center text-gray-600 hover:text-black hover:bg-gray-50 transition-colors" id="menuTabBtn">
                <i class="fas fa-utensils text-lg mb-1"></i>
                <span class="text-xs">Menu</span>
            </button>
            <button onclick="switchToTablesTab()" class="flex flex-col items-center justify-center text-gray-600 hover:text-black hover:bg-gray-50 transition-colors" id="tablesTabBtn">
                <i class="fas fa-th-large text-lg mb-1"></i>
                <span class="text-xs">Tables</span>
            </button>
            <button onclick="switchToOrdersTab()" class="flex flex-col items-center justify-center text-gray-600 hover:text-black hover:bg-gray-50 transition-colors relative" id="ordersTabBtn">
                <i class="fas fa-receipt text-lg mb-1"></i>
                <span class="text-xs">Orders</span>
                <span id="mobile-order-count-badge-table" class="absolute -top-1 -right-1 bg-red-600 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center hidden">0</span>
            </button>
        </div>
    </div>

    <!-- Simple Mode Mobile Button -->
    <button id="mobile-order-toggle" onclick="toggleMobileOrderPanel()" class="simple-mode-only fixed bottom-4 right-4 bg-black text-white p-4 rounded-full shadow-lg z-50 flex items-center justify-center hover:bg-gray-800 active:bg-gray-700">
        <i class="fas fa-receipt text-xl"></i>
        <span id="mobile-order-count-badge" class="absolute -top-1 -right-1 bg-red-600 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center hidden">0</span>
    </button>

    <div id="order-panel-backdrop" class="fixed inset-0 bg-black bg-opacity-60 z-40 hidden" onclick="toggleMobileOrderPanel()"></div>
    <aside id="order-panel" class="fixed bottom-0 left-0 right-0 bg-white shadow-2xl border-t-2 border-black transform translate-y-full transition-transform duration-300 ease-in-out z-50 flex flex-col" style="max-height: 85vh;">
        <div class="p-3 border-b border-gray-300 flex justify-between items-center bg-gray-100">
            <h2 class="text-lg font-semibold text-gray-800" data-i18n="ui.order.yourOrder">Your Order</h2>
            <button onclick="toggleMobileOrderPanel()" class="text-gray-600 hover:text-black">
                <i class="fas fa-times text-xl"></i>
            </button>
        </div>

        <div id="order-items-container" class="flex-grow overflow-y-auto p-3 space-y-2 bg-white">
            <p id="empty-order-message" class="text-gray-600 text-center py-4" data-i18n="ui.order.empty">Your order is empty.</p>
        </div>

        <div id="numpad-container" class="p-3 border-t border-gray-300 bg-gray-100 hidden">
            <p id="numpad-item-name" class="text-sm text-center font-medium text-gray-700 mb-2">Quantity for: <span class="font-bold">Item</span></p>
            <div class="grid grid-cols-3 gap-2">
                <button onclick="handleNumpadInput('1')" class="py-3 bg-white border border-gray-400 rounded-md text-gray-800 font-semibold hover:bg-gray-200 active:bg-gray-300">1</button>
                <button onclick="handleNumpadInput('2')" class="py-3 bg-white border border-gray-400 rounded-md text-gray-800 font-semibold hover:bg-gray-200 active:bg-gray-300">2</button>
                <button onclick="handleNumpadInput('3')" class="py-3 bg-white border border-gray-400 rounded-md text-gray-800 font-semibold hover:bg-gray-200 active:bg-gray-300">3</button>
                <button onclick="handleNumpadInput('4')" class="py-3 bg-white border border-gray-400 rounded-md text-gray-800 font-semibold hover:bg-gray-200 active:bg-gray-300">4</button>
                <button onclick="handleNumpadInput('5')" class="py-3 bg-white border border-gray-400 rounded-md text-gray-800 font-semibold hover:bg-gray-200 active:bg-gray-300">5</button>
                <button onclick="handleNumpadInput('6')" class="py-3 bg-white border border-gray-400 rounded-md text-gray-800 font-semibold hover:bg-gray-200 active:bg-gray-300">6</button>
                <button onclick="handleNumpadInput('7')" class="py-3 bg-white border border-gray-400 rounded-md text-gray-800 font-semibold hover:bg-gray-200 active:bg-gray-300">7</button>
                <button onclick="handleNumpadInput('8')" class="py-3 bg-white border border-gray-400 rounded-md text-gray-800 font-semibold hover:bg-gray-200 active:bg-gray-300">8</button>
                <button onclick="handleNumpadInput('9')" class="py-3 bg-white border border-gray-400 rounded-md text-gray-800 font-semibold hover:bg-gray-200 active:bg-gray-300">9</button>
                <button onclick="handleNumpadInput('clear')" class="py-3 bg-gray-300 text-black rounded-md font-semibold hover:bg-gray-400 active:bg-gray-500">C</button>
                <button onclick="handleNumpadInput('0')" class="py-3 bg-white border border-gray-400 rounded-md text-gray-800 font-semibold hover:bg-gray-200 active:bg-gray-300">0</button>
                <button onclick="handleNumpadInput('backspace')" class="py-3 bg-gray-300 text-black rounded-md font-semibold hover:bg-gray-400 active:bg-gray-500"><i class="fas fa-backspace"></i></button>
            </div>
            <button onclick="confirmNumpadInput()" class="mt-2 w-full py-2 btn-primary rounded-md font-semibold">Done</button>
        </div>

        <div class="p-3 border-t border-gray-300 bg-gray-100 space-y-3">
            <div>
                <label for="universalOrderCommentInput" class="block text-xs font-medium text-gray-700 mb-1" data-i18n="ui.order.notesLabel">Order Notes:</label>
                <textarea id="universalOrderCommentInput" rows="2" class="w-full p-2 border border-gray-400 rounded-md text-sm" data-i18n-attr='{"placeholder":"ui.order.notesPlaceholder"}' placeholder="Any special requests for the whole order?"></textarea>
            </div>
            <div class="flex justify-between items-center">
                <span class="text-lg font-semibold text-gray-800" data-i18n="ui.order.total">Total:</span>
                <span id="order-total" class="text-lg font-bold text-black">&euro;0.00</span>
            </div>
            <div class="flex justify-between items-center">
                <label for="paidByCardCheckbox" class="flex items-center space-x-2 cursor-pointer">
                    <input type="checkbox" id="paidByCardCheckbox" class="h-5 w-5 text-black border-gray-400 rounded focus:ring-black accent-black">
                    <span class="text-sm font-medium text-gray-700" data-i18n="ui.order.payByCard">Pay by Card</span>
                </label>
            </div>
            <div class="grid grid-cols-2 gap-2">
                <button onclick="newOrder()" class="w-full py-3 btn-secondary transition">
                    <i class="fas fa-eraser mr-1"></i> <span data-i18n="ui.order.newOrder">New Order</span>
                </button>
                <button id="sendOrderBtn" onclick="sendOrder()" class="w-full py-3 btn-primary transition">
                    <i class="fas fa-paper-plane mr-1"></i> <span data-i18n="ui.order.sendOrder">Send Order</span>
                </button>
            </div>
        </div>
    </aside>

    <!-- Settings Gear & Tables Button -->
    <div id="settings-gear-container" class="fixed bottom-20 right-4 z-40 flex flex-col items-center gap-3">
        <!-- Tables Button (only visible when table management enabled) -->
        <button id="tablesBtn" onclick="openTablesModal()" class="table-mode-only bg-green-600 hover:bg-green-700 text-white w-12 h-12 rounded-full shadow-lg flex items-center justify-center transition" title="Tables" style="display: none;">
            <i class="fas fa-utensils text-xl"></i>
        </button>

        <!-- Settings Gear with connection status -->
        <button id="settingsGear" onclick="openLoginModal()" class="settings-gear status-checking bg-gray-700 text-white w-12 h-12 rounded-full shadow-lg flex items-center justify-center hover:bg-gray-800 transition" title="Management Panel - Checking connection..." aria-live="polite" aria-label="Management Panel - Checking connection">
            <i class="fas fa-cog text-xl"></i>
        </button>
        <span id="gearStatusLabel" class="gear-status-label status-checking active" aria-live="polite">Checking...</span>
    </div>

    <!-- MODALS -->
    <!-- Management modals are embedded below -->
    
    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-70 z-[90] hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-sm text-gray-800">
            <h3 class="text-xl font-semibold mb-4 text-center" data-i18n="ui.login.title">Management Access</h3>
            <form id="loginForm">
                <div class="space-y-4">
                    <div>
                        <label for="passwordInput" class="block text-sm font-medium text-gray-700" data-i18n="ui.login.password">Password</label>
                        <input type="password" id="passwordInput" name="password" class="mt-1 block w-full px-3 py-2 border border-gray-400 rounded-md shadow-sm sm:text-sm" data-i18n-attr='{"placeholder":"ui.login.enterPassword"}' placeholder="Password" required>
                    </div>
                    <p id="loginError" class="text-sm text-red-600 text-center hidden"></p>
                    <div class="flex gap-2 pt-2">
                        <button type="button" class="w-full py-2 px-4 btn-secondary" onclick="closeLoginModal()" data-i18n="ui.login.cancel">Cancel</button>
                        <button type="submit" id="loginSubmitBtn" class="w-full py-2 px-4 btn-primary" data-i18n="ui.login.login">Login</button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Offline Interruption Modal -->
    <div id="offlineInterruptionModal" class="offline-interruption-backdrop" style="display:none;">
        <div class="offline-interruption-card" role="dialog" aria-modal="true" aria-labelledby="offlineInterruptionTitle">
            <div class="offline-interruption-header">
                <div class="flex items-start gap-4">
                    <div class="offline-interruption-icon" aria-hidden="true">
                        <i class="fas fa-plug-circle-exclamation"></i>
                    </div>
                    <div>
                        <h2 id="offlineInterruptionTitle" class="text-2xl font-semibold text-slate-900" data-i18n="ui.offlineModal.title">Internet connection lost - POS running in grace mode</h2>
                        <p class="text-sm text-slate-600 mt-2">
                            <span data-i18n="ui.offlineModal.summary">We can't reach the licensing service right now. POSPal will keep working using the last verified license.</span>
                            <span id="offlineModalGraceText" class="font-medium text-slate-900 block mt-1"></span>
                        </p>
                    </div>
                </div>
            </div>
            <div class="offline-interruption-body space-y-6">
                <section>
                    <h3 class="text-sm uppercase tracking-wide text-slate-500 font-semibold" data-i18n="ui.offlineModal.section.whatHappened">What happened</h3>
                    <p class="text-base text-slate-700 mt-2" data-i18n="ui.offlineModal.detail">The internet connection dropped, so we're using cached license data. Orders, payments, and printing continue to work normally.</p>
                </section>
                <section>
                    <h3 class="text-sm uppercase tracking-wide text-amber-600 font-semibold" data-i18n="ui.offlineModal.section.whatToDo">What you can do</h3>
                    <ul class="mt-3 space-y-2 text-base text-slate-700 list-disc pl-6">
                        <li data-i18n="ui.offlineModal.step.checkRouter">Check the modem/router and ensure cables are connected.</li>
                        <li data-i18n="ui.offlineModal.step.contactProvider">If the internet outage persists, contact your internet provider.</li>
                        <li data-i18n="ui.offlineModal.step.retry">Once you're back online, click retry below to restore full licensing sync.</li>
                    </ul>
                </section>
                <section>
                    <h3 class="text-sm uppercase tracking-wide text-slate-500 font-semibold" data-i18n="ui.offlineModal.section.status">Current status</h3>
                    <div class="mt-3 space-y-1 text-base text-slate-700">
                        <p><span class="font-medium" data-i18n="ui.offlineModal.status.lastValidated">Last successful validation:</span> <span id="offlineModalLastValidated">--</span></p>
                        <p><span class="font-medium" data-i18n="ui.offlineModal.status.graceExpiry">Grace period remaining:</span> <span id="offlineModalGraceCountdown">--</span></p>
                        <p><span class="font-medium" data-i18n="ui.offlineModal.status.trial">Failover mode:</span> <span id="offlineModalModeLabel" data-i18n="ui.offlineModal.mode.trial">Grace mode (full features)</span></p>
                    </div>
                </section>
            </div>
            <div class="offline-interruption-actions">
                <button id="offlineModalRetryButton" type="button" class="action-primary">
                    <i class="fas fa-sync-alt"></i>
                    <span data-i18n="ui.offlineModal.action.retryNow">Retry connection</span>
                </button>
                <span id="offlineModalDismiss" class="action-secondary" role="button" tabindex="0" data-i18n="ui.offlineModal.action.dismiss">Continue without internet</span>
                <span class="action-muted" data-i18n="ui.offlineModal.action.support">Need help? Contact POSPal support</span>
            </div>
        </div>
    </div>

    <!-- Item Option Select Modal -->
    <div id="itemOptionSelectModal" class="fixed inset-0 bg-black bg-opacity-70 z-[60] hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl p-5 w-full max-w-md max-h-[80vh] flex flex-col text-gray-800">
            <h3 id="optionModalItemName" class="text-lg font-semibold mb-1">Select Option</h3>
            <p id="optionModalItemDescription" class="text-sm text-gray-600 mb-3">Please choose an option for the selected item:</p>
            <div id="optionModalOptionsContainer" class="flex-grow overflow-y-auto space-y-2 mb-4 pr-1"></div>
            <div class="flex gap-2 mt-auto">
                <button type="button" class="w-full py-2 px-4 btn-secondary" onclick="cancelOptionSelection()">Cancel</button>
                <button type="button" id="confirmOptionBtn" class="w-full py-2 px-4 btn-primary" onclick="confirmOptionSelection()">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Management Modal -->
    <div id="managementModal" class="fixed inset-0 bg-black bg-opacity-50 z-[70] hidden flex flex-col justify-end sm:justify-center sm:items-center">
        <div class="bg-white shadow-xl w-full h-[90vh] sm:h-auto sm:max-h-[90vh] sm:max-w-6xl flex flex-col text-gray-800 rounded-t-2xl sm:rounded-lg">
            <div class="p-4 border-b border-gray-200 flex justify-between items-center flex-shrink-0">
                <h2 class="text-xl font-semibold" data-i18n="ui.management.title">Management</h2>
                <button onclick="closeManagementModal()" class="text-gray-500 hover:text-black"><i class="fas fa-times text-2xl"></i></button>
            </div>
            <div class="p-2 border-b border-gray-200 management-tab-container flex-shrink-0">
                <div class="flex flex-wrap gap-1 rounded-md bg-gray-100 p-1">
                    <button onclick="switchManagementTab('analytics', this)" class="management-tab flex-1 py-2 px-2 text-xs sm:text-sm font-medium rounded-md text-gray-600 hover:bg-gray-200" data-i18n="ui.management.tabs.analytics">Analytics</button>
                    <button onclick="switchManagementTab('items', this)" class="management-tab flex-1 py-2 px-2 text-xs sm:text-sm font-medium rounded-md text-gray-600 hover:bg-gray-200" data-i18n="ui.management.tabs.items">Items</button>
                    <button onclick="switchManagementTab('categories', this)" class="management-tab flex-1 py-2 px-2 text-xs sm:text-sm font-medium rounded-md text-gray-600 hover:bg-gray-200" data-i18n="ui.management.tabs.categories">Categories</button>
                    <button onclick="switchManagementTab('orderHistory', this)" class="management-tab flex-1 py-2 px-2 text-xs sm:text-sm font-medium rounded-md text-gray-600 hover:bg-gray-200" data-i18n="ui.management.tabs.orders">Order History</button>
                    <button onclick="openDaySummaryModal()" class="flex-1 py-2 px-2 text-xs sm:text-sm font-medium rounded-md text-gray-600 hover:bg-gray-200 bg-blue-100" data-i18n="ui.management.tabs.daySummary">Day Summary</button>
                </div>
            </div>
            <div class="flex-grow overflow-y-auto p-4 management-content">
                <div id="analyticsManagement" class="hidden">
                    <div class="flex flex-col sm:flex-row justify-between sm:items-center mb-4 gap-4">
                        <h3 class="text-xl font-semibold text-gray-800" data-i18n="ui.analytics.performanceOverview">Performance Overview</h3>
                        <div class="flex items-center gap-1 bg-gray-100 p-1 rounded-lg flex-wrap">
                            <button onclick="loadAnalyticsData('today', this)" class="date-range-btn flex-grow text-sm px-3 py-1.5 rounded-md transition-colors" data-i18n="ui.analytics.today">Today</button>
                            <button onclick="loadAnalyticsData('week', this)" class="date-range-btn flex-grow text-sm px-3 py-1.5 rounded-md transition-colors" data-i18n="ui.analytics.thisWeek">This Week</button>
                            <button onclick="loadAnalyticsData('month', this)" class="date-range-btn flex-grow text-sm px-3 py-1.5 rounded-md transition-colors" data-i18n="ui.analytics.thisMonth">This Month</button>
                            <button onclick="toggleCustomDateRangeUI(this)" class="date-range-btn flex-grow text-sm px-3 py-1.5 rounded-md transition-colors" data-i18n="ui.analytics.custom">Custom</button>
                        </div>
                    </div>
                    <div id="custom-date-range-picker" class="hidden my-4 p-4 bg-gray-100 rounded-lg border border-gray-200">
                        <div class="flex flex-col sm:flex-row items-center gap-4">
                            <div>
                                <label for="startDate" class="block text-sm font-medium text-gray-700" data-i18n="ui.dates.startDate">Start Date</label>
                                <input type="date" id="startDate" name="startDate" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm sm:text-sm">
                            </div>
                            <div>
                                <label for="endDate" class="block text-sm font-medium text-gray-700" data-i18n="ui.dates.endDate">End Date</label>
                                <input type="date" id="endDate" name="endDate" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm sm:text-sm">
                            </div>
                            <div class="self-end pt-1 sm:pt-0">
                                <button onclick="fetchCustomDateRangeAnalytics()" class="w-full sm:w-auto py-2 px-4 btn-primary rounded-md" data-i18n="ui.analytics.go">Go</button>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                        <div class="bg-gray-50 p-4 rounded-lg shadow"><h4 class="text-sm font-medium text-gray-500" data-i18n="ui.analytics.kpi.grossRevenue">Gross Revenue</h4><p id="kpi-gross-revenue" class="text-3xl font-bold text-gray-900 mt-1">&euro;0.00</p></div>
                        <div class="bg-gray-50 p-4 rounded-lg shadow"><h4 class="text-sm font-medium text-gray-500" data-i18n="ui.analytics.kpi.totalOrders">Total Orders</h4><p id="kpi-total-orders" class="text-3xl font-bold text-gray-900 mt-1">0</p></div>
                        <div class="bg-gray-50 p-4 rounded-lg shadow"><h4 class="text-sm font-medium text-gray-500" data-i18n="ui.analytics.kpi.avgOrderValue">Avg. Order Value</h4><p id="kpi-atv" class="text-3xl font-bold text-gray-900 mt-1">&euro;0.00</p></div>
                        <div class="bg-gray-50 p-4 rounded-lg shadow"><h4 class="text-sm font-medium text-gray-500" data-i18n="ui.analytics.kpi.itemsPerOrder">Items per Order</h4><p id="kpi-items-per-order" class="text-3xl font-bold text-gray-900 mt-1">-</p></div>
                    </div>
                    <div class="space-y-4">
                        <div class="bg-white p-4 rounded-lg border"><h4 class="font-semibold text-gray-700 mb-3" data-i18n="ui.analytics.salesByHour">Sales by Hour</h4><div class="overflow-x-auto overflow-y-hidden pb-2"><div id="analytics-chart-container" class="h-56 md:h-64 flex items-end space-x-4"><p class="text-xs text-gray-500 italic w-full text-center" data-i18n="ui.analytics.loadingChartData">Loading chart data...</p></div></div></div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 items-stretch">
                            <div class="bg-white p-4 rounded-lg border h-full flex flex-col"><h4 class="font-semibold text-gray-700 mb-2" data-i18n="ui.analytics.salesByCategory">Sales by Category</h4><div id="kpi-sales-by-category" class="space-y-2 flex-grow overflow-y-auto"><p class="text-xs text-gray-500 italic" data-i18n="ui.analytics.loadingData">Loading data...</p></div></div>
                            <div class="bg-white p-4 rounded-lg border h-full flex flex-col"><h4 class="font-semibold text-gray-700 mb-2" data-i18n="ui.analytics.topItemsRevenue">Top Items (by Revenue)</h4><div id="kpi-top-revenue-items" class="space-y-2 flex-grow overflow-y-auto"><p class="text-xs text-gray-500 italic" data-i18n="ui.analytics.loadingData">Loading data...</p></div></div>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 items-stretch">
                            <div class="bg-white p-4 rounded-lg border h-full flex flex-col"><h4 class="font-semibold text-gray-700 mb-2" data-i18n="ui.analytics.bestSellersQty">Best Selling Items (by Qty)</h4><div id="kpi-best-sellers" class="space-y-2 flex-grow overflow-y-auto"><p class="text-xs text-gray-500 italic" data-i18n="ui.analytics.loadingData">Loading data...</p></div></div>
                            <div class="bg-white p-4 rounded-lg border h-full flex flex-col"><h4 class="font-semibold text-gray-700 mb-2" data-i18n="ui.analytics.worstSellersQty">Underperforming Items (by Qty)</h4><div id="kpi-worst-sellers" class="space-y-2 flex-grow overflow-y-auto"><p class="text-xs text-gray-500 italic" data-i18n="ui.analytics.loadingData">Loading data...</p></div></div>
                        </div>

                        <div class="bg-white p-4 rounded-lg border"><h4 class="font-semibold text-gray-700 mb-2" data-i18n="ui.analytics.topAddons">Top Add‚Äëons / Options</h4><div id="kpi-top-addons" class="space-y-2"><p class="text-xs text-gray-500 italic" data-i18n="ui.analytics.noAddonData">No add‚Äëon data.</p></div></div>
                    </div>
                </div>
                <div id="itemsManagement" class="hidden">
                    <div class="flex justify-end mb-4"><button onclick="openItemFormModal()" class="btn-success py-2 px-4 rounded-md flex items-center"><i class="fas fa-plus mr-2"></i><span data-i18n="ui.items.addNewItem">Add New Item</span></button></div>
                    <h4 class="text-md font-medium text-gray-800 mb-2" data-i18n="ui.items.existingItems">Existing Items</h4>
                    <div id="existingItemsListModal" class="space-y-3 pr-2 border border-gray-200 rounded-md p-2 bg-gray-50"><p class="text-xs text-gray-500 italic" data-i18n="ui.items.noItemsFound">No items found.</p></div>
                </div>
                <div id="categoriesManagement" class="hidden">
                    <form id="categoryManagementForm" class="space-y-4 management-form">
                        <div><label for="categoryName" class="block text-sm font-medium text-gray-700" data-i18n="ui.category.nameLabel">Category Name</label><input type="text" id="categoryName" name="categoryName" class="mt-1 block w-full px-3 py-2 border border-gray-400 rounded-md shadow-sm sm:text-sm" required></div>
                        <button type="button" onclick="saveCategory()" class="w-full py-2 px-4 btn-success">üìÅ <span data-i18n="ui.category.save">Save Category</span></button>
                    </form>
                    <div class="mt-6">
                        <h4 class="text-md font-medium text-gray-800 mb-2">Existing Categories</h4>
                        <div id="existingCategoriesListModal" class="space-y-2 max-h-72 overflow-y-auto pr-1 border border-gray-200 rounded-md p-2 bg-gray-50"><p class="text-xs text-gray-500 italic">No categories found.</p></div>
                    </div>
                </div>
                <div id="orderHistoryManagement" class="hidden">
                    <h3 class="text-lg font-semibold text-gray-800 mb-3" data-i18n="ui.orderHistory.titleToday">Today's Orders</h3>
                    <div class="flex flex-wrap gap-2 items-end mb-3">
                        <div>
                            <label class="block text-xs text-gray-600">Date</label>
                            <input id="ohDate" type="date" class="px-2 py-1 border border-gray-300 rounded text-sm" />
                        </div>
                        <div>
                            <label class="block text-xs text-gray-600">Time Range</label>
                            <select id="ohRange" class="px-2 py-1 border border-gray-300 rounded text-sm">
                                <option value="all">All Day</option>
                                <option value="this_hour">This Hour</option>
                                <option value="last2h">Last 2 Hours</option>
                                <option value="custom">Custom</option>
                            </select>
                        </div>
                        <div id="ohCustomRange" class="hidden flex items-end gap-2">
                            <div>
                                <label class="block text-xs text-gray-600">Start (HH:MM)</label>
                                <input id="ohStart" type="time" class="px-2 py-1 border border-gray-300 rounded text-sm" />
                            </div>
                            <div>
                                <label class="block text-xs text-gray-600">End (HH:MM)</label>
                                <input id="ohEnd" type="time" class="px-2 py-1 border border-gray-300 rounded text-sm" />
                            </div>
                        </div>
                        <div class="flex-1 min-w-[160px]">
                            <label class="block text-xs text-gray-600">Search (Order # or Table)</label>
                            <input id="ohSearch" type="text" class="w-full px-2 py-1 border border-gray-300 rounded text-sm" placeholder="# or table" />
                        </div>
                        <button onclick="loadTodaysOrdersForReprint()" class="px-3 py-2 btn-secondary text-sm"><i class="fas fa-sync-alt mr-1"></i> <span data-i18n="ui.orderHistory.refreshList">Refresh</span></button>
                    </div>
                    <div id="todaysOrdersList" class="space-y-2 max-h-[60vh] overflow-y-auto pr-1 border border-gray-200 rounded-md p-2 bg-gray-50"><p class="text-xs text-gray-500 italic" data-i18n="ui.orderHistory.loadingToday">Loading today's orders...</p></div>
                </div>
                <div id="licenseManagement" class="hidden">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4" data-i18n="ui.license.infoTitle">License & Subscription</h3>

                    <!-- Main Status Card with Essential Information -->
                    <div class="bg-white rounded-xl border border-gray-200 p-6 mb-6 shadow-sm">
                        <div class="flex items-center justify-between mb-6">
                            <div class="flex items-center gap-3">
                                <h4 class="text-lg font-semibold text-gray-800" data-i18n="ui.license.currentStatus">Current Status</h4>
                                <div id="license-status-badge" class="px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-600">Loading...</div>
                            </div>
                            <button id="quick-portal-btn" onclick="openCustomerPortal()" class="portal-access-btn hidden text-blue-600 hover:text-blue-700 p-2 rounded-md transition-colors" title="Quick Portal Access">
                                <i class="fas fa-external-link-alt text-lg"></i>
                            </button>
                        </div>

                        <!-- Key Information Cards (2x2 Grid for Active Subscriptions) -->
                        <div id="subscription-details" class="hidden">
                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <!-- Next Payment Date -->
                                <div class="bg-blue-50 p-4 rounded-lg border border-blue-200 text-center">
                                    <div class="text-xs text-blue-600 uppercase tracking-wide font-medium mb-1">Next Payment</div>
                                    <div id="next-billing-date" class="text-lg font-bold text-blue-800">--</div>
                                </div>

                                <!-- Monthly Amount -->
                                <div class="bg-green-50 p-4 rounded-lg border border-green-200 text-center">
                                    <div class="text-xs text-green-600 uppercase tracking-wide font-medium mb-1">Monthly Cost</div>
                                    <div class="text-lg font-bold text-green-800" data-pricing-amount data-pricing-format="long">‚Ç¨20.00</div>
                                </div>

                                <!-- Subscription Status -->
                                <div class="bg-emerald-50 p-4 rounded-lg border border-emerald-200 text-center">
                                    <div class="text-xs text-emerald-600 uppercase tracking-wide font-medium mb-1">Status</div>
                                    <div id="subscription-status-display" class="text-lg font-bold text-emerald-800">Active</div>
                                </div>

                                <!-- Days Until Renewal -->
                                <div class="bg-purple-50 p-4 rounded-lg border border-purple-200 text-center">
                                    <div class="text-xs text-purple-600 uppercase tracking-wide font-medium mb-1">Renewal In</div>
                                    <div id="days-until-renewal" class="text-lg font-bold text-purple-800">-- days</div>
                                </div>
                            </div>

                            <!-- Prominent Manage Subscription Button -->
                            <div class="text-center">
                                <button id="manage-subscription-btn" onclick="openCustomerPortal()" class="btn-primary px-8 py-3 rounded-lg text-base font-semibold hover:transform hover:scale-105 transition-all duration-200 shadow-md">
                                    <i class="fas fa-cog mr-3"></i>
                                    Manage Subscription
                                </button>
                                <p class="text-xs text-gray-500 mt-2">Cancel, update payment method, or view billing history</p>
                            </div>
                        </div>

                        <!-- Trial Information Cards (for Trial Users) -->
                        <div id="trial-details" class="hidden">
                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <!-- Trial Status -->
                                <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200 text-center">
                                    <div class="text-xs text-yellow-600 uppercase tracking-wide font-medium mb-1">Trial Status</div>
                                    <div id="trial-status-display" class="text-lg font-bold text-yellow-800">Active Trial</div>
                                </div>

                                <!-- Days Remaining -->
                                <div class="bg-orange-50 p-4 rounded-lg border border-orange-200 text-center">
                                    <div class="text-xs text-orange-600 uppercase tracking-wide font-medium mb-1">Days Remaining</div>
                                    <div id="trial-days-remaining" class="text-lg font-bold text-orange-800">-- days</div>
                                </div>

                                <!-- Orders Processed -->
                                <div class="bg-blue-50 p-4 rounded-lg border border-blue-200 text-center">
                                    <div class="text-xs text-blue-600 uppercase tracking-wide font-medium mb-1">Orders Processed</div>
                                    <div id="trial-orders-count" class="text-lg font-bold text-blue-800">0</div>
                                </div>

                                <!-- Revenue Tracked -->
                                <div class="bg-green-50 p-4 rounded-lg border border-green-200 text-center">
                                    <div class="text-xs text-green-600 uppercase tracking-wide font-medium mb-1">Revenue Tracked</div>
                                    <div id="trial-revenue-amount" class="text-lg font-bold text-green-800">&euro;0.00</div>
                                </div>
                            </div>
                        </div>

                        <!-- Trial/Expired Actions (shown for trial/expired users) -->
                        <div id="trial-actions" class="hidden text-center">
                            <div class="mb-6">
                                <button type="button" class="btn-primary px-8 py-3 rounded-lg text-base font-semibold mb-3 hover:transform hover:scale-105 transition-all duration-200 shadow-md" onclick="showEmbeddedPayment()">
                                    <i class="fas fa-credit-card mr-3"></i>
                                    <span data-pricing-template="Subscribe - {price_short}/month">Subscribe - ‚Ç¨20/month</span>
                                </button>
                                <p class="text-xs text-gray-500 mb-4">Instant access ‚Ä¢ Cancel anytime</p>

                                <button type="button" class="btn-secondary px-6 py-2 rounded-md text-sm font-medium" onclick="showUnlockDialog()">
                                    <i class="fas fa-key mr-2"></i>
                                    Already paid? Enter unlock code
                                </button>
                            </div>

                            <div class="border-t border-gray-200 pt-4">
                                <button type="button" class="text-blue-600 hover:text-blue-700 text-sm font-medium hover:underline transition-colors" onclick="showLicenseRecoveryModal()">
                                    <i class="fas fa-envelope mr-1"></i>
                                    Lost your license key? Recover it here
                                </button>
                            </div>
                        </div>

                        <!-- Loading State -->
                        <div id="license-loading" class="text-center py-8">
                            <div class="inline-flex items-center text-gray-600">
                                <i class="fas fa-spinner fa-spin mr-2"></i>
                                <span>Loading subscription information...</span>
                            </div>
                        </div>
                    </div>

                    
                    <!-- Device & Advanced Controls -->
                    <div class="mb-6 grid gap-6 lg:grid-cols-2">
                        <div class="bg-white rounded-xl border border-gray-200 p-6 shadow-sm">
                            <h4 class="text-lg font-semibold text-gray-800 mb-2">Device Session</h4>
                            <p class="text-sm text-gray-600 mb-4">This terminal is currently signed in. Release it before moving POSPal to replacement hardware.</p>
                            <div class="space-y-3">
                                <div class="flex items-center justify-between bg-gray-50 border rounded-lg px-4 py-3 text-sm text-gray-700">
                                    <span class="font-medium">Current Device</span>
                                    <span id="license-session-label" class="text-gray-500">Active</span>
                                </div>
                                <button onclick="showDisconnectLicenseModal()"
                                        id="disconnect-license-btn"
                                        class="w-full btn-outline py-2 px-3 text-sm rounded-md text-left text-red-600 hover:bg-red-50 border-red-300 transition-colors">
                                    <i class="fas fa-unlink mr-2"></i>
                                    Release This Device
                                </button>
                                <p class="text-xs text-gray-500">Releasing ends this session immediately and clears cached license data on this device.</p>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl border border-gray-200 p-6 shadow-sm">
                            <h4 class="text-lg font-semibold text-gray-800 mb-2">Advanced Details</h4>
                            <p class="text-sm text-gray-600 mb-4">Support may request these identifiers when troubleshooting activations.</p>
                            <div class="bg-gray-50 p-4 rounded-lg flex items-center justify-between border">
                                <code id="hardware-id-display" class="text-sm font-mono text-gray-800 flex-1 mr-4 break-all">Loading...</code>
                                <button id="copy-hwid-btn" class="copy-btn flex-shrink-0 px-3 py-2 text-sm" onclick="copyHardwareId()">
                                    <i class="far fa-copy mr-1"></i>
                                    Copy
                                </button>
                            </div>
                            <p class="text-xs text-gray-500 mt-2">POSPal shares this fingerprint automatically during validation. Copy it only if Support asks for it.</p>
                        </div>
                    </div>

                    <!-- About Section -->
                    <div class="bg-gray-50 rounded-xl p-6 border border-gray-200">
                        <h4 class="text-lg font-semibold text-gray-800 mb-3" data-i18n="ui.license.about">About POSPal</h4>
                        <p class="text-sm text-gray-600 mb-4">¬© 2025 Anastasia Palamoutsi & Robert Zoumboulis-Airey. All rights reserved.</p>
                        <div class="flex flex-wrap gap-4 text-sm">
                            <a href="https://github.com/Radot1/POSPal/blob/main/EULA.md" target="_blank" class="text-blue-600 hover:underline transition-colors" data-i18n="ui.license.viewEula">EULA</a>
                            <a href="https://github.com/Radot1/POSPal/blob/main/PRIVACY.md" target="_blank" class="text-blue-600 hover:underline transition-colors" data-i18n="ui.license.privacyPolicy">Privacy Policy</a>
                            <a href="https://github.com/Radot1/POSPal/releases/latest" target="_blank" class="text-blue-600 hover:underline transition-colors" data-i18n="ui.license.releases">Releases</a>
                        </div>
                    </div>
                </div>
                <div id="onlineMenuManagement" class="hidden">
                    <div class="bg-gradient-to-r from-emerald-50 via-white to-blue-50 border border-emerald-100 rounded-xl p-4 mb-4 shadow-sm">
                        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
                            <div class="flex items-start gap-3">
                                <div class="h-12 w-12 rounded-lg bg-white shadow flex items-center justify-center border border-emerald-100 text-emerald-600">
                                    <i class="fas fa-qrcode text-xl"></i>
                                </div>
                                <div>
                                    <p class="text-xs uppercase tracking-wide text-gray-500">Online Menu</p>
                                    <p class="text-lg font-bold text-gray-900">QR Menu Publishing</p>
                                    <p id="cfStatusDetail" class="text-sm text-gray-600">Bring your menu online, share a beautiful QR, and update it instantly.</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-2">
                                <span id="cfStatusPill" class="px-3 py-1 rounded-full text-xs font-semibold bg-gray-100 text-gray-700 border border-gray-200">Not published yet</span>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white p-4 rounded-lg border shadow-sm">
                            <div class="flex items-center justify-between mb-3">
                                <div>
                                    <h4 class="font-semibold text-gray-800">Setup &amp; Publish</h4>
                                    <p class="text-xs text-gray-500">Choose your public slug and push updates live.</p>
                                </div>
                                <span id="cfSlugLock" class="text-xs px-2 py-1 rounded-full bg-gray-100 text-gray-600 border border-gray-200">Unlocked</span>
                            </div>

                            <div class="space-y-4">
                                <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Store Slug <span class="text-red-500">*</span></label>
                                <input id="cfStoreSlug" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="e.g., cafe-olive">
                            </div>
                            <div>
                            <div>
                                <button class="w-full btn-success px-4 py-2 rounded flex items-center justify-center gap-2" onclick="publishOnlineMenu()">
                                    <i class="fas fa-cloud-upload-alt"></i><span>Publish / Update</span>
                                </button>
                            </div>
                                <div id="cfSettingsMsg" class="text-xs text-gray-600"></div>
                            </div>
                        </div>

                        <div class="bg-white p-4 rounded-lg border shadow-sm">
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="font-semibold text-gray-800">Share &amp; Preview</h4>
                                <span class="text-xs text-gray-500 flex items-center gap-1"><i class="fas fa-shield-alt text-emerald-600"></i>Customer-ready</span>
                            </div>
                            <div class="space-y-4">
                                <div class="space-y-2">
                                    <label class="block text-sm font-medium text-gray-700">Live URL</label>
                                    <div class="flex flex-col sm:flex-row gap-2">
                                        <input id="cfMenuUrl" readonly class="flex-1 px-3 py-2 border border-gray-300 rounded-md" placeholder="Menu URL will appear here">
                                        <div class="flex gap-2">
                                            <button class="btn-secondary px-3 py-2 rounded text-sm whitespace-nowrap" onclick="copyCloudflareUrl()">Copy</button>
                                            <button class="btn-secondary px-3 py-2 rounded text-sm whitespace-nowrap" onclick="openCloudflareMenu()"><i class="fas fa-external-link-alt mr-1"></i>Open</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="flex items-start gap-4 flex-wrap">
                                    <div id="cfQrContainer" class="inline-block bg-white p-2 border rounded shadow-sm"></div>
                                    <div class="space-y-2">
                                        <button class="btn-primary px-4 py-2 rounded flex items-center gap-2" onclick="downloadCloudflareQr()">
                                            <i class="fas fa-download"></i>Download QR
                                        </button>
                                        <p class="text-xs text-gray-500 max-w-xs">Perfect for table tents, receipts, or signage. Print-ready PNG download.</p>
                                    </div>
                                </div>
                                <div id="cfPublishMsg" class="text-xs text-gray-600"></div>
                                <div class="flex items-center text-xs text-gray-500 gap-2">
                                    <i class="fas fa-clock"></i>
                                    <span id="cfLastPublished">Not published yet</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="hardwarePrintingManagement" class="hidden">
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">Hardware &amp; Printing</h3>
                    <div class="flex flex-col gap-4 lg:flex-row lg:items-start">
                        <div class="flex-1 space-y-4">
                        <div class="bg-white p-3 rounded border">
                            <h4 class="font-medium text-gray-700 mb-2" data-i18n="ui.printing.printer">Thermal Receipt Printer</h4>
                            <p class="text-xs text-gray-500 mb-3">Select your thermal receipt printer. PDF printers are automatically filtered out.</p>
                            <div class="flex items-center gap-2 flex-wrap">
                                <select id="printerSelect" class="px-3 py-2 border border-gray-300 rounded-md bg-white text-sm flex-1 min-w-[250px]"></select>
                                <button class="btn-secondary px-3 py-2 rounded" onclick="refreshPrinters()" data-i18n="ui.printing.refresh">Refresh</button>
                                <button class="btn-primary px-3 py-2 rounded" onclick="saveSelectedPrinter()" data-i18n="ui.printing.saveDefault">Save as Default</button>
                                <span id="printerStatusDot" class="inline-flex items-center text-xs ml-2"></span>
                            </div>
                            <div class="mt-2 flex items-center gap-2">
                                <button class="btn-secondary px-3 py-2 rounded" onclick="testPrint()" data-i18n="ui.printing.testPrint">Test Print</button>
                                <span id="lastTestPrintResult" class="text-xs text-gray-600"></span>
                            </div>
                            <details class="mt-3 text-xs text-gray-600">
                                <summary class="cursor-pointer text-blue-600 hover:text-blue-800">Need help finding your thermal printer?</summary>
                                <div class="mt-2 p-2 bg-blue-50 rounded">
                                    <p class="font-medium mb-1">Look for these printer names:</p>
                                    <ul class="list-disc list-inside space-y-1 ml-2">
                                        <li>Epson TM-T20, TM-T82, TM-T88 series</li>
                                        <li>Star TSP100, TSP143, TSP650, TSP700</li>
                                        <li>POS-80, POS-58 (common thermal printers)</li>
                                        <li>"Generic / Text Only" (may work)</li>
                                    </ul>
                                    <p class="mt-2 text-gray-700">üñ®Ô∏è icon indicates a detected thermal printer (recommended)</p>
                                </div>
                            </details>
                        </div>
                        <div class="bg-white p-3 rounded border">
                            <h4 class="font-medium text-gray-700 mb-2" data-i18n="ui.printing.settingsTitle">Settings</h4>
                            <div class="flex items-center gap-3 flex-wrap mb-2">
                                <label for="languageSelect" class="text-sm text-gray-700" data-i18n="ui.management.general.language">Language</label>
                                <select id="languageSelect" class="px-3 py-1.5 border border-gray-300 rounded-md text-sm">
                                    <option value="en" data-i18n="ui.management.general.lang_en">English</option>
                                    <option value="el" data-i18n="ui.management.general.lang_el">Greek</option>
                                </select>
                            </div>
                            <div class="flex items-center gap-3 flex-wrap mb-2">
                                <label class="inline-flex items-center gap-2 text-sm cursor-pointer">
                                    <input type="checkbox" id="tableManagementToggle" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" onchange="toggleTableManagement(this.checked)">
                                    <span class="font-medium text-gray-700">Enable Table Management</span>
                                </label>
                                <span class="text-xs text-gray-500">(For restaurants with table service)</span>
                            </div>

                            <!-- Table Configuration Section (shown when table management is enabled) -->
                            <div id="tableConfigSection" style="display: none;" class="mt-3 bg-gray-50 rounded-lg p-3 border border-gray-200">
                                <div class="flex items-center justify-between mb-3">
                                    <h5 class="font-medium text-gray-700 text-sm flex items-center">
                                        <i class="fas fa-chair mr-2"></i>Configure Tables
                                    </h5>
                                    <button onclick="addNewTable()" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-xs font-medium flex items-center gap-1">
                                        <i class="fas fa-plus"></i> Add Table
                                    </button>
                                </div>

                                <div id="tableConfigList" class="space-y-2 max-h-64 overflow-y-auto">
                                    <!-- Table items will be dynamically loaded here -->
                                </div>

                                <div class="mt-3 pt-3 border-t border-gray-300 text-xs text-gray-500">
                                    <i class="fas fa-info-circle mr-1"></i>Tables configured here will be available in the Table Mode view
                                </div>
                            </div>

                            <div class="my-3 border-t border-gray-200"></div>
                            <div class="flex items-center gap-4 flex-wrap">
                                <label class="inline-flex items-center gap-2 text-sm"><input type="checkbox" id="cutAfterPrintToggle" class="h-4 w-4"> <span data-i18n="ui.printing.cutAfterPrint">Cut after print</span></label>
                                <label class="inline-flex items-center gap-2 text-sm">
                                    <span>Copies per order</span>
                                    <input type="number" id="copiesPerOrderInput" min="1" max="10" step="1" class="px-2 py-1 border border-gray-300 rounded w-20" />
                                </label>
                            </div>
                        </div>
                        <div class="bg-white p-3 rounded border">
                            <h4 class="font-medium text-gray-700 mb-2" data-i18n="ui.password.changePassword">Change Password</h4>
                            <div class="grid gap-2 md:grid-cols-3">
                                <input id="currentPasswordInput" type="password" class="px-3 py-2 border border-gray-300 rounded-md text-sm" data-i18n-attr='{"placeholder":"ui.password.current"}' placeholder="Current">
                                <input id="newPasswordInput" type="password" class="px-3 py-2 border border-gray-300 rounded-md text-sm" data-i18n-attr='{"placeholder":"ui.password.new"}' placeholder="New">
                                <input id="confirmPasswordInput" type="password" class="px-3 py-2 border border-gray-300 rounded-md text-sm" data-i18n-attr='{"placeholder":"ui.password.confirm"}' placeholder="Confirm">
                            </div>
                            <button class="btn-primary mt-2 px-4 py-2 rounded" onclick="changeManagementPassword()" data-i18n="ui.password.savePassword">Save Password</button>
                        </div>
                        </div>
                        <div class="bg-white p-4 rounded-lg border-2 border-purple-200 text-sm text-gray-700 flex-1 lg:max-w-sm lg:sticky lg:top-4">
                            <div class="flex items-center gap-2 text-purple-700 font-semibold text-base mb-2">
                                <i class="fas fa-route"></i>
                                <span>Your setup guide</span>
                            </div>
                            <p class="text-xs text-gray-500 mb-4">Each section on the left unlocks an essential piece of your in-store flow. Follow the checklist below to see how it supports the business.</p>
                            <div class="space-y-4">
                                <div>
                                    <div class="flex items-center gap-2 font-semibold text-gray-800">
                                        <i class="fas fa-receipt text-purple-500"></i>
                                        Reliable receipts
                                    </div>
                                    <p class="mt-1 text-xs text-gray-600">Pick the right thermal printer and run a test print so every order leaves with a receipt. Save it as default when you see the green status dot.</p>
                                </div>
                                <div class="border-t border-purple-100 pt-4">
                                    <div class="flex items-center gap-2 font-semibold text-gray-800">
                                        <i class="fas fa-language text-purple-500"></i>
                                        Quick settings
                                    </div>
                                    <p class="mt-1 text-xs text-gray-600">Language and copy count keep the team in sync. Switch the UI language for staff and set how many receipts you need for kitchen vs. customer.</p>
                                </div>
                                <div class="border-t border-purple-100 pt-4">
                                    <div class="flex items-center gap-2 font-semibold text-gray-800">
                                        <i class="fas fa-chair text-purple-500"></i>
                                        Table management
                                    </div>
                                    <p class="mt-1 text-xs text-gray-600">Toggle "Enable Table Management" for dine-in service. The Configure Tables list appears below so you can add names or numbers that show up in Table Mode.</p>
                                </div>
                                <div class="border-t border-purple-100 pt-4">
                                    <div class="flex items-center gap-2 font-semibold text-gray-800">
                                        <i class="fas fa-lock text-purple-500"></i>
                                        Keep access secure
                                    </div>
                                    <p class="mt-1 text-xs text-gray-600">Update the management password regularly - especially before new staff start. Changes apply instantly to this modal.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="appVersionContainer" class="p-3 border-t border-gray-200 bg-gray-50 flex justify-between items-center text-xs text-gray-500 flex-shrink-0 rounded-b-lg">
                <div class="flex items-center gap-4 flex-wrap"><span data-i18n="ui.footer.version">POSPal Version:</span> <span id="appVersion" class="font-medium text-gray-600">1.0.0</span><span id="footer-trial-status" class="font-medium"></span><button onclick="switchManagementTab('license', this)" class="text-gray-500 hover:text-gray-800 hover:underline focus:outline-none focus:ring-2 focus:ring-gray-400 rounded px-1" data-i18n="ui.footer.licenseInfo">License Info</button><button onclick="switchManagementTab('hardwarePrinting', this)" class="text-gray-500 hover:text-gray-800 hover:underline focus:outline-none focus:ring-2 focus:ring-gray-400 rounded px-1" data-i18n="ui.footer.settings">Settings</button><button onclick="switchManagementTab('onlineMenu', this)" class="text-gray-500 hover:text-gray-800 hover:underline focus:outline-none focus:ring-2 focus:ring-gray-400 rounded px-1">Online Menu</button></div>
                <button onclick="shutdownApplication()" class="btn-danger text-white py-1 px-3 rounded-md flex items-center text-xs font-semibold"><i class="fas fa-power-off mr-1.5"></i><span data-i18n="ui.footer.shutdown">Shutdown</span></button>
            </div>
        </div>
    </div>

    <!-- Trial Lock Screen Overlay -->
    <div id="trialLockScreen" class="fixed inset-0 bg-black bg-opacity-95 z-[100] hidden items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-5xl max-h-[90vh] flex flex-col">
            <!-- Lock Screen Header -->
            <div class="p-8 text-center border-b border-gray-200">
                <div class="text-6xl text-red-600 mb-4">
                    <i class="fas fa-lock"></i>
                </div>
                <h2 class="text-4xl font-bold text-gray-900 mb-2">Trial Expired</h2>
                <p class="text-xl text-gray-600">Your 30-day trial has ended, but all your data is safe</p>
            </div>
            
            <!-- Data Preview Section -->
            <div class="flex-grow overflow-y-auto p-8">
                <div class="grid lg:grid-cols-2 gap-8">
                    <!-- Usage Statistics -->
                    <div class="space-y-6">
                        <h3 class="text-2xl font-semibold text-gray-800 mb-4">What You've Accomplished</h3>
                        
                        <div class="bg-gradient-to-r from-green-50 to-emerald-50 p-6 rounded-xl border border-green-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-3xl font-bold text-green-700" id="lockscreen-orders-count">--</div>
                                    <div class="text-green-600 font-medium">Orders Processed</div>
                                </div>
                                <i class="fas fa-receipt text-4xl text-green-600 opacity-50"></i>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-blue-50 to-sky-50 p-6 rounded-xl border border-blue-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-3xl font-bold text-blue-700" id="lockscreen-revenue-amount">--</div>
                                    <div class="text-blue-600 font-medium">Total Revenue Tracked</div>
                                </div>
                                <i class="fas fa-euro-sign text-4xl text-blue-600 opacity-50"></i>
                            </div>
                        </div>
                        
                        <div class="bg-gradient-to-r from-purple-50 to-violet-50 p-6 rounded-xl border border-purple-200">
                            <div class="flex items-center justify-between">
                                <div>
                                    <div class="text-3xl font-bold text-purple-700" id="lockscreen-days-used">30</div>
                                    <div class="text-purple-600 font-medium">Days of Free Trial Used</div>
                                </div>
                                <i class="fas fa-calendar-alt text-4xl text-purple-600 opacity-50"></i>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Data Preview -->
                    <div class="space-y-6">
                        <h3 class="text-2xl font-semibold text-gray-800 mb-4">Your Data is Locked</h3>
                        
                        <!-- Grayed out data preview -->
                        <div class="bg-gray-100 rounded-xl p-6 relative overflow-hidden">
                            <div class="absolute inset-0 bg-gray-200 opacity-60 z-10 flex items-center justify-center">
                                <div class="text-center">
                                    <i class="fas fa-lock text-4xl text-gray-600 mb-2"></i>
                                    <p class="text-gray-700 font-semibold">Locked</p>
                                </div>
                            </div>
                            
                            <div class="space-y-4 blur-sm">
                                <h4 class="font-semibold text-gray-700">Recent Orders</h4>
                                <div class="space-y-2">
                                    <div class="flex justify-between p-2 bg-white rounded">
                                        <span>Order #1234</span>
                                        <span>&euro;25.50</span>
                                    </div>
                                    <div class="flex justify-between p-2 bg-white rounded">
                                        <span>Order #1235</span>
                                        <span>&euro;18.75</span>
                                    </div>
                                    <div class="flex justify-between p-2 bg-white rounded">
                                        <span>Order #1236</span>
                                        <span>&euro;32.20</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-amber-50 border border-amber-200 rounded-xl p-6">
                            <div class="flex items-start">
                                <i class="fas fa-shield-alt text-amber-600 text-2xl mr-4 mt-1"></i>
                                <div>
                                    <h4 class="font-semibold text-amber-800 mb-2">Your Data is Safe</h4>
                                    <p class="text-amber-700 text-sm">
                                        All your orders, menu items, and settings are securely stored. 
                                        Subscribe now to regain instant access to everything.
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Action Buttons -->
            <div class="p-8 border-t border-gray-200 bg-gray-50 rounded-b-2xl">
                <div class="text-center space-y-4">
                    <button 
                        id="unlock-subscription-btn"
                        onclick="redirectToSubscription()"
                        class="w-full bg-gradient-to-r from-green-600 to-emerald-600 text-white py-4 px-8 rounded-xl text-xl font-bold hover:from-green-700 hover:to-emerald-700 transition-all duration-200 transform hover:scale-105 shadow-lg"
                    >
                        <i class="fas fa-unlock mr-3"></i>
                        <span data-pricing-template="Unlock Everything - Just {price_short}/month">Unlock Everything - Just ‚Ç¨20/month</span>
                    </button>
                    
                    <div class="flex items-center justify-center space-x-8 text-sm text-gray-600">
                        <div class="flex items-center">
                            <i class="fas fa-times mr-2 text-red-500"></i>
                            Cancel anytime
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-lock mr-2 text-green-500"></i>
                            Secure payment
                        </div>
                        <div class="flex items-center">
                            <i class="fas fa-zap mr-2 text-blue-500"></i>
                            Instant access
                        </div>
                    </div>
                    
                    <p class="text-sm text-gray-500 max-w-2xl mx-auto">
                        Your subscription starts immediately and renews monthly. 
                        You can cancel anytime from your account settings with no questions asked.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Unlock Token Dialog -->
    <div id="unlockTokenDialog" class="fixed inset-0 bg-black bg-opacity-90 z-[110] hidden items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md">
            <!-- Dialog Header -->
            <div class="p-6 text-center border-b border-gray-200">
                <div class="text-4xl text-green-600 mb-3">
                    <i class="fas fa-key"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-900 mb-2">Enter Unlock Code</h2>
                <p class="text-gray-600">Enter the email and unlock code from your payment confirmation</p>
            </div>
            
            <!-- Dialog Content -->
            <div class="p-6">
                <form id="unlockTokenForm">
                    <div class="space-y-4">
                        <div>
                            <label for="unlockEmail" class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                            <input type="email" id="unlockEmail" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-600 focus:border-green-600 transition-colors"
                                   placeholder="your@email.com">
                        </div>
                        
                        <div>
                            <label for="unlockToken" class="block text-sm font-medium text-gray-700 mb-2">Unlock Token</label>
                            <input type="text" id="unlockToken" required maxlength="35"
                                   class="w-full px-4 py-4 border border-gray-300 rounded-lg uppercase focus:ring-2 focus:ring-green-600 focus:border-green-600 transition-colors text-lg"
                                   placeholder="POSPAL-XXXX-XXXX-XXXX-XXXX"
                                   style="font-family: 'Courier New', monospace !important; min-height: 60px; min-width: 400px; letter-spacing: 1px;">
                        </div>
                    </div>
                    
                    <div id="unlockError" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mt-4 text-sm"></div>
                    
                    <div class="mt-6 space-y-3">
                        <button type="submit" id="unlockSubmitBtn" 
                                class="w-full bg-green-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-green-700 transition-colors flex items-center justify-center">
                            <i class="fas fa-unlock mr-2"></i>
                            <span id="unlockBtnText">Unlock POSPal</span>
                        </button>
                        
                        <button type="button" onclick="hideUnlockDialog()" 
                                class="w-full bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors">
                            Cancel
                        </button>
                    </div>
                </form>
                
                <div class="mt-6 pt-4 border-t border-gray-200 text-center">
                    <p class="text-sm text-gray-600 mb-3">Don't have an unlock code yet?</p>
                    <div class="space-y-2">
                        <button onclick="hideUnlockDialog(); showEmbeddedPayment();"
                                class="block w-full text-green-600 hover:text-green-700 font-medium text-sm">
                            <i class="fas fa-credit-card mr-1"></i>
                            <span data-pricing-template="Subscribe for {price_short}/month">Subscribe for ‚Ç¨20/month</span>
                        </button>
                        <button onclick="showLicenseRecoveryModal()" 
                                class="block w-full text-blue-600 hover:text-blue-700 font-medium text-sm">
                            <i class="fas fa-envelope mr-1"></i>
                            Forgot License Key? Resend to Email
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- License Key Recovery Modal -->
    <div id="licenseRecoveryModal" class="fixed inset-0 bg-black bg-opacity-90 z-[120] hidden items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md">
            <!-- Modal Header -->
            <div class="p-6 text-center border-b border-gray-200">
                <div class="text-4xl text-blue-600 mb-3">
                    <i class="fas fa-envelope"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-900 mb-2">Recover License Key</h2>
                <p class="text-gray-600">Enter your email to receive your license key</p>
            </div>
            
            <!-- Modal Content -->
            <div class="p-6">
                <form id="licenseRecoveryForm">
                    <div class="space-y-4">
                        <div>
                            <label for="recoveryEmail" class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                            <input type="email" id="recoveryEmail" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-blue-600 transition-colors"
                                   placeholder="your@email.com">
                            <p class="mt-1 text-xs text-gray-500">We'll send your license key to this email address</p>
                        </div>
                    </div>
                    
                    <!-- Messages -->
                    <div id="recoveryError" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mt-4 text-sm"></div>
                    <div id="recoverySuccess" class="hidden bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg mt-4 text-sm"></div>
                    <div id="recoveryWarning" class="hidden bg-yellow-50 border border-yellow-200 text-yellow-700 px-4 py-3 rounded-lg mt-4 text-sm"></div>
                    
                    <!-- Buttons -->
                    <div class="mt-6 space-y-3">
                        <button type="submit" id="recoverySubmitBtn" 
                                class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-blue-700 transition-colors flex items-center justify-center">
                            <i class="fas fa-paper-plane mr-2"></i>
                            <span id="recoveryBtnText">Send License Key</span>
                        </button>
                        
                        <button type="button" onclick="hideLicenseRecoveryModal()" 
                                class="w-full bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors">
                            Cancel
                        </button>
                    </div>
                </form>
                
                <!-- Help Text -->
                <div class="mt-6 pt-4 border-t border-gray-200 text-center">
                    <p class="text-xs text-gray-500">
                        If you don't receive the email within 5 minutes, check your spam folder or 
                        <a href="#" onclick="contactSupport()" class="text-blue-600 hover:underline">contact support</a>.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Tables Management Modal -->
    <div id="tablesModal" class="fixed inset-0 bg-black bg-opacity-50 z-[70] hidden flex-col justify-end sm:justify-center sm:items-center">
        <div class="bg-white shadow-xl w-full h-[90vh] sm:max-w-6xl sm:h-auto sm:max-h-[90vh] flex flex-col text-gray-800 rounded-t-2xl sm:rounded-lg">
            <!-- Header -->
            <div class="p-4 border-b border-gray-200 flex justify-between items-center flex-shrink-0">
                <h2 class="text-xl sm:text-2xl font-bold text-gray-800">
                    <i class="fas fa-utensils mr-2 text-green-600"></i>Tables
                </h2>
                <button onclick="closeTablesModal()" class="text-gray-500 hover:text-black transition">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>

            <!-- Main Content Area -->
            <div class="flex-grow overflow-y-auto p-4 sm:p-6" id="tablesMainView">
                <!-- Loading State -->
                <div id="tablesLoading" class="text-center py-12">
                    <i class="fas fa-spinner fa-spin text-4xl text-gray-400 mb-4"></i>
                    <p class="text-gray-500">Loading tables...</p>
                </div>

                <!-- Tables Grid View -->
                <div id="tablesGridView" class="hidden">
                    <div class="mb-4 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3">
                        <div class="flex gap-2 items-center flex-wrap">
                            <span class="text-sm text-gray-600">Status:</span>
                            <button onclick="filterTables('all')" class="table-filter-btn active px-3 py-1 rounded text-sm font-medium">All</button>
                            <button onclick="filterTables('available')" class="table-filter-btn px-3 py-1 rounded text-sm font-medium">Available</button>
                            <button onclick="filterTables('occupied')" class="table-filter-btn px-3 py-1 rounded text-sm font-medium">Occupied</button>
                            <button onclick="filterTables('paid')" class="table-filter-btn px-3 py-1 rounded text-sm font-medium">Need Clearing</button>
                        </div>
                        <button onclick="refreshTables()" class="btn-secondary px-4 py-2 rounded-lg flex items-center gap-2">
                            <i class="fas fa-sync-alt"></i>Refresh
                        </button>
                    </div>

                    <!-- Tables Grid -->
                    <div id="tablesGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3 sm:gap-4">
                        <!-- Table cards will be inserted here -->
                    </div>

                    <!-- Empty State -->
                    <div id="tablesEmptyState" class="hidden text-center py-12">
                        <i class="fas fa-table text-6xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500 text-lg">No tables found</p>
                        <p class="text-gray-400 text-sm mt-2">Tables will appear here when configured</p>
                    </div>
                </div>

                <!-- Table Detail View -->
                <div id="tableDetailView" class="hidden">
                    <button onclick="showTablesGrid()" class="mb-4 text-gray-600 hover:text-gray-800 flex items-center gap-2">
                        <i class="fas fa-arrow-left"></i>Back to Tables
                    </button>

                    <!-- Table Header -->
                    <div class="bg-gray-50 rounded-lg p-4 sm:p-6 mb-4 sm:mb-6">
                        <div class="flex flex-col sm:flex-row justify-between items-start gap-4">
                            <div>
                                <h3 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-2">
                                    Table <span id="detailTableNumber">-</span>
                                </h3>
                                <div id="detailTableStatus" class="inline-block px-3 py-1 rounded-full text-sm font-medium">
                                    <!-- Status badge -->
                                </div>
                            </div>
                            <div class="text-left sm:text-right">
                                <p class="text-sm text-gray-600 mb-1">Current Total</p>
                                <p id="detailTableTotal" class="text-2xl sm:text-3xl font-bold text-gray-800">0.00</p>
                            </div>
                        </div>
                    </div>

                    <!-- Orders List -->
                    <div class="mb-4 sm:mb-6">
                        <h4 class="text-lg font-semibold text-gray-800 mb-3">Orders</h4>
                        <div id="tableOrdersList" class="space-y-3">
                            <!-- Orders will be inserted here -->
                        </div>
                        <div id="tableOrdersEmpty" class="hidden text-center py-8 bg-gray-50 rounded-lg">
                            <i class="fas fa-receipt text-4xl text-gray-300 mb-2"></i>
                            <p class="text-gray-500">No orders for this table</p>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex flex-col sm:flex-row gap-3 flex-wrap">
                        <button onclick="viewTableBill()" class="btn-secondary px-4 py-3 rounded-lg flex items-center justify-center gap-2">
                            <i class="fas fa-file-invoice"></i>View Bill
                        </button>
                        <button onclick="showSplitBillModal()" class="btn-secondary px-4 py-3 rounded-lg flex items-center justify-center gap-2" id="splitBillBtn">
                            <i class="fas fa-scissors"></i>Split Bill
                        </button>
                        <button onclick="markTableAsPaid()" class="btn-success px-4 py-3 rounded-lg flex items-center justify-center gap-2" id="markPaidBtn">
                            <i class="fas fa-check"></i>Mark as Paid
                        </button>
                        <button onclick="clearTable()" class="btn-warning px-4 py-3 rounded-lg flex items-center justify-center gap-2" id="clearTableBtn">
                            <i class="fas fa-broom"></i>Clear Table
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Split Bill Modal -->
    <div id="splitBillModal" class="fixed inset-0 bg-black bg-opacity-50 z-[75] hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md max-h-[80vh] flex flex-col">
            <div class="p-4 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-xl font-semibold">Split Bill</h3>
                <button onclick="closeSplitBillModal()" class="text-gray-500 hover:text-black">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>

            <!-- Tab Navigation -->
            <div class="border-b border-gray-200 px-4">
                <div class="flex gap-2">
                    <button id="equalSplitTab" onclick="switchSplitTab('equal')" class="px-3 py-3 font-medium text-sm border-b-2 border-blue-600 text-blue-600 transition-colors">
                        Equal Split
                    </button>
                    <button id="byItemsTab" onclick="switchSplitTab('byItems')" class="px-3 py-3 font-medium text-sm border-b-2 border-transparent text-gray-500 hover:text-gray-700 transition-colors">
                        By Items
                    </button>
                </div>
            </div>

            <div class="flex-grow overflow-y-auto p-6">
                <!-- Equal Split Content -->
                <div id="equalSplitContent">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Number of Ways to Split</label>
                        <input type="number" id="splitWaysInput" min="2" max="10" value="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg" onchange="updateSplitPreview()">
                    </div>
                    <div id="splitPreview" class="bg-gray-50 p-4 rounded-lg mb-6">
                        <!-- Split preview will be shown here -->
                    </div>

                    <!-- Payment Recording Section -->
                    <div class="border-t border-gray-200 pt-4">
                        <h4 class="text-sm font-semibold text-gray-700 mb-3">Record Payments</h4>
                        <div id="equalSplitPayments" class="space-y-3">
                            <!-- Payment cards generated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- By Items Content -->
                <div id="byItemsContent" class="hidden">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Number of People</label>
                        <select id="numPeopleSelect" class="w-full px-3 py-2 border border-gray-300 rounded-lg" onchange="updateNumPeople()">
                            <option value="2">2 People</option>
                            <option value="3">3 People</option>
                            <option value="4">4 People</option>
                            <option value="5">5 People</option>
                            <option value="6">6 People</option>
                            <option value="7">7 People</option>
                            <option value="8">8 People</option>
                            <option value="9">9 People</option>
                            <option value="10">10 People</option>
                        </select>
                    </div>

                    <div class="mb-4">
                        <h4 class="text-sm font-semibold text-gray-700 mb-3">Assign items to each person:</h4>
                        <div id="itemsListForSplit" class="space-y-3 max-h-64 overflow-y-auto">
                            <!-- Item assignment cards will be generated here -->
                        </div>
                    </div>

                    <!-- Split Summary Panel -->
                    <div id="splitSummaryPanel" class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                        <h4 class="text-sm font-semibold text-gray-700 mb-3">Split Summary</h4>
                        <div id="splitSummaryContent">
                            <!-- Summary will be shown here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Method Modal -->
    <div id="paymentMethodModal" class="fixed inset-0 bg-black bg-opacity-50 z-[75] hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
            <div class="p-6">
                <h3 class="text-xl font-semibold mb-6 text-gray-800">Complete Payment</h3>

                <div class="mb-6">
                    <div class="text-center text-3xl font-bold text-gray-800" id="paymentTotalDisplay">
                        &euro;0.00
                    </div>
                    <div class="text-center text-sm text-gray-500 mt-1">
                        Total Amount
                    </div>
                </div>

                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-3">
                        Payment Method:
                    </label>
                    <div class="grid grid-cols-2 gap-3">
                        <!-- Cash Button -->
                        <button onclick="selectPaymentMethod('cash')"
                                id="paymentMethodCash"
                                class="payment-method-btn selected-payment"
                                type="button">
                            <span class="text-4xl mb-2">üíµ</span>
                            <span class="font-medium">Cash</span>
                        </button>

                        <!-- Card Button -->
                        <button onclick="selectPaymentMethod('card')"
                                id="paymentMethodCard"
                                class="payment-method-btn"
                                type="button">
                            <span class="text-4xl mb-2">üí≥</span>
                            <span class="font-medium">Card</span>
                        </button>
                    </div>
                </div>

                <div class="flex gap-3">
                    <button onclick="closePaymentMethodModal()" class="flex-1 btn-secondary py-3 rounded-lg">
                        Cancel
                    </button>
                    <button onclick="confirmPayment()" class="flex-1 btn-success py-3 rounded-lg">
                        <i class="fas fa-check mr-2"></i>Confirm Payment
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Table Modal -->
    <div id="addTableModal" class="fixed inset-0 bg-black bg-opacity-50 z-[75] hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md flex flex-col">
            <div class="p-4 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-xl font-semibold text-gray-800">
                    <i class="fas fa-chair mr-2 text-green-600"></i>Add New Table
                </h3>
                <button onclick="closeAddTableModal()" class="text-gray-500 hover:text-black">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <div class="p-6 space-y-4">
                <div>
                    <label for="newTableName" class="block text-sm font-medium text-gray-700 mb-2">
                        Table Name <span class="text-red-500">*</span>
                    </label>
                    <input type="text" id="newTableName" placeholder="e.g., Table 4, VIP Lounge"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                           onkeypress="if(event.key==='Enter') document.getElementById('newTableSeats').focus()"
                           required>
                    <p class="text-xs text-gray-500 mt-1">Enter a unique name for this table</p>
                </div>
                <div>
                    <label for="newTableSeats" class="block text-sm font-medium text-gray-700 mb-2">
                        Number of Seats <span class="text-red-500">*</span>
                    </label>
                    <input type="number" id="newTableSeats" min="1" max="20" value="4"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                           onkeypress="if(event.key==='Enter') saveNewTable()"
                           required>
                    <p class="text-xs text-gray-500 mt-1">Enter the seating capacity (1-20)</p>
                </div>
            </div>
            <div class="p-4 border-t border-gray-200 flex gap-3">
                <button onclick="closeAddTableModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg font-medium transition">
                    Cancel
                </button>
                <button onclick="saveNewTable()" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg font-medium transition">
                    <i class="fas fa-check mr-2"></i>Add Table
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Table Modal -->
    <div id="editTableModal" class="fixed inset-0 bg-black bg-opacity-50 z-[75] hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md flex flex-col">
            <div class="p-4 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-xl font-semibold text-gray-800">
                    <i class="fas fa-edit mr-2 text-blue-600"></i>Edit Table
                </h3>
                <button onclick="closeEditTableModal()" class="text-gray-500 hover:text-black">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <div class="p-6 space-y-4">
                <input type="hidden" id="editTableId">
                <div>
                    <label for="editTableName" class="block text-sm font-medium text-gray-700 mb-2">
                        Table Name <span class="text-red-500">*</span>
                    </label>
                    <input type="text" id="editTableName" placeholder="e.g., Table 4, VIP Lounge"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                           onkeypress="if(event.key==='Enter') document.getElementById('editTableSeats').focus()"
                           required>
                    <p class="text-xs text-gray-500 mt-1">Enter a unique name for this table</p>
                </div>
                <div>
                    <label for="editTableSeats" class="block text-sm font-medium text-gray-700 mb-2">
                        Number of Seats <span class="text-red-500">*</span>
                    </label>
                    <input type="number" id="editTableSeats" min="1" max="20" value="4"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                           onkeypress="if(event.key==='Enter') saveEditedTable()"
                           required>
                    <p class="text-xs text-gray-500 mt-1">Enter the seating capacity (1-20)</p>
                </div>
            </div>
            <div class="p-4 border-t border-gray-200 flex gap-3">
                <button onclick="closeEditTableModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg font-medium transition">
                    Cancel
                </button>
                <button onclick="saveEditedTable()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg font-medium transition">
                    <i class="fas fa-save mr-2"></i>Save Changes
                </button>
            </div>
        </div>
    </div>

    <!-- Item Form Modal -->
    <div id="itemFormModal" class="fixed inset-0 bg-black bg-opacity-70 z-[80] hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col">
            <div class="p-4 border-b border-gray-300 flex justify-between items-center"><h2 id="itemFormModalTitle" class="text-xl font-semibold">Add/Edit Item</h2><button onclick="closeItemFormModal()" class="text-gray-500 hover:text-black"><i class="fas fa-times text-2xl"></i></button></div>
            <div class="flex-grow overflow-y-auto p-4">
                <form id="itemManagementForm" class="space-y-4 management-form">
                    <input type="hidden" id="itemId" name="itemId">
                    <div class="grid gap-4 md:grid-cols-2">
                        <div><label for="itemName" class="block text-sm font-medium text-gray-700">Item Name</label><input type="text" id="itemName" name="itemName" class="mt-1 block w-full px-3 py-2 border border-gray-400 rounded-md shadow-sm sm:text-sm" required></div>
                        <div><label for="itemPrice" class="block text-sm font-medium text-gray-700">Base Price (&euro;)</label><input type="number" step="0.01" id="itemPrice" name="itemPrice" inputmode="decimal" class="mt-1 block w-full px-3 py-2 border border-gray-400 rounded-md shadow-sm sm:text-sm" required></div>
                    </div>
                    <div><label for="itemCategory" class="block text-sm font-medium text-gray-700">Category</label><select id="itemCategory" name="itemCategory" class="mt-1 block w-full px-3 py-2 border border-gray-400 bg-white rounded-md shadow-sm sm:text-sm" required></select></div>

                    <!-- Enhanced Menu Fields -->
                    <div class="space-y-4 p-3 border border-gray-300 rounded-md bg-gray-50">
                        <h4 class="text-sm font-semibold text-gray-700 mb-2">üìù Enhanced Menu Information</h4>

                        <!-- Description -->
                        <div>
                            <label for="itemDescription" class="block text-sm font-medium text-gray-700">Description</label>
                            <textarea id="itemDescription" name="itemDescription" rows="2" placeholder="Brief description of the item..." class="mt-1 block w-full px-3 py-2 border border-gray-400 rounded-md shadow-sm sm:text-sm resize-none"></textarea>
                        </div>

                        <!-- Preparation Time -->
                        <div class="grid gap-4 md:grid-cols-2">
                            <div>
                                <label for="itemPrepTime" class="block text-sm font-medium text-gray-700">Prep Time (minutes)</label>
                                <input type="number" id="itemPrepTime" name="itemPrepTime" min="0" max="120" placeholder="15" class="mt-1 block w-full px-3 py-2 border border-gray-400 rounded-md shadow-sm sm:text-sm">
                            </div>
                        </div>

                        <!-- Dietary Tags -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">üå± Dietary Information</label>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
                                <label class="inline-flex items-center text-sm">
                                    <input type="checkbox" id="dietary-vegetarian" name="dietary-vegetarian" class="h-4 w-4 text-green-600 border-gray-400 rounded focus:ring-green-500 accent-green-600">
                                    <span class="ml-2">ü•¨ Vegetarian</span>
                                </label>
                                <label class="inline-flex items-center text-sm">
                                    <input type="checkbox" id="dietary-vegan" name="dietary-vegan" class="h-4 w-4 text-green-600 border-gray-400 rounded focus:ring-green-500 accent-green-600">
                                    <span class="ml-2">üå± Vegan</span>
                                </label>
                                <label class="inline-flex items-center text-sm">
                                    <input type="checkbox" id="dietary-gluten-free" name="dietary-gluten-free" class="h-4 w-4 text-green-600 border-gray-400 rounded focus:ring-green-500 accent-green-600">
                                    <span class="ml-2">üåæ Gluten-Free</span>
                                </label>
                                <label class="inline-flex items-center text-sm">
                                    <input type="checkbox" id="dietary-dairy-free" name="dietary-dairy-free" class="h-4 w-4 text-green-600 border-gray-400 rounded focus:ring-green-500 accent-green-600">
                                    <span class="ml-2">ü•õ Dairy-Free</span>
                                </label>
                                <label class="inline-flex items-center text-sm">
                                    <input type="checkbox" id="dietary-spicy" name="dietary-spicy" class="h-4 w-4 text-red-600 border-gray-400 rounded focus:ring-red-500 accent-red-600">
                                    <span class="ml-2">üå∂Ô∏è Spicy</span>
                                </label>
                                <label class="inline-flex items-center text-sm">
                                    <input type="checkbox" id="dietary-popular" name="dietary-popular" class="h-4 w-4 text-yellow-600 border-gray-400 rounded focus:ring-yellow-500 accent-yellow-600">
                                    <span class="ml-2">‚≠ê Popular</span>
                                </label>
                            </div>
                        </div>

                        <!-- Allergen Information -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">‚ö†Ô∏è Allergen Information</label>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
                                <label class="inline-flex items-center text-sm">
                                    <input type="checkbox" id="allergen-nuts" name="allergen-nuts" class="h-4 w-4 text-orange-600 border-gray-400 rounded focus:ring-orange-500 accent-orange-600">
                                    <span class="ml-2">ü•ú Nuts</span>
                                </label>
                                <label class="inline-flex items-center text-sm">
                                    <input type="checkbox" id="allergen-dairy" name="allergen-dairy" class="h-4 w-4 text-orange-600 border-gray-400 rounded focus:ring-orange-500 accent-orange-600">
                                    <span class="ml-2">ü•õ Dairy</span>
                                </label>
                                <label class="inline-flex items-center text-sm">
                                    <input type="checkbox" id="allergen-gluten" name="allergen-gluten" class="h-4 w-4 text-orange-600 border-gray-400 rounded focus:ring-orange-500 accent-orange-600">
                                    <span class="ml-2">üåæ Gluten</span>
                                </label>
                                <label class="inline-flex items-center text-sm">
                                    <input type="checkbox" id="allergen-seafood" name="allergen-seafood" class="h-4 w-4 text-orange-600 border-gray-400 rounded focus:ring-orange-500 accent-orange-600">
                                    <span class="ml-2">üêü Seafood</span>
                                </label>
                                <label class="inline-flex items-center text-sm">
                                    <input type="checkbox" id="allergen-eggs" name="allergen-eggs" class="h-4 w-4 text-orange-600 border-gray-400 rounded focus:ring-orange-500 accent-orange-600">
                                    <span class="ml-2">ü•ö Eggs</span>
                                </label>
                                <label class="inline-flex items-center text-sm">
                                    <input type="checkbox" id="allergen-soy" name="allergen-soy" class="h-4 w-4 text-orange-600 border-gray-400 rounded focus:ring-orange-500 accent-orange-600">
                                    <span class="ml-2">ü´ò Soy</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div class="flex items-center space-x-4"><div class="flex items-center"><input type="checkbox" id="itemHasOptionsModal" name="itemHasOptionsModal" onchange="toggleItemOptionsUIInModal()" class="h-4 w-4 text-black border-gray-400 rounded focus:ring-black accent-black"><label for="itemHasOptionsModal" class="ml-2 block text-sm text-gray-800">Has General Options</label></div></div>
                        <div id="itemOptionsModalContainer" class="hidden space-y-3 p-3 border border-gray-300 rounded-md bg-gray-50">
                            <label class="block text-sm font-medium text-gray-700">General Item Options:</label>
                            <div id="itemOptionsListDisplayModal" class="flex flex-wrap gap-2 mb-2 min-h-[40px] border border-gray-200 p-2 rounded-md bg-white"><p class="text-xs text-gray-500 italic w-full">No general options added</p></div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-2 items-end">
                                <div class="md:col-span-2"><label for="newOptionNameInputModal" class="block text-xs font-medium text-gray-600">Option Name</label><input type="text" id="newOptionNameInputModal" placeholder="e.g., Peppercorn Sauce" class="mt-1 w-full px-3 py-2 border border-gray-400 rounded-md shadow-sm sm:text-sm"></div>
                                <div><label for="newOptionPriceInputModal" class="block text-xs font-medium text-gray-600">Price Change (&euro;)</label><input type="number" step="0.01" id="newOptionPriceInputModal" placeholder="e.g., 2.00 or -0.50" inputmode="decimal" class="mt-1 w-full px-3 py-2 border border-gray-400 rounded-md shadow-sm sm:text-sm"></div>
                            </div>
                            <button type="button" onclick="addOptionToItemFormTempModal()" class="mt-2 px-4 py-2 btn-secondary text-sm w-full md:w-auto">Add Option</button>
                        </div>
                    </div>
                    <div class="flex gap-2 pt-4 border-t border-gray-200">
                        <button type="button" id="saveItemBtn" onclick="saveItem()" class="w-full py-2 px-4 btn-success">Save</button>
                        <button type="button" onclick="closeItemFormModal()" class="w-full py-2 px-4 btn-secondary">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Day Summary Modal -->
    <div id="daySummaryModal" class="fixed inset-0 bg-black bg-opacity-70 z-[80] hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md flex flex-col text-gray-800">
            <div class="p-4 border-b border-gray-300 flex justify-between items-center"><h2 class="text-xl font-semibold" data-i18n="ui.daySummary.title">Day Summary</h2><button onclick="closeDaySummaryModal()" class="text-gray-500 hover:text-black"><i class="fas fa-times text-2xl"></i></button></div>
            <div id="daySummaryContent" class="p-6 space-y-4"><p class="text-center italic" data-i18n="ui.daySummary.loading">Loading summary...</p></div>
        </div>
    </div>

    <div id="toast" class="fixed top-5 right-5 bg-gray-800 text-white px-4 py-2 rounded-md shadow-lg text-sm z-[100] hidden opacity-0 transition-opacity duration-300">
        <span id="toast-message">Toast message here</span>
    </div>

    <!-- Removed legacy connection status indicator in favor of gear-based status -->

    <!-- Subscription Modal -->
    <!-- Subscription Modal - Stacked Card Design -->
    <div id="subscriptionModal" class="fixed inset-0 bg-black bg-opacity-90 z-[110] hidden items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-[520px] max-h-[90vh] overflow-hidden flex flex-col">
            <!-- Modal Header -->
            <div class="relative bg-gradient-to-br from-emerald-500 to-blue-600 p-6 text-white">
                <!-- Close Button -->
                <button onclick="closeSubscriptionModal()"
                        class="absolute top-4 right-4 text-white hover:text-gray-200 transition-colors p-2 rounded-full hover:bg-white/10">
                    <i class="fas fa-times text-xl"></i>
                </button>

                <div class="flex items-center gap-3 mb-2">
                    <div class="text-3xl">
                        <i class="fas fa-crown"></i>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold">POSPal Professional</h2>
                        <p class="text-emerald-50 text-sm">Unlock your restaurant's full potential</p>
                    </div>
                </div>
            </div>

            <!-- Modal Content - Scrollable -->
            <div class="overflow-y-auto flex-1">
                <div class="p-6">
                    <!-- Subscription Form -->
                    <form id="subscriptionForm" class="space-y-4">
                        <!-- Restaurant Name -->
                        <div>
                            <label for="sub-restaurant-name" class="block text-sm font-semibold text-gray-700 mb-1.5">
                                Restaurant Name <span class="text-red-500">*</span>
                            </label>
                            <input type="text"
                                   id="sub-restaurant-name"
                                   required
                                   class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all outline-none"
                                   placeholder="e.g., The Golden Fork">
                        </div>

                        <!-- Customer Name -->
                        <div>
                            <label for="sub-customer-name" class="block text-sm font-semibold text-gray-700 mb-1.5">
                                Your Name <span class="text-red-500">*</span>
                            </label>
                            <input type="text"
                                   id="sub-customer-name"
                                   required
                                   class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all outline-none"
                                   placeholder="John Smith">
                        </div>

                        <!-- Email Address -->
                        <div>
                            <label for="sub-customer-email" class="block text-sm font-semibold text-gray-700 mb-1.5">
                                Email Address <span class="text-red-500">*</span>
                            </label>
                            <input type="email"
                                   id="sub-customer-email"
                                   required
                                   class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all outline-none"
                                   placeholder="your@email.com">

                            <!-- Duplicate validation messages (preserved from original) -->
                            <div id="email-validation-loading" class="hidden mt-2 text-sm text-gray-600 flex items-center">
                                <i class="fas fa-spinner fa-spin mr-2"></i>
                                Checking email...
                            </div>
                            <div id="email-duplicate-active" class="hidden mt-2 p-3 bg-blue-50 border-l-4 border-blue-500 text-blue-800 text-sm rounded-lg flex items-start gap-2">
                                <i class="fas fa-info-circle mt-0.5 flex-shrink-0"></i>
                                <span>You already have an active subscription. <a href="#" id="redirect-to-portal" class="underline font-semibold hover:text-blue-900">Manage your subscription here</a>.</span>
                            </div>
                            <div id="email-duplicate-returning" class="hidden mt-2 p-3 bg-green-50 border-l-4 border-green-500 text-green-800 text-sm rounded-lg flex items-start gap-2">
                                <i class="fas fa-check-circle mt-0.5 flex-shrink-0"></i>
                                <span>Welcome back! You can resubscribe to continue using POSPal.</span>
                            </div>
                            <div id="email-validation-error" class="hidden mt-2 p-3 bg-yellow-50 border-l-4 border-yellow-400 text-yellow-800 text-sm rounded-lg flex items-start gap-2">
                                <i class="fas fa-exclamation-triangle mt-0.5 flex-shrink-0"></i>
                                <span>Unable to validate email. You can still proceed with subscription.</span>
                            </div>
                            <div id="email-validation-success" class="hidden mt-2 p-3 bg-green-50 border-l-4 border-green-500 text-green-800 text-sm rounded-lg flex items-start gap-2">
                                <i class="fas fa-check-circle mt-0.5 flex-shrink-0"></i>
                                <span>Email is available for new subscription.</span>
                            </div>
                        </div>

                        <!-- Phone Number -->
                        <div>
                            <label for="sub-customer-phone" class="block text-sm font-semibold text-gray-700 mb-1.5">
                                Phone Number <span class="text-gray-400 text-xs font-normal">(Optional)</span>
                            </label>
                            <input type="tel"
                                   id="sub-customer-phone"
                                   class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all outline-none"
                                   placeholder="+30 123 456 7890">
                        </div>

                        <!-- Error & Loading Messages -->
                        <div id="subscription-error" class="hidden bg-red-50 border-l-4 border-red-500 text-red-700 px-4 py-3 rounded-lg text-sm flex items-start gap-2">
                            <i class="fas fa-exclamation-circle mt-0.5 flex-shrink-0"></i>
                            <span id="subscription-error-text"></span>
                        </div>

                        <div id="subscription-loading" class="hidden text-center text-gray-600 py-3 text-sm">
                            <i class="fas fa-spinner fa-spin mr-2"></i>
                            Creating secure checkout session...
                        </div>

                        <!-- Submit Button with Price -->
                        <div class="pt-2">
                            <button type="submit"
                                    class="w-full bg-gradient-to-r from-green-600 to-green-500 text-white py-4 px-6 rounded-xl font-bold text-lg hover:from-green-700 hover:to-green-600 transition-all shadow-lg hover:shadow-xl transform hover:scale-[1.02] active:scale-[0.98]">
                                <div class="flex items-center justify-center gap-2">
                                    <i class="fas fa-lock text-sm"></i>
                                    <span data-pricing-template="Subscribe for {price_short}/month">Subscribe for ‚Ç¨20/month</span>
                                </div>
                            </button>
                            <p class="text-center text-xs text-gray-500 mt-2">
                                Secure payment via Stripe ‚Ä¢ Cancel anytime
                            </p>
                        </div>
                    </form>

                    <!-- Features Section -->
                    <div class="mt-6 pt-6 border-t border-gray-200">
                        <h3 class="text-sm font-semibold text-gray-700 mb-3 uppercase tracking-wide">What's Included</h3>
                        <div class="grid grid-cols-1 gap-2.5">
                            <div class="flex items-center gap-3 text-gray-700">
                                <div class="w-6 h-6 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0">
                                    <i class="fas fa-check text-green-600 text-xs"></i>
                                </div>
                                <span class="text-sm">Unlimited tables & orders</span>
                            </div>
                            <div class="flex items-center gap-3 text-gray-700">
                                <div class="w-6 h-6 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0">
                                    <i class="fas fa-check text-green-600 text-xs"></i>
                                </div>
                                <span class="text-sm">Kitchen printing & order management</span>
                            </div>
                            <div class="flex items-center gap-3 text-gray-700">
                                <div class="w-6 h-6 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0">
                                    <i class="fas fa-check text-green-600 text-xs"></i>
                                </div>
                                <span class="text-sm">Offline operation (no internet required)</span>
                            </div>
                            <div class="flex items-center gap-3 text-gray-700">
                                <div class="w-6 h-6 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0">
                                    <i class="fas fa-check text-green-600 text-xs"></i>
                                </div>
                                <span class="text-sm">Priority email support</span>
                            </div>
                            <div class="flex items-center gap-3 text-gray-700">
                                <div class="w-6 h-6 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0">
                                    <i class="fas fa-check text-green-600 text-xs"></i>
                                </div>
                                <span class="text-sm">Cancel anytime, no commitment</span>
                            </div>
                        </div>
                    </div>

                    <!-- Trust Badges -->
                    <div class="mt-6 pt-6 border-t border-gray-200 text-center">
                        <div class="flex items-center justify-center gap-2 text-gray-500 text-sm">
                            <i class="fab fa-stripe text-2xl text-blue-600"></i>
                            <span class="text-xs">Secured by Stripe</span>
                        </div>
                        <div class="mt-2 flex items-center justify-center gap-3 text-gray-400 text-xs">
                            <span class="flex items-center gap-1">
                                <i class="fas fa-shield-alt"></i>
                                SSL Encrypted
                            </span>
                            <span>‚Ä¢</span>
                            <span class="flex items-center gap-1">
                                <i class="fas fa-credit-card"></i>
                                All cards accepted
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="offlineStatusStrip" class="offline-status-strip" style="display:none;">
        <span class="badge" data-i18n="ui.offlineStatusStrip.offline">Offline</span>
        <span class="text-sm" id="offlineStatusMessage"></span>
        <button id="offlineStripRetryButton" class="retry-btn" type="button">
            <i class="fas fa-sync-alt"></i>
            <span data-i18n="ui.offlineStatusStrip.retry">Retry</span>
        </button>
        <span id="offlineStripCountdown" class="text-xs text-slate-300"></span>
        <span id="offlineStripHelpLink" class="help-link" data-i18n="ui.offlineStatusStrip.help">View recovery steps</span>
    </div>

    <script src="./static/pricing.js" defer></script>
    <script src="./static/js/qrcode.min.js" defer></script>
    <script src="i18n.js" defer></script>
    <!-- Mobile Table Picker Bottom Sheet -->
    <div id="tablePickerOverlay" onclick="closeMobileTablePicker()"></div>
    <div id="tablePickerSheet">
        <div class="sheet-handle"></div>
        <div class="p-4 border-b border-gray-200">
            <h3 class="text-lg font-bold text-gray-800 text-center">
                <i class="fas fa-utensils mr-2 text-green-600"></i>Select Table
            </h3>
        </div>
        <div class="flex-1 overflow-y-auto p-4">
            <div id="tablePickerGrid" class="grid grid-cols-2 gap-3">
                <!-- Table cards will be inserted here by JavaScript -->
            </div>
        </div>
    </div>

    <script src="/assets/desktop-support.js" defer></script>
    <script src="pospalCore.js" defer></script>
</body>
</html>




