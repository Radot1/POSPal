<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POSPal Notification System Test Suite</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
            border: 1px solid rgba(255, 255, 255, 0.18);
        }

        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .test-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn.primary {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
        }

        .btn.primary:hover {
            background: linear-gradient(45deg, #ff5252, #d63031);
        }

        .test-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .status-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .status-card h3 {
            margin: 0 0 15px 0;
            font-size: 1.2em;
        }

        .status-indicator {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
        }

        .status-pending {
            background: rgba(255, 193, 7, 0.3);
            color: #ffc107;
        }

        .status-running {
            background: rgba(0, 123, 255, 0.3);
            color: #007bff;
            animation: pulse 2s infinite;
        }

        .status-passed {
            background: rgba(40, 167, 69, 0.3);
            color: #28a745;
        }

        .status-failed {
            background: rgba(220, 53, 69, 0.3);
            color: #dc3545;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .test-output {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            font-family: 'Courier New', monospace;
            max-height: 500px;
            overflow-y: auto;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .log-entry {
            margin-bottom: 5px;
            padding: 5px;
            border-radius: 3px;
        }

        .log-info { color: #17a2b8; }
        .log-pass { color: #28a745; background: rgba(40, 167, 69, 0.1); }
        .log-fail { color: #dc3545; background: rgba(220, 53, 69, 0.1); }
        .log-warn { color: #ffc107; background: rgba(255, 193, 7, 0.1); }
        .log-error { color: #dc3545; background: rgba(220, 53, 69, 0.2); font-weight: bold; }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #00c851, #007e33);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
        }

        .stat-value {
            font-size: 2em;
            font-weight: bold;
            display: block;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .notification-demo {
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            text-align: center;
        }

        .demo-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .footer {
            text-align: center;
            margin-top: 40px;
            opacity: 0.8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ POSPal Notification System Test Suite</h1>

        <div class="test-controls">
            <button class="btn primary" onclick="runAllTests()">üöÄ Run All Tests</button>
            <button class="btn" onclick="runCoreTests()">üîß Core Tests</button>
            <button class="btn" onclick="runMobileTests()">üì± Mobile Tests</button>
            <button class="btn" onclick="runPerformanceTests()">‚ö° Performance Tests</button>
            <button class="btn" onclick="clearOutput()">üßπ Clear Output</button>
        </div>

        <div class="test-status" id="testStatus">
            <div class="status-card">
                <h3>Core Functionality</h3>
                <div class="status-indicator status-pending" id="coreStatus">‚è≥</div>
                <div>Progressive warnings, offline indicators, z-index</div>
            </div>
            <div class="status-card">
                <h3>Mobile Features</h3>
                <div class="status-indicator status-pending" id="mobileStatus">‚è≥</div>
                <div>Touch targets, gestures, accessibility</div>
            </div>
            <div class="status-card">
                <h3>Advanced Intelligence</h3>
                <div class="status-indicator status-pending" id="intelligenceStatus">‚è≥</div>
                <div>A/B testing, behavior analysis, segmentation</div>
            </div>
            <div class="status-card">
                <h3>Performance</h3>
                <div class="status-indicator status-pending" id="performanceStatus">‚è≥</div>
                <div>Memory management, load testing, integration</div>
            </div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progressBar"></div>
        </div>

        <div class="summary-stats" id="summaryStats">
            <div class="stat-item">
                <span class="stat-value" id="totalTests">0</span>
                <span class="stat-label">Total Tests</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="passedTests">0</span>
                <span class="stat-label">Passed</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="failedTests">0</span>
                <span class="stat-label">Failed</span>
            </div>
            <div class="stat-item">
                <span class="stat-value" id="passRate">0%</span>
                <span class="stat-label">Pass Rate</span>
            </div>
        </div>

        <div class="notification-demo">
            <h3>üéÆ Live Notification Testing</h3>
            <div class="demo-controls">
                <button class="btn" onclick="demoToast('success')">‚úÖ Success Toast</button>
                <button class="btn" onclick="demoToast('warning')">‚ö†Ô∏è Warning Toast</button>
                <button class="btn" onclick="demoToast('error')">‚ùå Error Toast</button>
                <button class="btn" onclick="demoProgressiveWarning()">üì¢ Progressive Warning</button>
                <button class="btn" onclick="demoOfflineIndicator()">üì¥ Offline Indicator</button>
                <button class="btn" onclick="demoBanner()">üìã Interactive Banner</button>
            </div>
        </div>

        <div class="test-output" id="testOutput">
            <div class="log-entry log-info">üîÑ Test runner initialized. Click "Run All Tests" to start comprehensive testing.</div>
            <div class="log-entry log-info">üìã Test Suite Includes:</div>
            <div class="log-entry log-info">   ‚Ä¢ Core notification functionality (progressive warnings, offline indicators)</div>
            <div class="log-entry log-info">   ‚Ä¢ Mobile features (touch targets, gestures, accessibility)</div>
            <div class="log-entry log-info">   ‚Ä¢ Advanced intelligence (A/B testing, behavioral modeling)</div>
            <div class="log-entry log-info">   ‚Ä¢ Performance & integration testing</div>
            <div class="log-entry log-info">   ‚Ä¢ Memory leak prevention and error handling</div>
        </div>

        <div class="footer">
            <p>POSPal Notification System Testing Suite v1.0</p>
            <p>Testing 5-Phase Notification System Refactor</p>
        </div>
    </div>

    <!-- Notification System Components -->
    <script src="notification-manager.js"></script>
    <script src="customer-segmentation.js"></script>
    <script src="advanced-notification-intelligence.js"></script>
    <script src="pospalCore.js"></script>

    <!-- Test Suite Components -->
    <script src="test_notification_system.js"></script>
    <script src="test_mobile_features.js"></script>
    <script src="test_performance_integration.js"></script>

    <script>
        let currentTestRun = null;
        let allResults = {
            core: null,
            mobile: null,
            performance: null
        };

        // Update UI elements
        function updateStatus(component, status) {
            const statusElement = document.getElementById(component + 'Status');
            if (statusElement) {
                statusElement.className = 'status-indicator status-' + status;
                switch(status) {
                    case 'pending':
                        statusElement.textContent = '‚è≥';
                        break;
                    case 'running':
                        statusElement.textContent = 'üîÑ';
                        break;
                    case 'passed':
                        statusElement.textContent = '‚úÖ';
                        break;
                    case 'failed':
                        statusElement.textContent = '‚ùå';
                        break;
                }
            }
        }

        function updateProgress(percentage) {
            document.getElementById('progressBar').style.width = percentage + '%';
        }

        function updateStats(total, passed, failed) {
            document.getElementById('totalTests').textContent = total;
            document.getElementById('passedTests').textContent = passed;
            document.getElementById('failedTests').textContent = failed;
            document.getElementById('passRate').textContent = total > 0 ? ((passed / total * 100).toFixed(1) + '%') : '0%';
        }

        function logToOutput(message, type = 'info') {
            const output = document.getElementById('testOutput');
            const entry = document.createElement('div');
            entry.className = 'log-entry log-' + type;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            output.appendChild(entry);
            output.scrollTop = output.scrollHeight;
        }

        function clearOutput() {
            document.getElementById('testOutput').innerHTML = '';
            logToOutput('Output cleared', 'info');
        }

        // Test execution functions
        async function runAllTests() {
            logToOutput('üöÄ Starting comprehensive test suite...', 'info');
            clearResults();

            try {
                updateProgress(0);

                // Run core tests
                updateStatus('core', 'running');
                logToOutput('Starting core functionality tests...', 'info');
                const coreResults = await runCoreTestSuite();
                allResults.core = coreResults;
                updateStatus('core', coreResults.status === 'PASSED' ? 'passed' : 'failed');
                updateProgress(25);

                // Run mobile tests
                updateStatus('mobile', 'running');
                logToOutput('Starting mobile features tests...', 'info');
                const mobileResults = await runMobileTestSuite();
                allResults.mobile = mobileResults;
                updateStatus('mobile', mobileResults.mobileCompliant ? 'passed' : 'failed');
                updateProgress(50);

                // Run performance tests
                updateStatus('performance', 'running');
                logToOutput('Starting performance & integration tests...', 'info');
                const performanceResults = await runPerformanceTestSuite();
                allResults.performance = performanceResults;
                updateStatus('performance', performanceResults.status === 'PASSED' ? 'passed' : 'failed');
                updateProgress(75);

                // Update intelligence status based on performance results
                updateStatus('intelligence', performanceResults.status === 'PASSED' ? 'passed' : 'failed');
                updateProgress(100);

                // Generate final summary
                generateFinalSummary();

            } catch (error) {
                logToOutput(`‚ùå Test suite failed: ${error.message}`, 'error');
                updateProgress(100);
            }
        }

        async function runCoreTestSuite() {
            return new Promise((resolve) => {
                const tester = new NotificationSystemTester();

                // Override the log method to capture output
                const originalLog = tester.log.bind(tester);
                tester.log = function(message, type) {
                    originalLog(message, type);
                    logToOutput(message, type);
                };

                // Override the generate report method to capture results
                const originalGenerateReport = tester.generateFinalReport.bind(tester);
                tester.generateFinalReport = function() {
                    const results = originalGenerateReport();
                    resolve(results);
                    return results;
                };

                tester.runAllTests();
            });
        }

        async function runMobileTestSuite() {
            return new Promise((resolve) => {
                const tester = new MobileFeaturesTest();

                const originalLog = tester.log.bind(tester);
                tester.log = function(message, type, test) {
                    originalLog(message, type, test);
                    logToOutput(`[${test}] ${message}`, type);
                };

                const originalGenerateReport = tester.generateMobileReport.bind(tester);
                tester.generateMobileReport = function() {
                    const results = originalGenerateReport();
                    resolve(results);
                    return results;
                };

                tester.runMobileTests();
            });
        }

        async function runPerformanceTestSuite() {
            return new Promise((resolve) => {
                const tester = new PerformanceIntegrationTest();

                const originalLog = tester.log.bind(tester);
                tester.log = function(message, type, test) {
                    originalLog(message, type, test);
                    logToOutput(`[${test}] ${message}`, type);
                };

                const originalGenerateReport = tester.generatePerformanceReport.bind(tester);
                tester.generatePerformanceReport = function() {
                    const results = originalGenerateReport();
                    // Add status for compatibility
                    results.status = results.failedTests === 0 ? 'PASSED' : 'FAILED';
                    resolve(results);
                    return results;
                };

                tester.runPerformanceTests();
            });
        }

        function runCoreTests() {
            logToOutput('üîß Running core tests only...', 'info');
            runCoreTestSuite().then(results => {
                updateStats(results.totalTests, results.passedTests, results.failedTests);
                logToOutput(`Core tests completed: ${results.status}`, results.status === 'PASSED' ? 'pass' : 'fail');
            });
        }

        function runMobileTests() {
            logToOutput('üì± Running mobile tests only...', 'info');
            runMobileTestSuite().then(results => {
                updateStats(results.totalTests, results.passedTests, results.failedTests);
                logToOutput(`Mobile tests completed: ${results.mobileCompliant ? 'PASSED' : 'FAILED'}`, results.mobileCompliant ? 'pass' : 'fail');
            });
        }

        function runPerformanceTests() {
            logToOutput('‚ö° Running performance tests only...', 'info');
            runPerformanceTestSuite().then(results => {
                updateStats(results.totalTests, results.passedTests, results.failedTests);
                logToOutput(`Performance tests completed: ${results.status}`, results.status === 'PASSED' ? 'pass' : 'fail');
            });
        }

        function clearResults() {
            allResults = { core: null, mobile: null, performance: null };
            updateStats(0, 0, 0);
            updateProgress(0);
            ['core', 'mobile', 'intelligence', 'performance'].forEach(component => {
                updateStatus(component, 'pending');
            });
        }

        function generateFinalSummary() {
            const totalTests = (allResults.core?.totalTests || 0) +
                              (allResults.mobile?.totalTests || 0) +
                              (allResults.performance?.totalTests || 0);

            const totalPassed = (allResults.core?.passedTests || 0) +
                               (allResults.mobile?.passedTests || 0) +
                               (allResults.performance?.passedTests || 0);

            const totalFailed = (allResults.core?.failedTests || 0) +
                               (allResults.mobile?.failedTests || 0) +
                               (allResults.performance?.failedTests || 0);

            updateStats(totalTests, totalPassed, totalFailed);

            const passRate = totalTests > 0 ? (totalPassed / totalTests * 100).toFixed(1) : 0;

            logToOutput('', 'info');
            logToOutput('üèÅ FINAL SUMMARY', 'info');
            logToOutput('=' .repeat(50), 'info');
            logToOutput(`üìä Overall Results: ${totalPassed}/${totalTests} tests passed (${passRate}%)`, 'info');

            if (allResults.core) {
                logToOutput(`üîß Core: ${allResults.core.passedTests}/${allResults.core.totalTests} (${allResults.core.passRate}%)`,
                           allResults.core.status === 'PASSED' ? 'pass' : 'fail');
            }

            if (allResults.mobile) {
                logToOutput(`üì± Mobile: ${allResults.mobile.passedTests}/${allResults.mobile.totalTests} (${allResults.mobile.passRate}%)`,
                           allResults.mobile.mobileCompliant ? 'pass' : 'fail');
            }

            if (allResults.performance) {
                logToOutput(`‚ö° Performance: ${allResults.performance.passedTests}/${allResults.performance.totalTests} (${allResults.performance.passRate}%)`,
                           allResults.performance.status === 'PASSED' ? 'pass' : 'fail');
            }

            // Overall assessment
            if (totalFailed === 0) {
                logToOutput('üéâ EXCELLENT! All tests passed - System ready for production', 'pass');
            } else if (totalFailed <= 3) {
                logToOutput('‚ö†Ô∏è Good with minor issues - Review failed tests before deployment', 'warn');
            } else {
                logToOutput('‚ùå Critical issues detected - System needs attention before production', 'fail');
            }

            logToOutput('=' .repeat(50), 'info');
        }

        // Demo functions for live testing
        function demoToast(type) {
            const messages = {
                success: '‚úÖ Success! Operation completed successfully',
                warning: '‚ö†Ô∏è Warning: Please review your input',
                error: '‚ùå Error: Something went wrong',
                info: '‚ÑπÔ∏è Information: This is an info message'
            };

            if (window.NotificationManager) {
                window.NotificationManager.showToast(messages[type] || messages.info, type, 4000);
                logToOutput(`Demo: ${type} toast shown`, 'info');
            } else {
                logToOutput('NotificationManager not available', 'error');
            }
        }

        function demoProgressiveWarning() {
            if (typeof showSmartProgressiveWarning === 'function') {
                showSmartProgressiveWarning(8, 10); // Day 8 of 10-day grace period
                logToOutput('Demo: Progressive warning shown (day 8/10)', 'info');
            } else {
                logToOutput('Progressive warning function not available', 'error');
            }
        }

        function demoOfflineIndicator() {
            if (typeof showSmartOfflineIndicator === 'function') {
                showSmartOfflineIndicator(3, 7); // 3 days since last validation, 7-day grace
                logToOutput('Demo: Offline indicator shown', 'info');
            } else {
                logToOutput('Offline indicator function not available', 'error');
            }
        }

        function demoBanner() {
            if (window.NotificationManager) {
                window.NotificationManager.showBanner(
                    'üéÆ Interactive Demo Banner',
                    'This banner demonstrates the advanced notification system with multiple actions.',
                    [
                        {
                            id: 'primary',
                            label: '‚úÖ Primary Action',
                            handler: () => {
                                logToOutput('Demo: Primary action clicked', 'pass');
                                window.NotificationManager.showToast('Primary action executed!', 'success', 3000);
                            }
                        },
                        {
                            id: 'secondary',
                            label: 'üìã Secondary Action',
                            handler: () => {
                                logToOutput('Demo: Secondary action clicked', 'info');
                                window.NotificationManager.showToast('Secondary action executed!', 'info', 3000);
                            }
                        }
                    ]
                );
                logToOutput('Demo: Interactive banner shown', 'info');
            } else {
                logToOutput('NotificationManager not available', 'error');
            }
        }

        // Initialize when page loads
        window.addEventListener('load', () => {
            logToOutput('üéØ Test runner loaded successfully', 'pass');

            // Check system availability
            const requiredSystems = [
                'NotificationManager',
                'CustomerSegmentationManager',
                'AdvancedNotificationIntelligence',
                'TimerManager'
            ];

            let systemsReady = true;
            requiredSystems.forEach(system => {
                if (typeof window[system] !== 'undefined') {
                    logToOutput(`‚úÖ ${system} loaded`, 'pass');
                } else {
                    logToOutput(`‚ùå ${system} not found`, 'fail');
                    systemsReady = false;
                }
            });

            if (systemsReady) {
                logToOutput('üöÄ All notification systems ready for testing', 'pass');
            } else {
                logToOutput('‚ö†Ô∏è Some systems missing - tests may fail', 'warn');
            }
        });
    </script>
</body>
</html>