<!-- Shared Management Component -->
<!-- This file contains the management modal structure shared between POSPal variants -->

<!-- Login Modal -->
<div id="loginModal" class="fixed inset-0 bg-black bg-opacity-70 z-[90] hidden items-center justify-center p-4">
    <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-sm text-gray-800">
        <h3 class="text-xl font-semibold mb-4 text-center">Management Access</h3>
        <form id="loginForm">
            <div class="space-y-4">
                <div>
                    <label for="passwordInput" class="block text-sm font-medium text-gray-700">Password</label>
                    <input type="password" id="passwordInput" name="password" class="mt-1 block w-full px-3 py-2 border border-gray-400 rounded-md shadow-sm sm:text-sm" required>
                </div>
                <p id="loginError" class="text-sm text-red-600 text-center hidden"></p>
                <div class="flex gap-2 pt-2">
                    <button type="button" class="w-full py-2 px-4 btn-secondary" onclick="closeLoginModal()">Cancel</button>
                    <button type="submit" id="loginSubmitBtn" class="w-full py-2 px-4 btn-primary">Login</button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Item Option Select Modal -->
<div id="itemOptionSelectModal" class="fixed inset-0 bg-black bg-opacity-70 z-[60] hidden items-center justify-center p-4">
    <div class="bg-white rounded-lg shadow-xl p-5 w-full max-w-md max-h-[80vh] flex flex-col text-gray-800">
        <h3 id="optionModalItemName" class="text-lg font-semibold mb-1">Select Option</h3>
        <p id="optionModalItemDescription" class="text-sm text-gray-600 mb-3">Please choose an option for the selected item:</p>
        <div id="optionModalOptionsContainer" class="flex-grow overflow-y-auto space-y-2 mb-4 pr-1"></div>
        <div class="flex gap-2 mt-auto">
            <button type="button" class="w-full py-2 px-4 btn-secondary" onclick="cancelOptionSelection()">Cancel</button>
            <button type="button" id="confirmOptionBtn" class="w-full py-2 px-4 btn-primary" onclick="confirmOptionSelection()">Confirm</button>
        </div>
    </div>
</div>

<!-- Management Modal -->
<div id="managementModal" class="fixed inset-0 bg-black bg-opacity-50 z-[70] hidden flex flex-col justify-end sm:justify-center sm:items-center">
    <div class="bg-white shadow-xl w-full h-[90vh] sm:h-auto sm:max-h-[90vh] sm:max-w-6xl flex flex-col text-gray-800 rounded-t-2xl sm:rounded-lg">
        <div class="p-4 border-b border-gray-200 flex justify-between items-center flex-shrink-0">
            <h2 class="text-xl font-semibold">Management</h2>
            <button onclick="closeManagementModal()" class="text-gray-500 hover:text-black"><i class="fas fa-times text-2xl"></i></button>
        </div>
        <div class="p-2 border-b border-gray-200 management-tab-container flex-shrink-0">
            <div class="flex flex-wrap gap-1 rounded-md bg-gray-100 p-1">
                <button onclick="switchManagementTab('licensing', this)" class="management-tab flex-1 py-2 px-2 text-xs sm:text-sm font-medium rounded-md text-gray-600 hover:bg-gray-200">Licensing</button>
                <button onclick="switchManagementTab('analytics', this)" class="management-tab flex-1 py-2 px-2 text-xs sm:text-sm font-medium rounded-md text-gray-600 hover:bg-gray-200">Analytics</button>
                <button onclick="switchManagementTab('items', this)" class="management-tab flex-1 py-2 px-2 text-xs sm:text-sm font-medium rounded-md text-gray-600 hover:bg-gray-200">Items</button>
                <button onclick="switchManagementTab('categories', this)" class="management-tab flex-1 py-2 px-2 text-xs sm:text-sm font-medium rounded-md text-gray-600 hover:bg-gray-200">Categories</button>
                <button onclick="switchManagementTab('orderHistory', this)" class="management-tab flex-1 py-2 px-2 text-xs sm:text-sm font-medium rounded-md text-gray-600 hover:bg-gray-200">Order History</button>
                <button onclick="openDaySummaryModal()" class="flex-1 py-2 px-2 text-xs sm:text-sm font-medium rounded-md text-gray-600 hover:bg-gray-200 bg-blue-100">Day Summary</button>
            </div>
        </div>
        <div class="flex-grow overflow-y-auto p-4 management-content">
            <div id="licensingManagement" class="hidden">
                <!-- Comprehensive Licensing Dashboard -->
                <div class="space-y-6">
                    <!-- Dashboard Header -->
                    <div class="border-b border-gray-200 pb-4">
                        <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                            <div>
                                <h3 class="text-2xl font-bold text-gray-900">Licensing Dashboard</h3>
                                <p class="text-sm text-gray-600 mt-1">Monitor subscription status, customer insights, and manage your POSPal license</p>
                            </div>
                            <div class="flex items-center gap-2">
                                <div id="license-connection-indicator" class="flex items-center gap-2 px-3 py-1.5 rounded-full text-xs font-medium">
                                    <div class="w-2 h-2 rounded-full"></div>
                                    <span>Checking connection...</span>
                                </div>
                                <button id="refresh-license-btn" onclick="refreshLicenseStatus()" class="btn-secondary py-1.5 px-3 text-sm rounded-md flex items-center">
                                    <i class="fas fa-sync-alt mr-1.5"></i>Refresh
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Status Overview Cards -->
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <!-- Current Status Card -->
                        <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h4 class="text-sm font-medium text-gray-500 mb-1">Current Status</h4>
                                    <div id="dashboard-license-status" class="flex items-center gap-2">
                                        <span class="text-xl font-bold">Loading...</span>
                                        <div class="w-3 h-3 rounded-full bg-gray-300"></div>
                                    </div>
                                </div>
                                <div class="p-2 bg-blue-50 rounded-lg">
                                    <i class="fas fa-shield-alt text-blue-600 text-xl"></i>
                                </div>
                            </div>
                        </div>

                        <!-- Days Remaining Card -->
                        <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h4 class="text-sm font-medium text-gray-500 mb-1">Days Remaining</h4>
                                    <div id="dashboard-days-remaining" class="text-xl font-bold text-gray-900">Loading...</div>
                                    <div id="dashboard-grace-period" class="text-xs text-gray-500 mt-1 hidden">Grace period active</div>
                                </div>
                                <div class="p-2 bg-orange-50 rounded-lg">
                                    <i class="fas fa-calendar-alt text-orange-600 text-xl"></i>
                                </div>
                            </div>
                            <div class="mt-3">
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div id="dashboard-days-progress" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>

                        <!-- Customer Segment Card -->
                        <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h4 class="text-sm font-medium text-gray-500 mb-1">Customer Type</h4>
                                    <div id="dashboard-customer-segment" class="text-xl font-bold text-gray-900">Analyzing...</div>
                                    <div id="dashboard-segment-confidence" class="text-xs text-gray-500 mt-1">Confidence: 0%</div>
                                </div>
                                <div class="p-2 bg-green-50 rounded-lg">
                                    <i class="fas fa-user-tag text-green-600 text-xl"></i>
                                </div>
                            </div>
                        </div>

                        <!-- Next Billing Card -->
                        <div class="bg-white p-4 rounded-lg border border-gray-200 shadow-sm">
                            <div class="flex items-center justify-between">
                                <div>
                                    <h4 class="text-sm font-medium text-gray-500 mb-1">Next Billing</h4>
                                    <div id="dashboard-next-billing" class="text-xl font-bold text-gray-900">Not applicable</div>
                                    <div id="dashboard-billing-method" class="text-xs text-gray-500 mt-1">Payment method</div>
                                </div>
                                <div class="p-2 bg-purple-50 rounded-lg">
                                    <i class="fas fa-credit-card text-purple-600 text-xl"></i>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Main Dashboard Content -->
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <!-- Left Column: Status Details & Customer Intelligence -->
                        <div class="lg:col-span-2 space-y-6">
                            <!-- Detailed Status Section -->
                            <div class="bg-white p-6 rounded-lg border border-gray-200 shadow-sm">
                                <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                    <i class="fas fa-info-circle text-blue-600 mr-2"></i>
                                    License Details
                                </h4>
                                <div id="license-details-content" class="space-y-4">
                                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                        <div>
                                            <label class="text-sm font-medium text-gray-500">Customer Email</label>
                                            <div id="dashboard-customer-email" class="text-sm text-gray-900 mt-1">Loading...</div>
                                        </div>
                                        <div>
                                            <label class="text-sm font-medium text-gray-500">Customer Name</label>
                                            <div id="dashboard-customer-name" class="text-sm text-gray-900 mt-1">Loading...</div>
                                        </div>
                                        <div>
                                            <label class="text-sm font-medium text-gray-500">Last Validation</label>
                                            <div id="dashboard-last-validation" class="text-sm text-gray-900 mt-1">Never</div>
                                        </div>
                                        <div>
                                            <label class="text-sm font-medium text-gray-500">Connection Status</label>
                                            <div id="dashboard-connection-status" class="text-sm text-gray-900 mt-1">Offline</div>
                                        </div>
                                    </div>
                                    <div class="border-t border-gray-200 pt-4">
                                        <label class="text-sm font-medium text-gray-500">Hardware ID</label>
                                        <div class="flex items-center gap-2 mt-1">
                                            <code id="dashboard-hardware-id" class="text-xs font-mono bg-gray-100 px-2 py-1 rounded flex-1">Loading...</code>
                                            <button onclick="copyHardwareIdFromDashboard()" class="btn-secondary py-1 px-2 text-xs">
                                                <i class="far fa-copy mr-1"></i>Copy
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Customer Intelligence Section -->
                            <div class="bg-white p-6 rounded-lg border border-gray-200 shadow-sm">
                                <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                    <i class="fas fa-brain text-purple-600 mr-2"></i>
                                    Customer Intelligence
                                </h4>
                                <div id="customer-intelligence-content" class="space-y-4">
                                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                        <div class="bg-gradient-to-r from-blue-50 to-purple-50 p-4 rounded-lg">
                                            <h5 class="text-sm font-semibold text-gray-700 mb-2">Segmentation Analysis</h5>
                                            <div id="segment-analysis" class="text-sm text-gray-600">
                                                Analyzing customer profile...
                                            </div>
                                        </div>
                                        <div class="bg-gradient-to-r from-green-50 to-blue-50 p-4 rounded-lg">
                                            <h5 class="text-sm font-semibold text-gray-700 mb-2">Retention Strategy</h5>
                                            <div id="retention-strategy" class="text-sm text-gray-600">
                                                Calculating optimal approach...
                                            </div>
                                        </div>
                                    </div>
                                    <div class="bg-gray-50 p-4 rounded-lg">
                                        <h5 class="text-sm font-semibold text-gray-700 mb-3">Personalized Insights</h5>
                                        <div id="personalized-insights" class="space-y-2">
                                            <div class="flex items-center gap-2 text-sm text-gray-600">
                                                <i class="fas fa-chart-line text-blue-500"></i>
                                                <span>Loading behavioral analytics...</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Analytics & Usage Section -->
                            <div class="bg-white p-6 rounded-lg border border-gray-200 shadow-sm">
                                <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                    <i class="fas fa-chart-bar text-green-600 mr-2"></i>
                                    Usage Analytics
                                </h4>
                                <div id="usage-analytics-content" class="space-y-4">
                                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-4">
                                        <div class="text-center p-3 bg-gray-50 rounded-lg">
                                            <div id="analytics-daily-usage" class="text-xl font-bold text-gray-900">0h</div>
                                            <div class="text-xs text-gray-500">Daily Usage</div>
                                        </div>
                                        <div class="text-center p-3 bg-gray-50 rounded-lg">
                                            <div id="analytics-features-used" class="text-xl font-bold text-gray-900">0</div>
                                            <div class="text-xs text-gray-500">Features Used</div>
                                        </div>
                                        <div class="text-center p-3 bg-gray-50 rounded-lg">
                                            <div id="analytics-monthly-orders" class="text-xl font-bold text-gray-900">0</div>
                                            <div class="text-xs text-gray-500">Monthly Orders</div>
                                        </div>
                                        <div class="text-center p-3 bg-gray-50 rounded-lg">
                                            <div id="analytics-account-age" class="text-xl font-bold text-gray-900">0d</div>
                                            <div class="text-xs text-gray-500">Account Age</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Right Column: Action Center & Support -->
                        <div class="space-y-6">
                            <!-- Action Center -->
                            <div class="bg-white p-6 rounded-lg border border-gray-200 shadow-sm">
                                <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                    <i class="fas fa-tools text-orange-600 mr-2"></i>
                                    Action Center
                                </h4>
                                <div id="action-center-content" class="space-y-3">
                                    <!-- Primary Actions -->
                                    <div class="space-y-2">
                                        <button id="action-update-payment" onclick="openPaymentUpdate()" class="w-full btn-primary py-2 px-3 text-sm rounded-md flex items-center justify-center hidden">
                                            <i class="fas fa-credit-card mr-2"></i>
                                            Update Payment Method
                                        </button>
                                        <button id="action-validate-license" onclick="validateLicenseNow()" class="w-full btn-secondary py-2 px-3 text-sm rounded-md flex items-center justify-center">
                                            <i class="fas fa-check-circle mr-2"></i>
                                            Validate License Now
                                        </button>
                                        <button id="action-buy-license" onclick="openLicensePurchase()" class="w-full btn-success py-2 px-3 text-sm rounded-md flex items-center justify-center">
                                            <i class="fas fa-shopping-cart mr-2"></i>
                                            Purchase License
                                        </button>
                                    </div>
                                    <div class="border-t border-gray-200 pt-3">
                                        <div class="text-xs text-gray-500 mb-2">Customer Portal</div>
                                        <button id="action-customer-portal" onclick="openCustomerPortal()" class="w-full btn-outline py-2 px-3 text-sm rounded-md flex items-center justify-center">
                                            <i class="fas fa-external-link-alt mr-2"></i>
                                            Manage Account
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Support & Contact -->
                            <div class="bg-white p-6 rounded-lg border border-gray-200 shadow-sm">
                                <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                    <i class="fas fa-headset text-blue-600 mr-2"></i>
                                    Support & Contact
                                </h4>
                                <div id="support-content" class="space-y-4">
                                    <div class="bg-blue-50 p-3 rounded-lg">
                                        <div class="text-sm font-medium text-blue-800 mb-1">Recommended Support Level</div>
                                        <div id="recommended-support" class="text-xs text-blue-600">Standard Support</div>
                                    </div>
                                    <div class="space-y-2">
                                        <button id="support-contact" onclick="contactSupport()" class="w-full btn-outline py-2 px-3 text-sm rounded-md flex items-center justify-center">
                                            <i class="fas fa-envelope mr-2"></i>
                                            Contact Support
                                        </button>
                                        <button onclick="openDocumentation()" class="w-full btn-outline py-2 px-3 text-sm rounded-md flex items-center justify-center">
                                            <i class="fas fa-book mr-2"></i>
                                            Documentation
                                        </button>
                                        <button onclick="reportIssue()" class="w-full btn-outline py-2 px-3 text-sm rounded-md flex items-center justify-center">
                                            <i class="fas fa-bug mr-2"></i>
                                            Report Issue
                                        </button>
                                    </div>
                                    <div class="border-t border-gray-200 pt-3">
                                        <div class="text-xs text-gray-500 mb-2">Emergency Contact</div>
                                        <div id="emergency-contact-info" class="text-xs text-gray-600">
                                            Available for power users and loyal customers
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Recent Activity -->
                            <div class="bg-white p-6 rounded-lg border border-gray-200 shadow-sm">
                                <h4 class="text-lg font-semibold text-gray-900 mb-4 flex items-center">
                                    <i class="fas fa-history text-gray-600 mr-2"></i>
                                    Recent Activity
                                </h4>
                                <div id="recent-activity-content" class="space-y-3">
                                    <div class="text-sm text-gray-500 text-center py-4">
                                        Loading activity history...
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Advanced Settings (Expandable) -->
                    <div class="bg-white rounded-lg border border-gray-200 shadow-sm">
                        <button id="toggle-advanced-settings" onclick="toggleAdvancedSettings()" class="w-full p-4 flex items-center justify-between text-left hover:bg-gray-50">
                            <h4 class="text-lg font-semibold text-gray-900 flex items-center">
                                <i class="fas fa-cog text-gray-600 mr-2"></i>
                                Advanced Settings
                            </h4>
                            <i class="fas fa-chevron-down text-gray-400 transform transition-transform" id="advanced-settings-icon"></i>
                        </button>
                        <div id="advanced-settings-content" class="hidden border-t border-gray-200 p-6">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <h5 class="text-sm font-semibold text-gray-700 mb-3">License Management</h5>
                                    <div class="space-y-2">
                                        <button onclick="clearLicenseCache()" class="w-full btn-outline py-2 px-3 text-sm rounded-md text-left">
                                            <i class="fas fa-eraser mr-2"></i>
                                            Clear License Cache
                                        </button>
                                        <button onclick="forceLicenseRevalidation()" class="w-full btn-outline py-2 px-3 text-sm rounded-md text-left">
                                            <i class="fas fa-redo mr-2"></i>
                                            Force Revalidation
                                        </button>
                                        <button onclick="exportLicenseData()" class="w-full btn-outline py-2 px-3 text-sm rounded-md text-left">
                                            <i class="fas fa-download mr-2"></i>
                                            Export License Data
                                        </button>
                                    </div>
                                </div>
                                <div>
                                    <h5 class="text-sm font-semibold text-gray-700 mb-3">Notification Settings</h5>
                                    <div class="space-y-2">
                                        <label class="flex items-center">
                                            <input type="checkbox" id="enable-license-notifications" class="mr-2">
                                            <span class="text-sm text-gray-700">Enable license notifications</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="enable-payment-reminders" class="mr-2">
                                            <span class="text-sm text-gray-700">Enable payment reminders</span>
                                        </label>
                                        <label class="flex items-center">
                                            <input type="checkbox" id="enable-grace-period-alerts" class="mr-2">
                                            <span class="text-sm text-gray-700">Enable grace period alerts</span>
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <!-- Device Management Section -->
                            <div class="mt-4 border-t border-gray-300 pt-4">
                                <h5 class="text-sm font-semibold text-gray-700 mb-3">Device Management</h5>
                                <div class="space-y-2">
                                    <button onclick="showDisconnectLicenseModal()"
                                            id="disconnect-license-btn"
                                            class="w-full btn-outline py-2 px-3 text-sm rounded-md text-left text-red-600 hover:bg-red-50 border-red-300 transition-colors">
                                        <i class="fas fa-unlink mr-2"></i>
                                        Disconnect License from This Device
                                    </button>
                                    <p class="text-xs text-gray-500 mt-1">
                                        Remove license activation from this device to use it on another computer
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="analyticsManagement" class="hidden">
                <div class="flex flex-col sm:flex-row justify-between sm:items-center mb-4 gap-4">
                    <h3 class="text-xl font-semibold text-gray-800">Performance Overview</h3>
                    <div class="flex items-center gap-1 bg-gray-100 p-1 rounded-lg flex-wrap">
                        <button onclick="loadAnalyticsData('today', this)" class="date-range-btn flex-grow text-sm px-3 py-1.5 rounded-md transition-colors">Today</button>
                        <button onclick="loadAnalyticsData('week', this)" class="date-range-btn flex-grow text-sm px-3 py-1.5 rounded-md transition-colors">This Week</button>
                        <button onclick="loadAnalyticsData('month', this)" class="date-range-btn flex-grow text-sm px-3 py-1.5 rounded-md transition-colors">This Month</button>
                        <button onclick="toggleCustomDateRangeUI(this)" class="date-range-btn flex-grow text-sm px-3 py-1.5 rounded-md transition-colors">Custom</button>
                    </div>
                </div>
                <div id="custom-date-range-picker" class="hidden my-4 p-4 bg-gray-100 rounded-lg border border-gray-200">
                    <div class="flex flex-col sm:flex-row items-center gap-4">
                        <div>
                            <label for="startDate" class="block text-sm font-medium text-gray-700">Start Date</label>
                            <input type="date" id="startDate" name="startDate" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm sm:text-sm">
                        </div>
                        <div>
                            <label for="endDate" class="block text-sm font-medium text-gray-700">End Date</label>
                            <input type="date" id="endDate" name="endDate" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm sm:text-sm">
                        </div>
                        <div class="self-end pt-1 sm:pt-0">
                            <button onclick="fetchCustomDateRangeAnalytics()" class="w-full sm:w-auto py-2 px-4 btn-primary rounded-md">Go</button>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                    <div class="bg-gray-50 p-4 rounded-lg shadow"><h4 class="text-sm font-medium text-gray-500">Gross Revenue</h4><p id="kpi-gross-revenue" class="text-3xl font-bold text-gray-900 mt-1">‚Ç¨0.00</p></div>
                    <div class="bg-gray-50 p-4 rounded-lg shadow"><h4 class="text-sm font-medium text-gray-500">Total Orders</h4><p id="kpi-total-orders" class="text-3xl font-bold text-gray-900 mt-1">0</p></div>
                    <div class="bg-gray-50 p-4 rounded-lg shadow"><h4 class="text-sm font-medium text-gray-500">Avg. Order Value</h4><p id="kpi-atv" class="text-3xl font-bold text-gray-900 mt-1">‚Ç¨0.00</p></div>
                    <div class="bg-gray-50 p-4 rounded-lg shadow"><h4 class="font-semibold text-gray-700 mb-2">Payment Methods</h4><div class="space-y-2 mt-3"><div class="flex justify-between items-center"><span class="text-sm text-gray-600"><i class="fas fa-money-bill-wave mr-2 text-green-500"></i>Cash</span><span id="kpi-payment-cash" class="font-bold text-gray-800">‚Ç¨0.00</span></div><div class="flex justify-between items-center"><span class="text-sm text-gray-600"><i class="far fa-credit-card mr-2 text-blue-500"></i>Card</span><span id="kpi-payment-card" class="font-bold text-gray-800">‚Ç¨0.00</span></div></div></div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                    <div class="bg-white p-4 rounded-lg border lg:col-span-2"><h4 class="font-semibold text-gray-700 mb-3">Sales by Hour</h4><div class="overflow-x-auto pb-2"><div id="analytics-chart-container" class="h-64 flex items-end space-x-4"><p class="text-xs text-gray-500 italic w-full text-center">Loading chart data...</p></div></div></div>
                    <div class="bg-white p-4 rounded-lg border"><h4 class="font-semibold text-gray-700 mb-2">Sales by Category</h4><div id="kpi-sales-by-category" class="space-y-2 max-h-64 overflow-y-auto"><p class="text-xs text-gray-500 italic">Loading data...</p></div></div>
                    <div class="bg-white p-4 rounded-lg border"><h4 class="font-semibold text-gray-700 mb-2">Top Items (by Revenue)</h4><div id="kpi-top-revenue-items" class="space-y-2 max-h-48 overflow-y-auto"><p class="text-xs text-gray-500 italic">Loading data...</p></div></div>
                    <div class="bg-white p-4 rounded-lg border"><h4 class="font-semibold text-gray-700 mb-2">Best Selling Items (by Qty)</h4><div id="kpi-best-sellers" class="space-y-2 max-h-48 overflow-y-auto"><p class="text-xs text-gray-500 italic">Loading data...</p></div></div>
                    <div class="bg-white p-4 rounded-lg border"><h4 class="font-semibold text-gray-700 mb-2">Underperforming Items (by Qty)</h4><div id="kpi-worst-sellers" class="space-y-2 max-h-48 overflow-y-auto"><p class="text-xs text-gray-500 italic">Loading data...</p></div></div>
                </div>
            </div>
            <div id="itemsManagement" class="hidden">
                <div class="flex justify-end mb-4"><button onclick="openItemFormModal()" class="btn-success py-2 px-4 rounded-md flex items-center"><i class="fas fa-plus mr-2"></i>Add New Item</button></div>
                <h4 class="text-md font-medium text-gray-800 mb-2">Existing Items</h4>
                <div id="existingItemsListModal" class="space-y-3 pr-2 border border-gray-200 rounded-md p-2 bg-gray-50"><p class="text-xs text-gray-500 italic">No items found.</p></div>
            </div>
            <div id="categoriesManagement" class="hidden">
                <form id="categoryManagementForm" class="space-y-4 management-form">
                    <div><label for="categoryName" class="block text-sm font-medium text-gray-700">Category Name</label><input type="text" id="categoryName" name="categoryName" class="mt-1 block w-full px-3 py-2 border border-gray-400 rounded-md shadow-sm sm:text-sm" required></div>
                    <button type="button" onclick="saveCategory()" class="w-full py-2 px-4 btn-success">üìÅ Save Category</button>
                </form>
                <div class="mt-6">
                    <h4 class="text-md font-medium text-gray-800 mb-2">Existing Categories</h4>
                    <div id="existingCategoriesListModal" class="space-y-2 max-h-72 overflow-y-auto pr-1 border border-gray-200 rounded-md p-2 bg-gray-50"><p class="text-xs text-gray-500 italic">No categories found.</p></div>
                </div>
            </div>
            <div id="orderHistoryManagement" class="hidden">
                <h3 class="text-lg font-semibold text-gray-800 mb-3">Today's Orders</h3>
                <button onclick="loadTodaysOrdersForReprint()" class="mb-4 px-4 py-2 btn-secondary text-sm"><i class="fas fa-sync-alt mr-1"></i> Refresh List</button>
                <div id="todaysOrdersList" class="space-y-2 max-h-[60vh] overflow-y-auto pr-1 border border-gray-200 rounded-md p-2 bg-gray-50"><p class="text-xs text-gray-500 italic">Loading today's orders...</p></div>
            </div>
        </div>
        <div id="appVersionContainer" class="p-3 border-t border-gray-200 bg-gray-50 flex justify-between items-center text-xs text-gray-500 flex-shrink-0 rounded-b-lg">
            <div class="flex items-center gap-4 flex-wrap"><span>POSPal Version: <span id="appVersion" class="font-medium text-gray-600">1.0.0</span></span><span id="footer-trial-status" class="font-medium"></span><button onclick="switchManagementTab('licensing', this)" class="text-gray-500 hover:text-gray-800 hover:underline focus:outline-none focus:ring-2 focus:ring-gray-400 rounded px-1">Licensing Dashboard</button></div>
            <button onclick="shutdownApplication()" class="btn-danger text-white py-1 px-3 rounded-md flex items-center text-xs font-semibold"><i class="fas fa-power-off mr-1.5"></i><span>Shutdown</span></button>
        </div>
    </div>
</div>

<!-- Item Form Modal -->
<div id="itemFormModal" class="fixed inset-0 bg-black bg-opacity-70 z-[80] hidden items-center justify-center p-4">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col">
        <div class="p-4 border-b border-gray-300 flex justify-between items-center"><h2 id="itemFormModalTitle" class="text-xl font-semibold">Add/Edit Item</h2><button onclick="closeItemFormModal()" class="text-gray-500 hover:text-black"><i class="fas fa-times text-2xl"></i></button></div>
        <div class="flex-grow overflow-y-auto p-4">
            <form id="itemManagementForm" class="space-y-4 management-form">
                <input type="hidden" id="itemId" name="itemId">
                <div class="grid gap-4 md:grid-cols-2">
                    <div><label for="itemName" class="block text-sm font-medium text-gray-700">Item Name</label><input type="text" id="itemName" name="itemName" class="mt-1 block w-full px-3 py-2 border border-gray-400 rounded-md shadow-sm sm:text-sm" required></div>
                    <div><label for="itemPrice" class="block text-sm font-medium text-gray-700">Base Price (‚Ç¨)</label><input type="number" step="0.01" id="itemPrice" name="itemPrice" inputmode="decimal" class="mt-1 block w-full px-3 py-2 border border-gray-400 rounded-md shadow-sm sm:text-sm" required></div>
                </div>
                <div><label for="itemCategory" class="block text-sm font-medium text-gray-700">Category</label><select id="itemCategory" name="itemCategory" class="mt-1 block w-full px-3 py-2 border border-gray-400 bg-white rounded-md shadow-sm sm:text-sm" required></select></div>
                <div class="space-y-4">
                    <div class="flex items-center space-x-4"><div class="flex items-center"><input type="checkbox" id="itemHasOptionsModal" name="itemHasOptionsModal" onchange="toggleItemOptionsUIInModal()" class="h-4 w-4 text-black border-gray-400 rounded focus:ring-black accent-black"><label for="itemHasOptionsModal" class="ml-2 block text-sm text-gray-800">Has General Options</label></div></div>
                    <div id="itemOptionsModalContainer" class="hidden space-y-3 p-3 border border-gray-300 rounded-md bg-gray-50">
                        <label class="block text-sm font-medium text-gray-700">General Item Options:</label>
                        <div id="itemOptionsListDisplayModal" class="flex flex-wrap gap-2 mb-2 min-h-[40px] border border-gray-200 p-2 rounded-md bg-white"><p class="text-xs text-gray-500 italic w-full">No general options added</p></div>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-2 items-end">
                            <div class="md:col-span-2"><label for="newOptionNameInputModal" class="block text-xs font-medium text-gray-600">Option Name</label><input type="text" id="newOptionNameInputModal" placeholder="e.g., Peppercorn Sauce" class="mt-1 w-full px-3 py-2 border border-gray-400 rounded-md shadow-sm sm:text-sm"></div>
                            <div><label for="newOptionPriceInputModal" class="block text-xs font-medium text-gray-600">Price Change (‚Ç¨)</label><input type="number" step="0.01" id="newOptionPriceInputModal" placeholder="e.g., 2.00 or -0.50" inputmode="decimal" class="mt-1 w-full px-3 py-2 border border-gray-400 rounded-md shadow-sm sm:text-sm"></div>
                        </div>
                        <button type="button" onclick="addOptionToItemFormTempModal()" class="mt-2 px-4 py-2 btn-secondary text-sm w-full md:w-auto">Add Option</button>
                    </div>
                </div>
                <div class="flex gap-2 pt-4 border-t border-gray-200">
                    <button type="button" id="saveItemBtn" onclick="saveItem()" class="w-full py-2 px-4 btn-success">Save</button>
                    <button type="button" onclick="closeItemFormModal()" class="w-full py-2 px-4 btn-secondary">Cancel</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Day Summary Modal -->
<div id="daySummaryModal" class="fixed inset-0 bg-black bg-opacity-70 z-[80] hidden items-center justify-center p-4">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-md flex flex-col text-gray-800">
        <div class="p-4 border-b border-gray-300 flex justify-between items-center"><h2 class="text-xl font-semibold">Day Summary</h2><button onclick="closeDaySummaryModal()" class="text-gray-500 hover:text-black"><i class="fas fa-times text-2xl"></i></button></div>
        <div id="daySummaryContent" class="p-6 space-y-4"><p class="text-center italic">Loading summary...</p></div>
    </div>
</div>

<!-- License Disconnect Warning Modal -->
<div id="disconnectLicenseModal" class="fixed inset-0 bg-black bg-opacity-70 z-[80] hidden items-center justify-center p-4">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-lg flex flex-col text-gray-800">
        <div class="p-4 border-b border-gray-300 flex justify-between items-center">
            <h2 class="text-xl font-semibold text-red-600 flex items-center">
                <i class="fas fa-exclamation-triangle mr-2"></i>
                Disconnect License
            </h2>
            <button onclick="closeDisconnectLicenseModal()" class="text-gray-500 hover:text-black">
                <i class="fas fa-times text-2xl"></i>
            </button>
        </div>
        <div class="p-6 space-y-4">
            <!-- Warning Banner -->
            <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded">
                <div class="flex">
                    <i class="fas fa-exclamation-circle text-yellow-600 mt-0.5 mr-3"></i>
                    <div>
                        <h3 class="text-sm font-semibold text-yellow-800">Important: Read Before Proceeding</h3>
                        <p class="text-sm text-yellow-700 mt-1">
                            This will remove your license activation from this device. You can use it on another computer afterward.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Current License Info -->
            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                <h4 class="text-sm font-semibold text-gray-700 mb-2">Current License Information</h4>
                <div class="space-y-2 text-sm">
                    <div class="flex justify-between">
                        <span class="text-gray-600">Email:</span>
                        <span id="disconnect-modal-email" class="font-medium text-gray-900">Loading...</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Device:</span>
                        <span id="disconnect-modal-device" class="font-medium text-gray-900">This Computer</span>
                    </div>
                </div>
            </div>

            <!-- What Will Happen -->
            <div class="space-y-2">
                <h4 class="text-sm font-semibold text-gray-700">What will happen:</h4>
                <ul class="text-sm space-y-1">
                    <li class="flex items-start">
                        <i class="fas fa-check text-green-600 mt-1 mr-2"></i>
                        <span class="text-gray-700">Cloud session will be ended immediately</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-check text-green-600 mt-1 mr-2"></i>
                        <span class="text-gray-700">Local license files will be cleared</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-check text-green-600 mt-1 mr-2"></i>
                        <span class="text-gray-700">App will restart in trial mode</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-check text-green-600 mt-1 mr-2"></i>
                        <span class="text-gray-700">You can activate on another device</span>
                    </li>
                </ul>
            </div>

            <!-- What Will Be Preserved -->
            <div class="space-y-2">
                <h4 class="text-sm font-semibold text-gray-700">What will be preserved:</h4>
                <ul class="text-sm space-y-1">
                    <li class="flex items-start">
                        <i class="fas fa-shield-alt text-blue-600 mt-1 mr-2"></i>
                        <span class="text-gray-700">Your subscription remains active</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-shield-alt text-blue-600 mt-1 mr-2"></i>
                        <span class="text-gray-700">Menu items and categories</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-shield-alt text-blue-600 mt-1 mr-2"></i>
                        <span class="text-gray-700">Order history and analytics</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-shield-alt text-blue-600 mt-1 mr-2"></i>
                        <span class="text-gray-700">Your unlock token (shown after disconnect)</span>
                    </li>
                </ul>
            </div>

            <!-- Confirmation Checkbox -->
            <div class="bg-red-50 border border-red-200 p-4 rounded-lg">
                <label class="flex items-start cursor-pointer">
                    <input type="checkbox" id="disconnect-confirm-checkbox" class="mt-1 mr-3 h-4 w-4 text-red-600 border-gray-300 rounded">
                    <span class="text-sm text-gray-700">
                        I understand that this will disconnect my license from this device and the app will restart. I have my unlock token saved.
                    </span>
                </label>
            </div>

            <!-- Action Buttons -->
            <div class="flex gap-2 pt-2">
                <button type="button" onclick="closeDisconnectLicenseModal()" class="w-full py-2 px-4 btn-secondary">
                    Cancel
                </button>
                <button type="button" id="confirm-disconnect-btn" onclick="confirmDisconnectLicense()"
                        class="w-full py-2 px-4 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:bg-gray-300 disabled:cursor-not-allowed"
                        disabled>
                    <i class="fas fa-unlink mr-2"></i>
                    Disconnect License
                </button>
            </div>
        </div>
    </div>
</div>

<!-- License Disconnect Success Modal -->
<div id="disconnectSuccessModal" class="fixed inset-0 bg-black bg-opacity-70 z-[90] flex items-center justify-center p-4" style="display: none;">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-lg flex flex-col text-gray-800">
        <div class="p-4 border-b border-gray-300 flex justify-between items-center">
            <h2 class="text-xl font-semibold text-green-600 flex items-center">
                <i class="fas fa-check-circle mr-2"></i>
                License Disconnected Successfully
            </h2>
        </div>
        <div class="p-6 space-y-4">
            <!-- Success Message -->
            <div class="bg-green-50 border-l-4 border-green-400 p-4 rounded">
                <div class="flex">
                    <i class="fas fa-check-circle text-green-600 text-xl mt-0.5 mr-3"></i>
                    <div>
                        <h3 class="text-sm font-semibold text-green-800">Disconnection Complete</h3>
                        <p class="text-sm text-green-700 mt-1">
                            Your license has been successfully disconnected from this device.
                        </p>
                    </div>
                </div>
            </div>

            <!-- Unlock Token Display -->
            <div class="bg-gray-50 p-4 rounded-lg border border-gray-200">
                <h4 class="text-sm font-semibold text-gray-700 mb-2">Your Unlock Token</h4>
                <p class="text-xs text-gray-600 mb-3">
                    Save this token to activate your license on another device:
                </p>
                <div class="flex items-center gap-2">
                    <code id="disconnect-unlock-token" class="flex-1 text-sm font-mono bg-white px-3 py-2 rounded border border-gray-300 text-gray-900">
                        Loading...
                    </code>
                    <button onclick="copyDisconnectToken()" class="btn-secondary py-2 px-3 text-sm whitespace-nowrap">
                        <i class="far fa-copy mr-1"></i>Copy
                    </button>
                </div>
            </div>

            <!-- Next Steps -->
            <div class="space-y-2">
                <h4 class="text-sm font-semibold text-gray-700">Next Steps:</h4>
                <ol class="text-sm space-y-2 list-decimal list-inside">
                    <li class="text-gray-700">Copy your unlock token (shown above)</li>
                    <li class="text-gray-700">Install POSPal on your new device</li>
                    <li class="text-gray-700">Enter your email and unlock token to activate</li>
                    <li class="text-gray-700">Your subscription will continue seamlessly</li>
                </ol>
            </div>

            <!-- Restart Info -->
            <div class="bg-blue-50 border border-blue-200 p-4 rounded-lg text-center">
                <p class="text-sm text-gray-700 mb-2">
                    The application will restart automatically in:
                </p>
                <div id="restart-countdown" class="text-3xl font-bold text-blue-600">30</div>
                <p class="text-xs text-gray-500 mt-2">seconds</p>
            </div>

            <!-- Manual Restart Button -->
            <button type="button" onclick="restartAppNow()" class="w-full py-2 px-4 btn-primary">
                <i class="fas fa-sync-alt mr-2"></i>
                Restart Now
            </button>
        </div>
    </div>
</div> 