<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>POSPal - Desktop</title>
    <script src="./static/vendor/tailwindcdn.js"></script>
    <link rel="stylesheet" href="./static/css/fonts.css">
    <link rel="stylesheet" href="./static/vendor/fontawesome/css/all.min.css">
    <link rel="stylesheet" href="/assets/desktop-support.css">
    <style>
        body {
            font-family: 'Inter', system-ui, -apple-system, 'Segoe UI', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-thumb { background-color: #9ca3af; border-radius: 4px; }
        ::-webkit-scrollbar-track { background: #e5e7eb; }
        .product-card h3 {
            display: -webkit-box;
            -webkit-box-orient: vertical;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            overflow: hidden;
            text-overflow: ellipsis;
            min-height: 2.5em;
        }
        .options-badge {
            font-size: 0.65em;
            font-weight: 500;
            background-color: #4b5563;
            color: white;
            padding: 2px 5px;
            border-radius: 3px;
            margin-left: 8px;
            white-space: nowrap;
            align-self: center;
        }
        .option-pill {
            display: inline-flex;
            align-items: center;
            background-color: #4b5563;
            color: white;
            padding: 0.4rem 0.8rem;
            border-radius: 16px;
            font-size: 0.9em;
            line-height: 1;
        }
        .option-pill .remove-option-btn {
            background: none;
            border: none;
            color: white;
            margin-left: 0.6rem;
            cursor: pointer;
            font-size: 1.2em;
            padding: 0;
            line-height: 0.5;
            font-weight: bold;
        }
        .option-pill .remove-option-btn:hover { color: #d1d5db; }
        .option-selectable.selected {
            border-color: #111827 !important;
            background-color: #f3f4f6;
        }
        .date-range-btn.active {
            background-color: #111827;
            color: white;
            font-weight: 600;
        }
        .copy-btn {
            background-color: #d1d5db;
            color: #1f2937;
            border: 1px solid #9ca3af;
            padding: 0.25rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .copy-btn:hover { background-color: #9ca3af; }
        
        /* Consistent Color Scheme */
        .btn-primary { background-color: #111827; color: white; }
        .btn-primary:hover { background-color: #1f2937; }
        .btn-primary:disabled { background-color: #6b7280; cursor: not-allowed; }
        .btn-secondary { background-color: #e5e7eb; color: #1f2937; border: 1px solid #d1d5db; }
        .btn-secondary:hover { background-color: #d1d5db; }
        .btn-danger { background-color: #ef4444; color: white; }
        .btn-danger:hover { background-color: #dc2626; }
        .btn-warning { background-color: #f59e0b; color: white; }
        .btn-warning:hover { background-color: #d97706; }
        .btn-success { background-color: #16a34a; color: white; }
        .btn-success:hover { background-color: #15803d; }
        .category-tab {
            background-color: #f3f4f6;
            color: #374151;
            border: 1px solid #d1d5db;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            margin-right: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .category-tab:hover {
            background-color: #e5e7eb;
            border-color: #9ca3af;
        }
        .category-tab.active {
            background-color: #111827;
            color: white;
            border-color: #111827;
        }
        .order-item.selected-for-numpad {
            background-color: #e5e7eb;
            border-left: 3px solid #374151;
        }
        input:focus, select:focus, textarea:focus {
            border-color: #111827;
            box-shadow: 0 0 0 2px #9ca3af;
            outline: none;
        }
        .management-form input:focus, .management-form select:focus, .management-form textarea:focus {
            border-color: #111827;
            box-shadow: 0 0 0 2px #9ca3af;
        }
        
        /* Rotating Settings Gear */
        .settings-gear {
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
            position: relative; /* for status adornments */
        }
        .settings-gear:hover {
            transform: scale(1.08);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        /* Status-specific gear animations and colors */
        .settings-gear.status-live {
            background: linear-gradient(135deg, #064e3b 0%, #022c22 100%);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.4), 0 4px 16px rgba(0,0,0,0.2);
        }

        .settings-gear.status-polling {
            background: linear-gradient(135deg, #78350f 0%, #451a03 100%);
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.4), 0 4px 16px rgba(0,0,0,0.2);
        }

        .settings-gear.status-offline {
            background: linear-gradient(135deg, #7f1d1d 0%, #450a0a 100%);
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.5), 0 4px 16px rgba(0,0,0,0.2);
        }

        .settings-gear.status-checking {
            background: linear-gradient(135deg, #374151 0%, #1f2937 100%);
            box-shadow: 0 4px 16px rgba(0,0,0,0.2);
        }

        /* Hover overrides for status gears */
        .settings-gear.status-live:hover,
        .settings-gear.status-polling:hover,
        .settings-gear.status-offline:hover,
        .settings-gear.status-checking:hover {
            transform: scale(1.1);
            filter: brightness(1.1);
        }

        /* Gear status halo + status label */
        .settings-gear {
            position: relative;
            isolation: isolate;
        }
        .settings-gear::after {
            content: '';
            position: absolute;
            inset: -8px;
            border-radius: 9999px;
            background: var(--gear-halo, transparent);
            opacity: 0.9;
            z-index: -1;
            transition: background 0.25s ease, opacity 0.25s ease;
        }
        .settings-gear.status-live    { --gear-halo: rgba(16,185,129,0.35); }
        .settings-gear.status-polling { --gear-halo: rgba(245,158,11,0.45); }
        .settings-gear.status-offline { --gear-halo: rgba(239,68,68,0.45); }
        .settings-gear.status-checking{ --gear-halo: rgba(148,163,184,0.4); }

        .gear-status-label {
            display: none;
            margin-top: 0.6rem;
            padding: 5px 12px;
            border-radius: 9999px;
            font-size: 12px;
            font-weight: 600;
            color: #ffffff;
            align-self: center;
            background: #4b5563;
            box-shadow: 0 5px 14px rgba(0,0,0,0.22);
            text-align: center;
            min-width: 7rem;
            letter-spacing: 0.02em;
        }
        .gear-status-label.status-polling { background:#92400e; }
        .gear-status-label.status-offline { background:#7f1d1d; }
        .gear-status-label.status-checking { background:#475569; }
        .gear-status-label.active { display: inline-flex; justify-content: center; }

        /* Keep the management footer visible by constraining the scrollable body */
        #managementModal > div {
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        #managementModal .management-content {
            min-height: 0;
            padding-bottom: 5.5rem;
        }

        #managementModal #appVersionContainer {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            z-index: 10;
            margin-top: 0;
        }

        /* Offline interruption modal */
        #offlineInterruptionModal { display: none; }

        .offline-interruption-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.75);
            backdrop-filter: blur(6px);
            z-index: 120;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem 1rem;
        }

        .offline-interruption-card {
            background: #ffffff;
            border-radius: 18px;
            box-shadow: 0 25px 70px rgba(15, 23, 42, 0.25);
            width: min(640px, 100%);
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }

        .offline-interruption-header {
            padding: 1.75rem 2rem 1.25rem;
            border-bottom: 1px solid rgba(226, 232, 240, 0.8);
        }

        .offline-interruption-body {
            padding: 1.5rem 2rem;
            overflow-y: auto;
        }

        .offline-interruption-footer {
            padding: 1.25rem 2rem 1.75rem;
            border-top: 1px solid rgba(226, 232, 240, 0.8);
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            justify-content: flex-end;
        }

        .offline-interruption-icon {
            height: 3rem;
            width: 3rem;
            border-radius: 9999px;
            background: rgba(248, 113, 113, 0.12);
            color: #b91c1c;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .offline-resolution-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .offline-resolution-list li {
            display: flex;
            align-items: flex-start;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .offline-resolution-list li i {
            color: #2563eb;
            margin-top: 0.2rem;
        }

        .offline-status-strip {
            position: fixed;
            bottom: 12px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(15, 23, 42, 0.92);
            color: #ffffff;
            padding: 0.65rem 1rem;
            border-radius: 9999px;
            box-shadow: 0 15px 45px rgba(15, 23, 42, 0.35);
            display: none;
            align-items: center;
            gap: 0.75rem;
            z-index: 95;
        }

        .offline-status-strip.offline-visible { display: inline-flex; }

        .offline-status-strip .badge {
            background: rgba(248, 113, 113, 0.25);
            padding: 0.15rem 0.6rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .offline-status-strip .retry-btn {
            background: rgba(248, 250, 252, 0.15);
            border: 1px solid rgba(248, 250, 252, 0.25);
            color: #e2e8f0;
            padding: 0.35rem 0.9rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            display: inline-flex;
            align-items: center;
            gap: 0.35rem;
            transition: background 0.2s ease;
        }

        .offline-status-strip .retry-btn:hover {
            background: rgba(248, 250, 252, 0.25);
        }

        .offline-status-strip .help-link {
            color: rgba(226, 232, 240, 0.8);
            font-size: 0.75rem;
            text-decoration: underline;
            cursor: pointer;
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            .settings-gear.status-live,
            .settings-gear.status-polling,
            .settings-gear.status-checking {
                animation: none !important;
            }
            .settings-gear.status-live {
                box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.6), 0 4px 16px rgba(0,0,0,0.2);
            }
            .settings-gear.status-polling {
                box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.6), 0 4px 16px rgba(0,0,0,0.2);
            }
            .settings-gear.status-offline {
                box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.6), 0 4px 16px rgba(0,0,0,0.2);
            }
        }

        /* Connection Status Badge (compact pill in Management header) */
        .connection-status-banner {
            --status-accent: #4b5563;
            --status-bg: #f3f4f6;
            --status-border: #e5e7eb;
            --status-text: #1f2937;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.35rem 0.85rem;
            border-radius: 9999px;
            border: 1px solid var(--status-border);
            background: var(--status-bg);
            color: var(--status-text);
            font-size: 0.8rem;
            font-weight: 600;
            line-height: 1.1;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.8);
            transition: background 0.2s ease, border-color 0.2s ease, color 0.2s ease;
        }

        .connection-status-banner .status-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 1.5rem;
            height: 1.5rem;
            border-radius: 9999px;
            background: rgba(255, 255, 255, 0.9);
            color: var(--status-accent);
            font-size: 0.85rem;
            box-shadow: inset 0 0 0 1px rgba(15, 23, 42, 0.05);
        }

        .connection-status-banner .status-copy {
            display: flex;
            flex-direction: column;
            gap: 0.1rem;
        }

        .connection-status-banner .status-copy .status-heading {
            font-weight: 700;
            font-size: 0.78rem;
        }

        .connection-status-banner .status-copy .status-subtext {
            font-size: 0.65rem;
            font-weight: 500;
            color: #6b7280;
        }

        .connection-status-banner.status-live {
            --status-accent: #10b981;
            --status-bg: #ecfdf5;
            --status-border: #6ee7b7;
            --status-text: #064e3b;
        }

        .connection-status-banner.status-polling {
            --status-accent: #f59e0b;
            --status-bg: #fffbeb;
            --status-border: #fcd34d;
            --status-text: #78350f;
        }

        .connection-status-banner.status-offline {
            --status-accent: #ef4444;
            --status-bg: #fef2f2;
            --status-border: #fecaca;
            --status-text: #7f1d1d;
        }

        .connection-status-banner.status-checking {
            --status-accent: #6366f1;
            --status-bg: #eef2ff;
            --status-border: #c7d2fe;
            --status-text: #312e81;
        }

        @media (max-width: 640px) {
            .connection-status-banner {
                width: 100%;
                justify-content: flex-start;
                border-radius: 0.75rem;
            }
            .connection-status-banner .status-subtext {
                display: none;
            }
        }

        @media (min-width: 641px) {
            .connection-status-banner {
                flex-shrink: 0;
            }
        }

        @keyframes pulse-green {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.7; transform: scale(1.1); }
        }

        @keyframes pulse-orange {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.15); }
        }

        @keyframes pulse-red {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }

        @keyframes pulse-gray {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        /* Gear rotation animations for connection status */
        @keyframes rotate-smooth {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        @keyframes rotate-stutter {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes wobble {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(-5deg); }
            75% { transform: rotate(5deg); }
        }

        /* Desktop Order Items */
        .order-item {
            transition: all 0.2s ease;
        }
        .order-item:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .order-item.selected-for-numpad {
            background-color: #eff6ff !important;
            border-color: #3b82f6 !important;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        /* Enhanced License Validation UI Components */
        .license-status-message { font-size: 0.95rem; line-height: 1.5; margin-bottom: 0.5rem; }
        .progressive-warning { animation: warningPulse 2s ease-in-out infinite; }
        @keyframes warningPulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.85; } }
        .connectivity-status { transition: all 0.3s ease; backdrop-filter: blur(4px); }
        .connectivity-status:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.15); }
        .trial-mode-indicator { animation: trialBlink 3s ease-in-out infinite; }
        @keyframes trialBlink { 0%, 85%, 100% { opacity: 1; } 90%, 95% { opacity: 0.7; } }
        .warning-notification { animation: slideInDown 0.4s ease-out; }
        @keyframes slideInDown { from { transform: translate(-50%, -100%); opacity: 0; } to { transform: translate(-50%, 0); opacity: 1; } }
        .offline-grace-progress { background: linear-gradient(90deg, #f59e0b 0%, #d97706 50%, #dc2626 100%); }
        .license-badge-active { background: linear-gradient(45deg, #10b981, #047857) !important; animation: successGlow 2s ease-in-out; }
        @keyframes successGlow { 0%, 100% { box-shadow: 0 0 5px rgba(16, 185, 129, 0.3); } 50% { box-shadow: 0 0 20px rgba(16, 185, 129, 0.6); } }
        .connection-help-modal { backdrop-filter: blur(8px); }
        .status-indicator-pulse { animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .7; } }

        /* ==================================================================================
           TABLE MANAGEMENT MODE SWITCHING CSS - Desktop Version
           ================================================================================== */

        /* Default: Hide table features */
        .table-mode-only { display: none !important; }
        .simple-mode-only { display: block; }

        /* Table Management Styles */
        .table-filter-btn {
            background-color: #f3f4f6;
            color: #6b7280;
            border: 1px solid #d1d5db;
            transition: all 0.2s ease;
        }
        .table-filter-btn:hover {
            background-color: #e5e7eb;
            color: #374151;
        }
        .table-filter-btn.active {
            background-color: #111827;
            color: white;
            border-color: #111827;
        }
        .table-card {
            border: 2px solid #e5e7eb;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .table-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border-color: #9ca3af;
        }
        .table-status-available {
            background-color: #d1fae5;
            color: #065f46;
            border-color: #6ee7b7;
        }
        .table-status-occupied {
            background-color: #fef3c7;
            color: #92400e;
            border-color: #fbbf24;
        }
        .table-status-paid {
            background-color: #fee2e2;
            color: #991b1b;
            border-color: #fca5a5;
        }

        /* Show table features when enabled */
        body.table-mode .table-mode-only:not(.fixed.inset-0) { display: block !important; }
        body.table-mode #connectionStatusBanner.table-mode-only { display: inline-flex !important; }
        body.table-mode .simple-mode-only { display: none !important; }

        /* Desktop table panel styling */
        body.table-mode .table-status-panel {
            background: linear-gradient(135deg, #374151 0%, #1f2937 100%);
            border-bottom: 2px solid #4b5563;
        }

        /* Table grid for desktop - larger cards */
        .table-card {
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            min-height: 120px;
        }

        .table-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.15);
        }

        .table-card.available {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border-color: #10b981;
            border-width: 2px;
        }

        .table-card.occupied {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border-color: #ef4444;
            border-width: 2px;
            animation: tablePulse 3s ease-in-out infinite;
        }

        @keyframes tablePulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.95; }
        }

        /* Desktop-specific table status indicators */
        .table-status-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 3px solid white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .table-status-indicator.available {
            background-color: #10b981;
        }

        .table-status-indicator.occupied {
            background-color: #ef4444;
            animation: statusBlink 2s ease-in-out infinite;
        }

        @keyframes statusBlink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* Desktop table selection enhancement */
        body.table-mode .table-selection-button {
            background: linear-gradient(135deg, #374151 0%, #1f2937 100%);
            border: 2px solid #4b5563;
            transition: all 0.3s ease;
        }

        body.table-mode .table-selection-button:hover {
            background: linear-gradient(135deg, #4b5563 0%, #374151 100%);
            border-color: #6b7280;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        /* Desktop layout adjustments */
        body.table-mode .main-grid {
            grid-template-columns: 300px 1fr 400px; /* Table Panel | Menu | Order */
        }

        body.simple-mode .main-grid {
            grid-template-columns: 1fr 400px; /* Menu | Order */
        }

        /* Table panel for desktop */
        .desktop-table-panel {
            background: #f9fafb;
            border-right: 1px solid #e5e7eb;
            overflow-y: auto;
        }

        /* Accessibility improvements for desktop */
        .table-card:focus {
            outline: 3px solid #3b82f6;
            outline-offset: 3px;
        }

        /* Desktop table management modal styling */
        .desktop-table-modal .modal-content {
            max-width: 600px;
            max-height: 80vh;
        }

        /* Desktop bill view styling */
        .desktop-table-bill {
            font-family: 'Courier New', monospace;
            background: white;
            padding: 2rem;
            max-height: 70vh;
            overflow-y: auto;
        }

        /* ==================================================================================
           DESKTOP QUICK SELECT BAR STYLES - Compact & Elegant Design
           ================================================================================== */
        #tableQuickSelectBar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 45;
            background: rgba(31, 41, 55, 0.95);
            backdrop-filter: blur(8px);
            border-bottom: 1px solid rgba(75, 85, 99, 0.5);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
            overflow-y: hidden;
            white-space: nowrap;
            scrollbar-width: thin;
            scrollbar-color: #4b5563 transparent;
            display: flex;
            padding: 0.5rem 0.75rem;
            gap: 0.5rem;
        }

        /* Hidden state - use class-based approach to avoid !important conflicts */
        #tableQuickSelectBar.hidden {
            display: none !important;
        }

        #tableQuickSelectBar::-webkit-scrollbar {
            height: 4px;
        }

        #tableQuickSelectBar::-webkit-scrollbar-thumb {
            background-color: #4b5563;
            border-radius: 2px;
        }

        #tableQuickSelectBar::-webkit-scrollbar-track {
            background: transparent;
        }

        .table-select-btn {
            position: relative;
            display: inline-flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            min-width: 60px;
            height: 44px;
            padding: 0.5rem 0.75rem;
            background-color: rgba(55, 65, 81, 0.8);
            color: white;
            border: 1.5px solid rgba(75, 85, 99, 0.6);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.875rem;
            font-weight: 500;
            white-space: nowrap;
            text-align: center;
        }

        .table-select-btn:hover {
            background-color: rgba(75, 85, 99, 0.9);
            border-color: rgba(107, 114, 128, 0.8);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        /* Hover tooltip for additional info */
        .table-select-btn::after {
            content: attr(data-tooltip);
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%) translateY(4px);
            background: rgba(17, 24, 39, 0.95);
            color: white;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
            font-size: 0.75rem;
            white-space: nowrap;
            pointer-events: none;
            opacity: 0;
            visibility: hidden;
            transition: all 0.2s ease;
            z-index: 50;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .table-select-btn:hover::after {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(8px);
        }

        .table-select-btn.selected {
            background-color: rgba(22, 163, 74, 0.9);
            border-color: #15803d;
            font-weight: 600;
            box-shadow: 0 0 0 2px rgba(22, 163, 74, 0.3);
        }

        .table-select-btn.selected:hover {
            background-color: #15803d;
            border-color: #14532d;
            box-shadow: 0 0 0 2px rgba(22, 163, 74, 0.3), 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .table-select-btn .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 0.375rem;
            border: 1.5px solid white;
            flex-shrink: 0;
        }

        .table-select-btn .status-dot.available {
            background-color: #10b981;
        }

        .table-select-btn .status-dot.occupied {
            background-color: #ef4444;
            animation: dotBlink 2s ease-in-out infinite;
        }

        @keyframes dotBlink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .table-select-btn .table-name {
            font-weight: 600;
            font-size: 0.875rem;
        }

        /* Hide extra info by default - shown in tooltip */
        .table-select-btn .table-info,
        .table-select-btn .table-total {
            display: none;
        }

        .table-select-btn.takeaway {
            background-color: rgba(75, 85, 99, 0.8);
            border-color: rgba(107, 114, 128, 0.6);
            min-width: 80px;
        }

        .table-select-btn.takeaway .status-dot {
            display: none;
        }

        .table-select-btn.takeaway:hover {
            background-color: rgba(107, 114, 128, 0.9);
            border-color: rgba(156, 163, 175, 0.8);
        }

        .table-select-btn.takeaway.selected {
            background-color: rgba(59, 130, 246, 0.9);
            border-color: #2563eb;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
        }

        .table-select-btn.takeaway.selected:hover {
            background-color: #2563eb;
            border-color: #1d4ed8;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3), 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .table-select-btn i {
            font-size: 0.8rem;
            margin-right: 0.25rem;
        }

        /* ==================================================================================
           TABLE INDICATOR BADGE - Header-integrated indicator
           ================================================================================== */
        #tableIndicatorBadge {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.25rem;
            padding: 0.25rem 0.75rem;
            background: #374151;
            color: white;
            font-size: 0.875rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            border-radius: 0.375rem;
            white-space: nowrap;
            min-width: 120px;
        }

        #tableIndicatorBadge:hover {
            background: #4b5563;
        }

        #tableIndicatorBadge .indicator-icon {
            font-size: 0.875rem;
            flex-shrink: 0;
        }

        #tableIndicatorBadge .indicator-text {
            flex: 1;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        #tableIndicatorBadge .indicator-chevron {
            font-size: 0.625rem;
            opacity: 0.8;
            flex-shrink: 0;
        }

        /* ==================================================================================
           TABLE SELECTOR MODAL - Expandable full selector
           ================================================================================== */
        #tableSelectorModal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 999;
            display: none;
            justify-content: center;
            align-items: flex-start;
            padding-top: 5rem;
        }

        #tableSelectorModal.open {
            display: flex;
        }

        #tableSelectorBackdrop {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(2px);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        #tableSelectorModal.open #tableSelectorBackdrop {
            opacity: 1;
        }

        #tableSelectorContent {
            position: relative;
            z-index: 1;
            background: rgba(31, 41, 55, 0.98);
            backdrop-filter: blur(12px);
            border-radius: 1rem;
            padding: 1.25rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            max-width: 90vw;
            max-height: 70vh;
            overflow-y: auto;
            transform: translateY(-20px) scale(0.95);
            opacity: 0;
            transition: all 0.3s ease;
        }

        #tableSelectorModal.open #tableSelectorContent {
            transform: translateY(0) scale(1);
            opacity: 1;
        }

        #tableSelectorHeader {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.75rem;
            border-bottom: 1px solid rgba(75, 85, 99, 0.5);
        }

        #tableSelectorHeader h3 {
            color: white;
            font-size: 1.125rem;
            font-weight: 600;
            margin: 0;
        }

        #tableSelectorClose {
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.375rem;
            transition: all 0.2s ease;
        }

        #tableSelectorClose:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        #tableSelectorGrid {
            display: flex;
            flex-wrap: wrap;
            gap: 0.75rem;
            padding: 0.5rem 0;
        }

        /* Reuse existing table-select-btn styles but adjust for modal context */
        #tableSelectorGrid .table-select-btn {
            position: relative;
            display: inline-flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            min-width: 80px;
            height: 52px;
            padding: 0.625rem 1rem;
            background-color: rgba(55, 65, 81, 0.8);
            color: white;
            border: 1.5px solid rgba(75, 85, 99, 0.6);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.9rem;
            font-weight: 500;
            white-space: nowrap;
            text-align: center;
        }

        #tableSelectorGrid .table-select-btn:hover {
            background-color: rgba(75, 85, 99, 0.9);
            border-color: rgba(107, 114, 128, 0.8);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        #tableSelectorGrid .table-select-btn.selected {
            background-color: rgba(22, 163, 74, 0.9);
            border-color: #15803d;
            font-weight: 600;
            box-shadow: 0 0 0 2px rgba(22, 163, 74, 0.3);
        }

        #tableSelectorGrid .table-select-btn.selected:hover {
            background-color: #15803d;
            border-color: #14532d;
            box-shadow: 0 0 0 2px rgba(22, 163, 74, 0.3), 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        #tableSelectorGrid .table-select-btn.takeaway {
            background-color: rgba(75, 85, 99, 0.8);
            border-color: rgba(107, 114, 128, 0.6);
            min-width: 100px;
        }

        #tableSelectorGrid .table-select-btn.takeaway:hover {
            background-color: rgba(107, 114, 128, 0.9);
            border-color: rgba(156, 163, 175, 0.8);
        }

        #tableSelectorGrid .table-select-btn.takeaway.selected {
            background-color: rgba(59, 130, 246, 0.9);
            border-color: #2563eb;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
        }

        #tableSelectorGrid .table-select-btn.takeaway.selected:hover {
            background-color: #2563eb;
            border-color: #1d4ed8;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3), 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        /* Scrollbar for modal content */
        #tableSelectorContent::-webkit-scrollbar {
            width: 8px;
        }

        #tableSelectorContent::-webkit-scrollbar-thumb {
            background-color: rgba(75, 85, 99, 0.6);
            border-radius: 4px;
        }

        #tableSelectorContent::-webkit-scrollbar-track {
            background: transparent;
        }

        /* Payment Method Modal Styles */
        .payment-method-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
            border: 2px solid #d1d5db;
            border-radius: 0.5rem;
            transition: all 0.2s ease;
            cursor: pointer;
            background: white;
        }

        .payment-method-btn:hover {
            border-color: #6b7280;
            background-color: #f9fafb;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .payment-method-btn.selected-payment {
            border-color: #10b981 !important;
            background-color: #d1fae5 !important;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .payment-method-btn:active {
            transform: translateY(0);
        }

    </style>
</head>
<body class="desktop-ui flex h-screen bg-gray-100 text-gray-800">
    <!-- Blocking overlay shown when no printer is configured -->
    <div id="printerBlockingOverlay" class="hidden fixed inset-0 z-[75] bg-black/75 flex items-center justify-center px-4 py-6">
        <div class="bg-white rounded-2xl shadow-2xl max-w-lg w-full p-6 text-gray-900">
            <div class="flex items-start gap-3">
                <div class="text-3xl">&#9888;&#65039;</div>
                <div>
                    <p class="text-xl font-semibold mb-1">No kitchen printer selected</p>
                    <p id="printerBlockingMessage" class="text-sm text-gray-600">
                        Orders will save but nothing will print until a thermal printer is selected on the server.
                    </p>
                </div>
            </div>
            <ul class="mt-4 text-sm text-gray-700 space-y-1 list-disc list-inside">
                <li>All staff can fix this - no manager code required.</li>
                <li>Pick the thermal printer once and every device will use it automatically.</li>
                <li>Run a quick test print to make sure the kitchen hears new orders.</li>
            </ul>
            <div class="mt-6 flex flex-wrap gap-3">
                <button class="px-4 py-2 rounded-md bg-black text-white font-semibold hover:bg-gray-900 transition flex items-center gap-2"
                        data-printer-action="open">
                    <i class="fas fa-print"></i>
                    Select Printer
                </button>
                <button class="px-4 py-2 rounded-md border border-gray-300 text-gray-800 hover:bg-gray-50 transition flex items-center gap-2"
                        data-printer-action="refresh">
                    <i class="fas fa-sync-alt"></i>
                    Refresh Status
                </button>
            </div>
        </div>
    </div>

    <!-- Printer setup modal -->
    <div id="printerSetupModal" class="hidden fixed inset-0 z-[85] px-4 py-6 items-center justify-center flex">
        <div class="absolute inset-0 bg-black/60" data-printer-action="close" aria-hidden="true"></div>
        <div class="relative bg-white rounded-2xl shadow-2xl w-full max-w-2xl p-6 space-y-6">
            <div class="flex items-start justify-between gap-4">
                <div>
                    <p class="text-xs font-semibold uppercase tracking-[0.2em] text-gray-500">Kitchen printer</p>
                    <h2 id="printerSetupTitle" class="text-2xl font-bold text-gray-900 mt-1">Select a thermal printer</h2>
                    <p class="text-sm text-gray-600 mt-2">This printer is shared across every device connected to the server.</p>
                </div>
                <button class="text-gray-500 hover:text-gray-800 text-2xl leading-none" aria-label="Close printer modal"
                        data-printer-action="close">
                    &times;
                </button>
            </div>

            <div class="space-y-4">
                <div>
                    <label for="printerSetupSelect" class="block text-sm font-semibold text-gray-800 mb-2">Available printers</label>
                    <div class="flex flex-col gap-2 sm:flex-row sm:items-center">
                        <select id="printerSetupSelect" class="flex-1 px-3 py-2 border border-gray-300 rounded-md bg-white text-sm shadow-sm">
                            <option value="">Loading printers...</option>
                        </select>
                        <button type="button" class="px-3 py-2 text-sm border border-gray-300 rounded-md hover:bg-gray-50 flex items-center justify-center gap-2"
                                onclick="PrinterMonitor.refreshPrinterList()">
                            <i class="fas fa-sync-alt"></i>
                            Refresh list
                        </button>
                    </div>
                    <div id="printerSelectionState" class="flex items-center gap-2 text-xs font-medium text-gray-600 mt-2" aria-live="polite">
                        <span class="inline-flex h-2.5 w-2.5 rounded-full bg-gray-300 transition-colors duration-200" data-indicator-dot></span>
                        <span data-indicator-text>Saved printer: none. Select and save to enable testing.</span>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">Only supported thermal printers are shown. Virtual/PDF printers stay hidden.</p>
                </div>

                <div class="rounded-xl border border-gray-200 bg-gray-50 px-4 py-3 text-sm text-gray-700" id="printerSetupStatus">
                    Checking printer status...
                </div>
            </div>

            <div class="rounded-lg bg-slate-50 p-4 text-sm text-slate-700">
                <p class="font-semibold text-slate-900 mb-1">Need help?</p>
                <ul class="list-disc list-inside space-y-1">
                    <li>Pick the kitchen printer once and every tablet will use it.</li>
                    <li>Use the refresh button if the printer was just plugged in.</li>
                    <li>Send a quick test print so the kitchen hears new orders.</li>
                </ul>
            </div>

            <div class="flex flex-wrap justify-end gap-3">
                <button type="button" class="px-4 py-2 rounded-md border border-gray-300 text-gray-800 hover:bg-gray-50"
                        data-printer-action="close">
                    Cancel
                </button>
                <button type="button" class="px-4 py-2 rounded-md border border-gray-300 text-gray-800 hover:bg-gray-50 flex items-center gap-2"
                        data-printer-action="test"
                        onclick="PrinterMonitor.testPrinterFromRescue()">
                    <i class="fas fa-vial"></i>
                    Test Print
                </button>
                <button type="button" class="px-4 py-2 rounded-md bg-black text-white font-semibold hover:bg-gray-900 flex items-center gap-2"
                        data-printer-action="save"
                        onclick="PrinterMonitor.saveRescueSelection()">
                    <i class="fas fa-save"></i>
                    Save Printer
                </button>
            </div>
        </div>
    </div>

    <!-- Table Selector Modal (Expandable full selector) -->
    <div id="tableSelectorModal">
        <div id="tableSelectorBackdrop" onclick="closeTableSelector()"></div>
        <div id="tableSelectorContent">
            <div id="tableSelectorHeader">
                <h3>Select Table</h3>
                <button id="tableSelectorClose" onclick="closeTableSelector()" aria-label="Close">Ã—</button>
            </div>
            <div id="tableSelectorGrid">
                <!-- Table selection buttons will be inserted here by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Offline Interruption Modal -->
    <div id="offlineInterruptionModal" class="offline-interruption-backdrop" style="display:none;">
        <div class="offline-interruption-card">
            <div class="offline-interruption-header">
                <div class="flex items-start gap-4">
                    <div class="offline-interruption-icon">
                        <i class="fas fa-plug-circle-exclamation"></i>
                    </div>
                    <div>
                        <h2 class="text-2xl font-semibold text-slate-900" data-i18n="ui.offlineModal.title">Internet connection lost - POS running in grace mode</h2>
                        <p class="text-sm text-slate-600 mt-2">
                            <span data-i18n="ui.offlineModal.summary">We can't reach the licensing service right now. POSPal will keep working using the last verified license.</span>
                            <span id="offlineModalGraceText" class="font-medium text-slate-900 block mt-1"></span>
                        </p>
                    </div>
                </div>
            </div>
            <div class="offline-interruption-body space-y-6">
                <section>
                    <h3 class="text-sm uppercase tracking-wide text-slate-500 font-semibold" data-i18n="ui.offlineModal.section.whatHappened">What happened</h3>
                    <p class="text-base text-slate-700 mt-2" data-i18n="ui.offlineModal.detail">The internet connection dropped, so we're using cached license data. Orders, payments, and printing continue to work normally.</p>
                </section>
                <section>
                    <h3 class="text-sm uppercase tracking-wide text-slate-500 font-semibold" data-i18n="ui.offlineModal.section.resolve">How to resolve it</h3>
                    <ul class="offline-resolution-list text-sm text-slate-700">
                        <li>
                            <i class="fas fa-wifi"></i>
                            <span data-i18n="ui.offlineModal.step.checkNetwork">Check the router or internet modem and make sure cables and power are secure.</span>
                        </li>
                        <li>
                            <i class="fas fa-network-wired"></i>
                            <span data-i18n="ui.offlineModal.step.verifyLan">Verify the POS server still has LAN access. If needed, restart the router or modem.</span>
                        </li>
                        <li>
                            <i class="fas fa-rotate"></i>
                            <span data-i18n="ui.offlineModal.step.retry">Once internet is back, press "Retry Connection" to re-validate the license.</span>
                        </li>
                    </ul>
                </section>
                <section>
                    <div class="rounded-xl bg-slate-50 border border-slate-200 p-4 flex items-start gap-3">
                        <i class="fas fa-circle-info text-slate-500 mt-1"></i>
                        <p class="text-sm text-slate-700" data-i18n="ui.offlineModal.note">POSPal tracks how long we run offline. If the grace period expires before internet returns, licensing features may pause. Resolve connectivity as soon as possible.</p>
                    </div>
                </section>
                <section aria-label="Troubleshooting guidance" class="space-y-4">
                    <h3 class="text-sm uppercase tracking-wide text-slate-500 font-semibold">Troubleshooting</h3>
                    <div class="space-y-4">
                        <div class="rounded-lg border border-blue-100 bg-blue-50 p-4">
                            <h4 class="text-sm font-semibold text-blue-900 flex items-center gap-2">
                                <i class="fas fa-bolt"></i>
                                Quick check
                            </h4>
                            <p class="text-sm text-blue-800 mt-2">Run a quick test to confirm the internet connection is working.</p>
                            <button type="button" class="mt-3 inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded text-sm font-medium transition-colors" onclick="testInternetConnection()">
                                <i class="fas fa-globe"></i>
                                Test internet connection
                            </button>
                        </div>
                        <div class="rounded-lg border border-slate-200 bg-slate-50 p-4">
                            <h4 class="text-sm font-semibold text-slate-900 flex items-center gap-2">
                                <i class="fas fa-toolbox"></i>
                                Common fixes
                            </h4>
                            <ul class="mt-3 space-y-2 text-sm text-slate-700">
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-wifi text-slate-500 mt-1"></i>
                                    <span>Make sure this device is connected to Wi-Fi or ethernet.</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-shield-alt text-slate-500 mt-1"></i>
                                    <span>Temporarily pause firewall or antivirus software to rule out blocking.</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-router text-slate-500 mt-1"></i>
                                    <span>Power-cycle the modem or router and wait two minutes before retrying.</span>
                                </li>
                                <li class="flex items-start gap-2">
                                    <i class="fas fa-sync text-slate-500 mt-1"></i>
                                    <span>Restart POSPal or refresh this page after the network is back.</span>
                                </li>
                            </ul>
                        </div>
                        <div class="rounded-lg border border-amber-200 bg-amber-50 p-4">
                            <h4 class="text-sm font-semibold text-amber-900 flex items-center gap-2">
                                <i class="fas fa-life-ring"></i>
                                Still offline?
                            </h4>
                            <p class="text-sm text-amber-800 mt-2">POSPal must reach our licensing servers from time to time. If you continue to have issues:</p>
                            <ul class="mt-2 space-y-1 text-sm text-amber-800">
                                <li>Check with your IT administrator about firewall or proxy rules.</li>
                                <li>Confirm the network allows outbound connections to external services.</li>
                                <li>Try connecting via a different network (for example, a mobile hotspot).</li>
                                <li>Contact POSPal support if the retry continues to fail.</li>
                            </ul>
                        </div>
                    </div>
                </section>
            </div>
            <div class="offline-interruption-footer">
                <span id="offlineModalCountdown" class="text-xs text-slate-500 mr-auto hidden"></span>
                <button id="offlineContinueButton" type="button" class="btn-secondary py-2 px-4" data-i18n="ui.offlineModal.continue">Continue in grace mode</button>
                <button id="offlineRetryButton" type="button" class="btn-primary py-2 px-4 flex items-center gap-2">
                    <i class="fas fa-sync-alt"></i>
                    <span data-i18n="ui.offlineModal.retry">Retry connection</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Legacy Quick Select Bar (Hidden - replaced by modal) -->
    <div id="tableQuickSelectBar" class="hidden" style="display: none;">
        <!-- Kept for backward compatibility but hidden -->
    </div>

    <!-- Left Panel: Order Details -->
    <div class="w-1/3 max-w-md flex flex-col p-3 gap-2 bg-gray-50 border-r border-gray-300 h-full overflow-hidden">
        <div class="bg-gray-900 text-white p-3 rounded-lg">
            <div class="flex justify-between items-center gap-3">
                <div class="flex items-center gap-3">
                    <h1 class="text-xl font-bold tracking-wider">POS<span class="text-green-400">Pal</span></h1>
                </div>
                <div class="text-right">
                    <!-- Simple Mode: Manual Table Input -->
                    <div class="simple-mode-only mt-1 flex items-center space-x-2 bg-gray-700 px-3 py-1 rounded-md">
                        <label for="header-table-input" class="cursor-pointer">
                            <i class="fas fa-chair text-white"></i>
                        </label>
                        <input type="text" id="header-table-input" class="bg-transparent text-white font-semibold w-24 focus:outline-none placeholder-gray-400" data-i18n-attr='{"placeholder":"ui.table.placeholder"}' placeholder="Table #">
                    </div>

                    <!-- Table Mode: Indicator Badge -->
                    <div id="tableIndicatorBadge" class="table-mode-only" onclick="openTableSelector()">
                        <span class="indicator-icon">ðŸ“</span>
                        <span class="indicator-text">Tap to Select</span>
                        <span class="indicator-chevron">â–¼</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="flex-1 bg-white p-3 rounded-lg shadow-md flex flex-col min-h-0">
            <div class="flex items-center justify-between mb-2 flex-shrink-0">
                <h2 class="text-xl font-bold"><span data-i18n="ui.order.headerNumber">Order #</span><span id="order-number-desktop">1</span></h2>
                <div class="flex items-center gap-2">
                    <button onclick="toggleDesktopNumpad()" class="px-2 py-1 text-xs btn-secondary rounded">Numpad</button>
                </div>
            </div>
            <div id="order-items-container" class="flex-1 overflow-y-auto -mr-2 pr-2 space-y-1 min-h-0">
                <p id="empty-order-message" class="text-gray-500 text-center py-8 italic" data-i18n="ui.order.empty">Your order is empty.</p>
            </div>
            <div id="order-total" class="text-2xl font-bold text-right mt-4 pt-4 border-t border-gray-200 flex-shrink-0"><span data-i18n="ui.order.total">Total:</span> &euro;0.00</div>
        </div>
        
        <div id="desktopNumpadMini" class="bg-white p-2 rounded-lg shadow-md">
            <div class="flex flex-wrap gap-2 items-center">
                <div class="grid grid-cols-3 gap-2 flex-1">
                    <button onclick="handleNumpad_desktop(1)" class="w-full py-3 bg-white border border-gray-300 rounded text-gray-800 text-lg hover:bg-gray-200">1</button>
                    <button onclick="handleNumpad_desktop(2)" class="w-full py-3 bg-white border border-gray-300 rounded text-gray-800 text-lg hover:bg-gray-200">2</button>
                    <button onclick="handleNumpad_desktop(3)" class="w-full py-3 bg-white border border-gray-300 rounded text-gray-800 text-lg hover:bg-gray-200">3</button>
                </div>
                <div class="flex gap-2">
                    <button onclick="handleNumpadClear_desktop()" class="px-3 py-2 text-xs btn-warning rounded">C</button>
                    <button onclick="handleNumpadBackspace_desktop()" class="px-3 py-2 text-xs btn-danger rounded"><i class="fas fa-backspace"></i></button>
                </div>
                <button onclick="expandDesktopNumpad()" class="ml-auto px-3 py-2 text-xs btn-secondary rounded"><i class="fas fa-chevron-down"></i></button>
            </div>
        </div>

        <div id="desktopNumpad" class="bg-white p-3 rounded-lg shadow-md hidden">
            <div class="grid grid-cols-3 gap-2">
               <button onclick="handleNumpad_desktop(1)" class="py-3 bg-white border border-gray-300 rounded-lg text-gray-800 font-semibold text-xl hover:bg-gray-200 active:bg-gray-300 transition-colors">1</button>
               <button onclick="handleNumpad_desktop(2)" class="py-3 bg-white border border-gray-300 rounded-lg text-gray-800 font-semibold text-xl hover:bg-gray-200 active:bg-gray-300 transition-colors">2</button>
               <button onclick="handleNumpad_desktop(3)" class="py-3 bg-white border border-gray-300 rounded-lg text-gray-800 font-semibold text-xl hover:bg-gray-200 active:bg-gray-300 transition-colors">3</button>
               <button onclick="handleNumpad_desktop(4)" class="py-3 bg-white border border-gray-300 rounded-lg text-gray-800 font-semibold text-xl hover:bg-gray-200 active:bg-gray-300 transition-colors">4</button>
               <button onclick="handleNumpad_desktop(5)" class="py-3 bg-white border border-gray-300 rounded-lg text-gray-800 font-semibold text-xl hover:bg-gray-200 active:bg-gray-300 transition-colors">5</button>
               <button onclick="handleNumpad_desktop(6)" class="py-3 bg-white border border-gray-300 rounded-lg text-gray-800 font-semibold text-xl hover:bg-gray-200 active:bg-gray-300 transition-colors">6</button>
               <button onclick="handleNumpad_desktop(7)" class="py-3 bg-white border border-gray-300 rounded-lg text-gray-800 font-semibold text-xl hover:bg-gray-200 active:bg-gray-300 transition-colors">7</button>
               <button onclick="handleNumpad_desktop(8)" class="py-3 bg-white border border-gray-300 rounded-lg text-gray-800 font-semibold text-xl hover:bg-gray-200 active:bg-gray-300 transition-colors">8</button>
               <button onclick="handleNumpad_desktop(9)" class="py-3 bg-white border border-gray-300 rounded-lg text-gray-800 font-semibold text-xl hover:bg-gray-200 active:bg-gray-300 transition-colors">9</button>
               <button onclick="handleNumpadClear_desktop()" class="py-3 rounded-lg font-semibold text-xl transition-colors btn-warning">C</button>
               <button onclick="handleNumpad_desktop(0)" class="py-3 bg-white border border-gray-300 rounded-lg text-gray-800 font-semibold text-xl hover:bg-gray-200 active:bg-gray-300 transition-colors">0</button>
               <button onclick="handleNumpadBackspace_desktop()" class="py-3 rounded-lg font-semibold text-xl transition-colors btn-danger"><i class="fas fa-backspace"></i></button>
            </div>
        </div>
        
        <div id="desktopNotesCard" class="bg-white p-3 rounded-lg shadow-md">
            <label for="universalOrderCommentInput_desktop" class="block mb-1 text-sm font-medium text-gray-700" data-i18n="ui.order.notesLabel">Order Notes:</label>
            <textarea id="universalOrderCommentInput_desktop" rows="2" class="w-full p-2 border border-gray-300 rounded-md text-sm" data-i18n-attr='{"placeholder":"ui.order.notesPlaceholder"}' placeholder="Add notes for the entire order..."></textarea>
            <textarea id="universalOrderCommentInput" rows="3" class="hidden"></textarea>
            <div class="mt-2 flex items-center">
                <label for="paidByCardCheckbox" class="flex items-center space-x-2 cursor-pointer">
                    <input type="checkbox" id="paidByCardCheckbox" class="h-5 w-5 text-black border-gray-300 rounded focus:ring-black accent-black">
                    <span class="text-sm font-medium text-gray-700" data-i18n="ui.order.payByCard">Pay by Card</span>
                </label>
            </div>
        </div>

        <div class="flex gap-3">
            <button onclick="newOrder()" class="w-full py-3 text-lg font-semibold rounded-lg btn-secondary transition-transform active:scale-95" data-i18n="ui.order.newOrder">New Order</button>
            <button id="sendOrderBtn" onclick="sendOrder()" class="w-full py-3 text-lg font-semibold rounded-lg btn-primary transition-transform active:scale-95" data-i18n="ui.order.sendOrder">Send Order</button>
        </div>
    </div>

    <!-- Right Panel: Menu -->
    <div class="w-2/3 flex-1 flex flex-col p-4 h-full overflow-hidden">
        <div id="category-section" class="mb-4 pb-4 border-b border-gray-300 flex-shrink-0">
            <div id="categories" class="flex flex-wrap gap-2">
                <!-- Categories will load here -->
            </div>
        </div>
        <div id="products" class="grid grid-cols-[repeat(auto-fill,minmax(220px,1fr))] gap-3 overflow-y-auto flex-1 content-start">
            <!-- Products will load here -->
        </div>
    </div>
    
    <!-- Toast Notification -->
    <div id="toast" class="fixed top-5 right-5 bg-gray-800 text-white px-4 py-2 rounded-md shadow-lg text-sm z-[2000] hidden opacity-0 transition-opacity duration-300">
        <span id="toast-message">Toast message here</span>
    </div>

    <!-- Settings Gear & Tables Button -->
    <div id="settings-gear-container" class="fixed bottom-4 right-4 z-[1001] flex flex-col items-center gap-3">
        <!-- Tables Button (only visible when table management enabled) -->
        <button id="tablesBtn" onclick="openTablesModal()" class="table-mode-only bg-green-600 hover:bg-green-700 text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center transition" title="Tables" style="display: none;">
            <i class="fas fa-utensils text-2xl"></i>
        </button>

        <!-- Settings Gear with connection status -->
        <button id="settingsGear" onclick="openLoginModal()" class="settings-gear status-checking text-white w-14 h-14 rounded-full shadow-lg flex items-center justify-center transition" title="Management Panel - Checking connection..." aria-live="polite" aria-label="Management Panel ï¿½ Checking connection">
            <i class="fas fa-cog text-2xl"></i>
        </button>
        <span id="gearStatusLabel" class="gear-status-label status-checking active" aria-live="polite">Checking...</span>
    </div>

    <!-- MODALS -->
    <!-- Management modals are embedded below -->
    
    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 bg-black bg-opacity-70 z-[90] hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl p-6 w-full max-w-sm text-gray-800">
            <h3 class="text-xl font-semibold mb-4 text-center" data-i18n="ui.login.title">Management Access</h3>
            <form id="loginForm">
                <div class="space-y-4">
                    <div>
                        <label for="passwordInput" class="block text-sm font-medium text-gray-700" data-i18n="ui.login.password">Password</label>
                        <input type="password" id="passwordInput" name="password" class="mt-1 block w-full px-3 py-2 border border-gray-400 rounded-md shadow-sm sm:text-sm" data-i18n-attr='{"placeholder":"ui.login.enterPassword"}' placeholder="Password" required>
                    </div>
                    <p id="loginError" class="text-sm text-red-600 text-center hidden"></p>
                    <div class="flex gap-2 pt-2">
                        <button type="button" class="w-full py-2 px-4 btn-secondary" onclick="closeLoginModal()" data-i18n="ui.login.cancel">Cancel</button>
                        <button type="submit" id="loginSubmitBtn" class="w-full py-2 px-4 btn-primary" data-i18n="ui.login.login">Login</button>
                    </div>
                </div>
            </form>
            <div class="mt-6 border-t border-gray-200 pt-4 text-center">
                <button type="button" class="inline-flex items-center gap-2 text-green-600 hover:text-green-700 text-sm font-semibold" onclick="openDeviceSettingsQuickModal()">
                    <i class="fas fa-tablet-alt"></i>
                    This Device Settings
                </button>
            </div>
        </div>
    </div>

    <!-- Device Settings Quick Access Modal -->
    <div id="deviceSettingsQuickModal" class="fixed inset-0 bg-black bg-opacity-70 z-[95] hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-xl text-gray-800">
            <div class="flex items-start justify-between px-6 pt-6">
                <div>
                    <div class="flex items-center gap-2">
                        <h3 class="text-lg font-semibold flex items-center gap-2">
                            <i class="fas fa-tablet-alt text-green-600"></i>
                            This Device Settings
                        </h3>
                        <span class="text-xs text-gray-500 bg-green-50 px-2 py-0.5 rounded">Local Only</span>
                    </div>
                    <p class="text-xs text-gray-500 mt-1">Applies only to this station and saves in this browser.</p>
                </div>
                <button type="button" class="text-gray-400 hover:text-gray-600" aria-label="Close device settings" onclick="closeDeviceSettingsQuickModal()">
                    <i class="fas fa-times text-lg"></i>
                </button>
            </div>
            <div class="px-6 pb-6">
                <p class="text-xs text-gray-500 mb-4 flex items-center gap-2">
                    <i class="fas fa-info-circle text-green-500"></i>
                    Perfect for floor staff who just need to rename the tablet or adjust print behavior.
                </p>
                <div id="deviceSettingsModalMount"></div>
                <div class="mt-5 flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between">
                    <div class="flex flex-col gap-3 sm:flex-row sm:gap-4">
                        <button type="button" class="btn-secondary px-4 py-2 text-sm" onclick="closeDeviceSettingsQuickModal()">
                            Done
                        </button>
                        <button type="button" class="btn-primary px-4 py-2 text-sm flex items-center gap-2" onclick="closeDeviceSettingsQuickModal(true)">
                            <i class="fas fa-user-shield"></i>
                            Back to Management Login
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- First-Time Setup Wizard (Phase 4: Multi-device printer redesign) -->
    <div id="setupWizardModal" class="fixed inset-0 bg-black bg-opacity-80 z-[100] hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-2xl w-full max-w-2xl max-h-[90vh] flex flex-col text-gray-800">
            <!-- Wizard Header -->
            <div class="p-6 border-b border-gray-200">
                <h2 class="text-2xl font-bold text-gray-800">Welcome to POSPal!</h2>
                <p class="text-sm text-gray-600 mt-1">Let's set up this device in a few quick steps</p>
                <!-- Progress Indicator -->
                <div class="mt-4 flex items-center gap-2">
                    <div id="wizardStep1Indicator" class="flex-1 h-2 bg-blue-600 rounded"></div>
                    <div id="wizardStep2Indicator" class="flex-1 h-2 bg-gray-300 rounded"></div>
                    <div id="wizardStep3Indicator" class="flex-1 h-2 bg-gray-300 rounded"></div>
                </div>
            </div>

            <!-- Wizard Content -->
            <div class="flex-1 overflow-y-auto p-6">
                <!-- Step 1: Device Name & Print Behavior -->
                <div id="wizardStep1" class="space-y-6">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Device Information</h3>
                        <div class="space-y-4">
                            <div>
                                <label for="wizardDeviceName" class="block text-sm font-medium text-gray-700 mb-2">
                                    Give this device a friendly name:
                                </label>
                                <input
                                    type="text"
                                    id="wizardDeviceName"
                                    class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                                    placeholder="e.g., Kitchen Tablet 1, Waiter Station, Main POS"
                                    maxlength="50"
                                >
                                <p class="text-xs text-gray-500 mt-1">This helps identify which device printed each order</p>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-3">
                                    How should this device handle printing?
                                </label>
                                <div class="space-y-3">
                                    <label class="flex items-start p-3 border-2 border-gray-300 rounded-md cursor-pointer hover:border-blue-500 transition">
                                        <input type="radio" name="wizardPrintBehavior" value="auto" checked class="mt-1 mr-3">
                                        <div>
                                            <div class="font-medium text-gray-800">Auto-print orders</div>
                                            <div class="text-xs text-gray-600">Recommended for kitchen stations and main POS</div>
                                        </div>
                                    </label>
                                    <label class="flex items-start p-3 border-2 border-gray-300 rounded-md cursor-pointer hover:border-blue-500 transition">
                                        <input type="radio" name="wizardPrintBehavior" value="confirm" class="mt-1 mr-3">
                                        <div>
                                            <div class="font-medium text-gray-800">Confirm before printing</div>
                                            <div class="text-xs text-gray-600">Useful for training or testing</div>
                                        </div>
                                    </label>
                                    <label class="flex items-start p-3 border-2 border-gray-300 rounded-md cursor-pointer hover:border-blue-500 transition">
                                        <input type="radio" name="wizardPrintBehavior" value="disabled" class="mt-1 mr-3">
                                        <div>
                                            <div class="font-medium text-gray-800">Don't print from this device</div>
                                            <div class="text-xs text-gray-600">For waiter tablets (display only)</div>
                                        </div>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Printer Selection & Status -->
                <div id="wizardStep2" class="hidden space-y-6">
                    <div>
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Configure Server Printer</h3>

                        <!-- Printer Selection Section -->
                        <div class="bg-white rounded-lg border border-gray-200 p-4 space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    <i class="fas fa-print mr-1"></i>Select Printer
                                </label>
                                <div class="flex gap-2">
                                    <select
                                        id="wizardPrinterSelect"
                                        class="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                    >
                                        <option value="">Loading printers...</option>
                                    </select>
                                    <button
                                        onclick="wizardRefreshPrinters()"
                                        class="btn-secondary px-3 py-2 rounded-lg"
                                        title="Refresh printer list"
                                    >
                                        <i class="fas fa-sync-alt"></i>
                                    </button>
                                </div>
                            </div>

                            <button
                                id="wizardSavePrinterBtn"
                                onclick="wizardSavePrinter()"
                                class="btn-primary w-full px-4 py-2 rounded-lg"
                            >
                                <i class="fas fa-save mr-2"></i>Save Selected Printer
                            </button>
                        </div>

                        <!-- Current Printer Status -->
                        <div class="bg-gray-50 rounded-lg p-4 space-y-3">
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-700">Current Printer:</span>
                                <span id="wizardPrinterName" class="text-sm font-medium text-gray-900">Not configured</span>
                            </div>
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-700">Status:</span>
                                <span id="wizardPrinterStatus" class="text-sm font-medium">
                                    <i class="fas fa-spinner fa-spin mr-1"></i> Checking...
                                </span>
                            </div>
                            <div id="wizardVerificationInfo" class="text-xs text-gray-600 hidden">
                                <i class="fas fa-info-circle mr-1"></i>
                                <span id="wizardVerificationText"></span>
                            </div>
                        </div>

                        <!-- Test Print Section -->
                        <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg">
                            <p class="text-sm text-blue-900 mb-3">
                                <i class="fas fa-lightbulb mr-2"></i>
                                <strong>Tip:</strong> Save a printer first, then send a test print to verify it works. Only ONE device needs to test.
                            </p>
                            <button
                                id="wizardTestPrintBtn"
                                class="btn-secondary px-4 py-2 rounded w-full sm:w-auto"
                                onclick="wizardTestPrint()"
                            >
                                <i class="fas fa-print mr-2"></i>Send Test Print
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Complete -->
                <div id="wizardStep3" class="hidden space-y-6">
                    <div class="text-center py-8">
                        <div class="inline-flex items-center justify-center w-20 h-20 bg-green-100 rounded-full mb-4">
                            <i class="fas fa-check text-4xl text-green-600"></i>
                        </div>
                        <h3 class="text-2xl font-semibold text-gray-800 mb-2">Setup Complete!</h3>
                        <p class="text-gray-600 mb-6">This device is ready to use POSPal.</p>

                        <div class="bg-gray-50 rounded-lg p-4 text-left max-w-md mx-auto">
                            <h4 class="font-medium text-gray-800 mb-3">Your Settings:</h4>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Device Name:</span>
                                    <span id="wizardSummaryDeviceName" class="font-medium text-gray-900"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Print Behavior:</span>
                                    <span id="wizardSummaryPrintBehavior" class="font-medium text-gray-900"></span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-gray-600">Server Printer:</span>
                                    <span id="wizardSummaryPrinterName" class="font-medium text-gray-900"></span>
                                </div>
                            </div>
                        </div>

                        <p class="text-xs text-gray-500 mt-6">
                            You can change these settings anytime in the Management Panel
                        </p>
                    </div>
                </div>
            </div>

            <!-- Wizard Footer -->
            <div class="p-6 border-t border-gray-200 flex justify-between">
                <button
                    id="wizardBackBtn"
                    class="btn-secondary px-6 py-2 rounded hidden"
                    onclick="wizardGoBack()"
                >
                    <i class="fas fa-arrow-left mr-2"></i>Back
                </button>
                <div class="flex-1"></div>
                <button
                    id="wizardNextBtn"
                    class="btn-primary px-6 py-2 rounded"
                    onclick="wizardGoNext()"
                >
                    Next<i class="fas fa-arrow-right ml-2"></i>
                </button>
                <button
                    id="wizardFinishBtn"
                    class="btn-success px-6 py-2 rounded hidden"
                    onclick="wizardFinish()"
                >
                    <i class="fas fa-check mr-2"></i>Get Started
                </button>
            </div>
        </div>
    </div>

    <!-- Item Option Select Modal -->
    <div id="itemOptionSelectModal" class="fixed inset-0 bg-black bg-opacity-70 z-[60] hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl p-5 w-full max-w-md max-h-[80vh] flex flex-col text-gray-800">
            <h3 id="optionModalItemName" class="text-lg font-semibold mb-1">Select Option</h3>
            <p id="optionModalItemDescription" class="text-sm text-gray-600 mb-3">Please choose an option for the selected item:</p>
            <div id="optionModalOptionsContainer" class="flex-grow overflow-y-auto space-y-2 mb-4 pr-1"></div>
            <div class="flex gap-2 mt-auto">
                <button type="button" class="w-full py-2 px-4 btn-secondary" onclick="cancelOptionSelection()">Cancel</button>
                <button type="button" id="confirmOptionBtn" class="w-full py-2 px-4 btn-primary" onclick="confirmOptionSelection()">Confirm</button>
            </div>
        </div>
    </div>

    <!-- Management Modal -->
    <div id="managementModal" class="fixed inset-0 bg-black bg-opacity-50 z-[70] hidden flex flex-col justify-end sm:justify-center sm:items-center">
        <div class="bg-white shadow-xl w-full h-[90vh] sm:h-auto sm:max-h-[90vh] sm:max-w-6xl flex flex-col text-gray-800 rounded-t-2xl sm:rounded-lg">
            <div class="p-4 border-b border-gray-200 flex flex-wrap gap-3 justify-between items-center flex-shrink-0">
                <div class="flex items-center gap-3 flex-wrap">
                    <h2 class="text-xl font-semibold" data-i18n="ui.management.title">Management</h2>
                    <div id="connectionStatusBanner" class="connection-status-banner status-checking table-mode-only" style="display: none;" role="status" aria-live="polite">
                        <div class="status-icon">
                            <i class="fas fa-circle-notch fa-spin"></i>
                        </div>
                        <div class="status-copy">
                            <div class="status-heading" id="connectionBannerText">Checking connection...</div>
                            <div class="status-subtext" id="connectionBannerSubtext">Verifying server status</div>
                        </div>
                    </div>
                </div>
                <button onclick="closeManagementModal()" class="text-gray-500 hover:text-black"><i class="fas fa-times text-2xl"></i></button>
            </div>

            <div class="p-2 border-b border-gray-200 management-tab-container flex-shrink-0">
                <div class="flex flex-wrap gap-1 rounded-md bg-gray-100 p-1">
                    <button onclick="switchManagementTab('analytics', this)" class="management-tab flex-1 py-2 px-2 text-xs sm:text-sm font-medium rounded-md text-gray-600 hover:bg-gray-200" data-i18n="ui.management.tabs.analytics">Analytics</button>
                    <button onclick="switchManagementTab('items', this)" class="management-tab flex-1 py-2 px-2 text-xs sm:text-sm font-medium rounded-md text-gray-600 hover:bg-gray-200" data-i18n="ui.management.tabs.items">Items</button>
                    <button onclick="switchManagementTab('categories', this)" class="management-tab flex-1 py-2 px-2 text-xs sm:text-sm font-medium rounded-md text-gray-600 hover:bg-gray-200" data-i18n="ui.management.tabs.categories">Categories</button>
                    <button onclick="switchManagementTab('orderHistory', this)" class="management-tab flex-1 py-2 px-2 text-xs sm:text-sm font-medium rounded-md text-gray-600 hover:bg-gray-200" data-i18n="ui.management.tabs.orders">Order History</button>
                    <button onclick="openDaySummaryModal()" class="flex-1 py-2 px-2 text-xs sm:text-sm font-medium rounded-md text-gray-600 hover:bg-gray-200 bg-blue-100" data-i18n="ui.management.tabs.daySummary">Day Summary</button>
                </div>
            </div>
            <div class="flex-grow overflow-y-auto p-4 management-content">
                <div id="analyticsManagement" class="hidden">
                    <div class="flex flex-col sm:flex-row justify-between sm:items-center mb-4 gap-4">
                        <h3 class="text-xl font-semibold text-gray-800" data-i18n="ui.analytics.performanceOverview">Performance Overview</h3>
                        <div class="flex items-center gap-1 bg-gray-100 p-1 rounded-lg flex-wrap">
                            <button onclick="loadAnalyticsData('today', this)" class="date-range-btn flex-grow text-sm px-3 py-1.5 rounded-md transition-colors" data-i18n="ui.analytics.today">Today</button>
                            <button onclick="loadAnalyticsData('week', this)" class="date-range-btn flex-grow text-sm px-3 py-1.5 rounded-md transition-colors" data-i18n="ui.analytics.thisWeek">This Week</button>
                            <button onclick="loadAnalyticsData('month', this)" class="date-range-btn flex-grow text-sm px-3 py-1.5 rounded-md transition-colors" data-i18n="ui.analytics.thisMonth">This Month</button>
                            <button onclick="toggleCustomDateRangeUI(this)" class="date-range-btn flex-grow text-sm px-3 py-1.5 rounded-md transition-colors" data-i18n="ui.analytics.custom">Custom</button>
                        </div>
                    </div>
                    <div id="custom-date-range-picker" class="hidden my-4 p-4 bg-gray-100 rounded-lg border border-gray-200">
                        <div class="flex flex-col sm:flex-row items-center gap-4">
                            <div>
                                <label for="startDate" class="block text-sm font-medium text-gray-700" data-i18n="ui.dates.startDate">Start Date</label>
                                <input type="date" id="startDate" name="startDate" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm sm:text-sm">
                            </div>
                            <div>
                                <label for="endDate" class="block text-sm font-medium text-gray-700" data-i18n="ui.dates.endDate">End Date</label>
                                <input type="date" id="endDate" name="endDate" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm sm:text-sm">
                            </div>
                            <div class="self-end pt-1 sm:pt-0">
                                <button onclick="fetchCustomDateRangeAnalytics()" class="w-full sm:w-auto py-2 px-4 btn-primary rounded-md" data-i18n="ui.analytics.go">Go</button>
                            </div>
                        </div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-4">
                        <div class="bg-gray-50 p-4 rounded-lg shadow"><h4 class="text-sm font-medium text-gray-500" data-i18n="ui.analytics.kpi.grossRevenue">Gross Revenue</h4><p id="kpi-gross-revenue" class="text-3xl font-bold text-gray-900 mt-1">&euro;0.00</p></div>
                        <div class="bg-gray-50 p-4 rounded-lg shadow"><h4 class="text-sm font-medium text-gray-500" data-i18n="ui.analytics.kpi.totalOrders">Total Orders</h4><p id="kpi-total-orders" class="text-3xl font-bold text-gray-900 mt-1">0</p></div>
                        <div class="bg-gray-50 p-4 rounded-lg shadow"><h4 class="text-sm font-medium text-gray-500" data-i18n="ui.analytics.kpi.avgOrderValue">Avg. Order Value</h4><p id="kpi-atv" class="text-3xl font-bold text-gray-900 mt-1">&euro;0.00</p></div>
                        <div class="bg-gray-50 p-4 rounded-lg shadow"><h4 class="text-sm font-medium text-gray-500" data-i18n="ui.analytics.kpi.itemsPerOrder">Items per Order</h4><p id="kpi-items-per-order" class="text-3xl font-bold text-gray-900 mt-1">-</p></div>
                    </div>

                    <!-- Payment Methods Section -->
                    <div class="bg-white p-4 rounded-lg border mb-4">
                        <h4 class="font-semibold text-gray-700 mb-3">Payment Methods</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-sm text-gray-600"><i class="fas fa-money-bill-wave mr-2 text-green-500"></i>Cash</span>
                                    <span id="kpi-payment-cash" class="font-bold text-gray-800">&euro;0.00</span>
                                </div>
                                <div class="text-xs text-gray-500 ml-6" id="kpi-payment-cash-count">0 transactions</div>
                            </div>
                            <div>
                                <div class="flex justify-between items-center mb-2">
                                    <span class="text-sm text-gray-600"><i class="far fa-credit-card mr-2 text-blue-500"></i>Card</span>
                                    <span id="kpi-payment-card" class="font-bold text-gray-800">&euro;0.00</span>
                                </div>
                                <div class="text-xs text-gray-500 ml-6" id="kpi-payment-card-count">0 transactions</div>
                            </div>
                        </div>
                        <div class="mt-4 pt-3 border-t border-gray-200">
                            <div class="flex items-center gap-2 mb-2">
                                <div class="flex-1 bg-gray-200 rounded-full h-3 overflow-hidden">
                                    <div id="kpi-payment-cash-bar" class="bg-green-500 h-full transition-all duration-300" style="width: 50%"></div>
                                </div>
                            </div>
                            <div class="flex justify-between text-xs text-gray-500">
                                <span id="kpi-payment-cash-percent">50% Cash</span>
                                <span id="kpi-payment-card-percent">50% Card</span>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div class="bg-white p-4 rounded-lg border"><h4 class="font-semibold text-gray-700 mb-3" data-i18n="ui.analytics.salesByHour">Sales by Hour</h4><div class="overflow-x-auto" style="overflow-y:hidden; padding-bottom:0.5rem"><div id="analytics-chart-container" class="flex items-end space-x-4" style="height:14rem"><p style="font-size:12px; color:#6b7280; font-style:italic; width:100%; text-align:center" data-i18n="ui.analytics.loadingChartData">Loading chart data...</p></div></div></div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 items-stretch">
                            <div class="bg-white p-4 rounded-lg border h-full" style="display:flex; flex-direction:column"><h4 class="font-semibold text-gray-700 mb-2" data-i18n="ui.analytics.salesByCategory">Sales by Category</h4><div id="kpi-sales-by-category" class="space-y-2" style="flex-grow:1; overflow-y:auto"><p style="font-size:12px; color:#6b7280; font-style:italic" data-i18n="ui.analytics.loadingData">Loading data...</p></div></div>
                            <div class="bg-white p-4 rounded-lg border h-full" style="display:flex; flex-direction:column"><h4 class="font-semibold text-gray-700 mb-2" data-i18n="ui.analytics.topItemsRevenue">Top Items (by Revenue)</h4><div id="kpi-top-revenue-items" class="space-y-2" style="flex-grow:1; overflow-y:auto"><p style="font-size:12px; color:#6b7280; font-style:italic" data-i18n="ui.analytics.loadingData">Loading data...</p></div></div>
                        </div>

                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 items-stretch">
                            <div class="bg-white p-4 rounded-lg border h-full" style="display:flex; flex-direction:column"><h4 class="font-semibold text-gray-700 mb-2" data-i18n="ui.analytics.bestSellersQty">Best Selling Items (by Qty)</h4><div id="kpi-best-sellers" class="space-y-2" style="flex-grow:1; overflow-y:auto"><p style="font-size:12px; color:#6b7280; font-style:italic" data-i18n="ui.analytics.loadingData">Loading data...</p></div></div>
                            <div class="bg-white p-4 rounded-lg border h-full" style="display:flex; flex-direction:column"><h4 class="font-semibold text-gray-700 mb-2" data-i18n="ui.analytics.worstSellersQty">Underperforming Items (by Qty)</h4><div id="kpi-worst-sellers" class="space-y-2" style="flex-grow:1; overflow-y:auto"><p style="font-size:12px; color:#6b7280; font-style:italic" data-i18n="ui.analytics.loadingData">Loading data...</p></div></div>
                        </div>

                        <div class="bg-white p-4 rounded-lg border"><h4 class="font-semibold text-gray-700 mb-2" data-i18n="ui.analytics.topAddons">Top Addï¿½&euro;ï¿½ons / Options</h4><div id="kpi-top-addons" class="space-y-2"><p style="font-size:12px; color:#6b7280; font-style:italic" data-i18n="ui.analytics.noAddonData">No addï¿½&euro;ï¿½on data.</p></div></div>
                    </div>
                </div>
                <div id="itemsManagement" class="hidden">
                    <div class="flex justify-end mb-4"><button onclick="openItemFormModal()" class="btn-success py-2 px-4 rounded-md flex items-center"><i class="fas fa-plus mr-2"></i><span data-i18n="ui.items.addNewItem">Add New Item</span></button></div>
                    <h4 class="text-md font-medium text-gray-800 mb-2" data-i18n="ui.items.existingItems">Existing Items</h4>
                    <div id="existingItemsListModal" class="space-y-3 pr-2 border border-gray-200 rounded-md p-2 bg-gray-50"><p class="text-xs text-gray-500 italic" data-i18n="ui.items.noItemsFound">No items found.</p></div>
                </div>
                <div id="categoriesManagement" class="hidden">
                    <form id="categoryManagementForm" class="space-y-4 management-form">
                        <div><label for="categoryName" class="block text-sm font-medium text-gray-700" data-i18n="ui.category.nameLabel">Category Name</label><input type="text" id="categoryName" name="categoryName" class="mt-1 block w-full px-3 py-2 border border-gray-400 rounded-md shadow-sm sm:text-sm" required></div>
                        <button type="button" onclick="saveCategory()" class="w-full py-2 px-4 btn-success">ðŸ“ <span data-i18n="ui.category.save">Save Category</span></button>
                    </form>
                    <div class="mt-6">
                        <h4 class="text-md font-medium text-gray-800 mb-2">Existing Categories</h4>
                        <div id="existingCategoriesListModal" class="space-y-2 max-h-72 overflow-y-auto pr-1 border border-gray-200 rounded-md p-2 bg-gray-50"><p class="text-xs text-gray-500 italic">No categories found.</p></div>
                    </div>
                </div>
                <div id="orderHistoryManagement" class="hidden">
                    <h3 class="text-lg font-semibold text-gray-800 mb-3" data-i18n="ui.orderHistory.titleToday">Today's Orders</h3>
                    <div class="flex flex-wrap gap-2 items-end mb-3">
                        <div>
                            <label class="block text-xs text-gray-600">Date</label>
                            <input id="ohDate" type="date" class="px-2 py-1 border border-gray-300 rounded text-sm" />
                        </div>
                        <div>
                            <label class="block text-xs text-gray-600">Time Range</label>
                            <select id="ohRange" class="px-2 py-1 border border-gray-300 rounded text-sm">
                                <option value="all">All Day</option>
                                <option value="this_hour">This Hour</option>
                                <option value="last2h">Last 2 Hours</option>
                                <option value="custom">Custom</option>
                            </select>
                        </div>
                        <div id="ohCustomRange" class="hidden flex items-end gap-2">
                            <div>
                                <label class="block text-xs text-gray-600">Start (HH:MM)</label>
                                <input id="ohStart" type="time" class="px-2 py-1 border border-gray-300 rounded text-sm" />
                            </div>
                            <div>
                                <label class="block text-xs text-gray-600">End (HH:MM)</label>
                                <input id="ohEnd" type="time" class="px-2 py-1 border border-gray-300 rounded text-sm" />
                            </div>
                        </div>
                        <div class="flex-1 min-w-[160px]">
                            <label class="block text-xs text-gray-600">Search (Order # or Table)</label>
                            <input id="ohSearch" type="text" class="w-full px-2 py-1 border border-gray-300 rounded text-sm" placeholder="# or table" />
                        </div>
                        <button onclick="loadTodaysOrdersForReprint()" class="px-3 py-2 btn-secondary text-sm"><i class="fas fa-sync-alt mr-1"></i> <span data-i18n="ui.orderHistory.refreshList">Refresh</span></button>
                    </div>
                    <div id="todaysOrdersList" class="space-y-2 max-h-[60vh] overflow-y-auto pr-1 border border-gray-200 rounded-md p-2 bg-gray-50"><p class="text-xs text-gray-500 italic" data-i18n="ui.orderHistory.loadingToday">Loading today's orders...</p></div>
                </div>
                <div id="licenseManagement" class="hidden">
                    <h3 class="text-xl font-semibold text-gray-800 mb-4" data-i18n="ui.license.infoTitle">License & Subscription</h3>

                    <!-- Main Status Card with Essential Information -->
                    <div class="bg-white rounded-xl border border-gray-200 p-6 mb-6 shadow-sm">
                        <div class="flex items-center justify-between mb-6">
                            <div class="flex items-center gap-3">
                                <h4 class="text-lg font-semibold text-gray-800" data-i18n="ui.license.currentStatus">Current Status</h4>
                                <div id="license-status-badge" class="px-3 py-1 rounded-full text-sm font-medium bg-gray-100 text-gray-600">Loading...</div>
                            </div>
                            <button id="quick-portal-btn" onclick="openCustomerPortal()" class="portal-access-btn hidden text-blue-600 hover:text-blue-700 p-2 rounded-md transition-colors" title="Quick Portal Access">
                                <i class="fas fa-external-link-alt text-lg"></i>
                            </button>
                        </div>

                        <div id="license-status-display" class="mb-6">
                            <div class="p-4 bg-gray-50 border border-gray-200 rounded-lg text-sm text-gray-600 flex items-center gap-2">
                                <i class="fas fa-spinner fa-spin text-gray-500"></i>
                                <span data-i18n="ui.license.loadingStatus">Loading license status...</span>
                            </div>
                        </div>

                        <!-- Key Information Cards (2x2 Grid for Active Subscriptions) -->
                        <div id="subscription-details" class="hidden">
                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <!-- Next Payment Date -->
                                <div class="bg-blue-50 p-4 rounded-lg border border-blue-200 text-center">
                                    <div class="text-xs text-blue-600 uppercase tracking-wide font-medium mb-1">Next Payment</div>
                                    <div id="next-billing-date" class="text-lg font-bold text-blue-800">--</div>
                                </div>

                                <!-- Monthly Amount -->
                                <div class="bg-green-50 p-4 rounded-lg border border-green-200 text-center">
                                    <div class="text-xs text-green-600 uppercase tracking-wide font-medium mb-1">Monthly Cost</div>
                                    <div id="subscription-price" class="text-lg font-bold text-green-800">&euro;20.00</div>
                                </div>

                                <!-- Subscription Status -->
                                <div class="bg-emerald-50 p-4 rounded-lg border border-emerald-200 text-center">
                                    <div class="text-xs text-emerald-600 uppercase tracking-wide font-medium mb-1">Status</div>
                                    <div id="subscription-status-display" class="text-lg font-bold text-emerald-800">Active</div>
                                </div>

                                <!-- Days Until Renewal -->
                                <div class="bg-purple-50 p-4 rounded-lg border border-purple-200 text-center">
                                    <div class="text-xs text-purple-600 uppercase tracking-wide font-medium mb-1">Renewal In</div>
                                    <div id="days-until-renewal" class="text-lg font-bold text-purple-800">-- days</div>
                                </div>
                            </div>

                            <!-- Prominent Manage Subscription Button -->
                            <div class="text-center">
                                <button id="manage-subscription-btn" onclick="openCustomerPortal()" class="btn-primary px-8 py-3 rounded-lg text-base font-semibold hover:transform hover:scale-105 transition-all duration-200 shadow-md">
                                    <i class="fas fa-cog mr-3"></i>
                                    Manage Subscription
                                </button>
                                <p class="text-xs text-gray-500 mt-2">Cancel, update payment method, or view billing history</p>
                            </div>
                        </div>

                        <!-- Trial Information Cards (for Trial Users) -->
                        <div id="trial-details" class="hidden">
                            <div class="grid grid-cols-2 gap-4 mb-6">
                                <!-- Trial Status -->
                                <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200 text-center">
                                    <div class="text-xs text-yellow-600 uppercase tracking-wide font-medium mb-1">Trial Status</div>
                                    <div id="trial-status-display" class="text-lg font-bold text-yellow-800">Active Trial</div>
                                </div>

                                <!-- Days Remaining -->
                                <div class="bg-orange-50 p-4 rounded-lg border border-orange-200 text-center">
                                    <div class="text-xs text-orange-600 uppercase tracking-wide font-medium mb-1">Days Remaining</div>
                                    <div id="trial-days-remaining" class="text-lg font-bold text-orange-800">-- days</div>
                                </div>

                                <!-- Orders Processed -->
                                <div class="bg-blue-50 p-4 rounded-lg border border-blue-200 text-center">
                                    <div class="text-xs text-blue-600 uppercase tracking-wide font-medium mb-1">Orders Processed</div>
                                    <div id="trial-orders-count" class="text-lg font-bold text-blue-800">0</div>
                                </div>

                                <!-- Revenue Tracked -->
                                <div class="bg-green-50 p-4 rounded-lg border border-green-200 text-center">
                                    <div class="text-xs text-green-600 uppercase tracking-wide font-medium mb-1">Revenue Tracked</div>
                                    <div id="trial-revenue-amount" class="text-lg font-bold text-green-800">&euro;0.00</div>
                                </div>
                            </div>
                        </div>

                        <!-- Trial/Expired Actions (shown for trial/expired users) -->
                        <div id="trial-actions" class="hidden text-center">
                            <div class="mb-6">
                                <button type="button" class="btn-primary px-8 py-3 rounded-lg text-base font-semibold mb-3 hover:transform hover:scale-105 transition-all duration-200 shadow-md" onclick="showEmbeddedPayment()">
                                    <i class="fas fa-credit-card mr-3"></i>
                                    Subscribe - &euro;20/month
                                </button>
                                <p class="text-xs text-gray-500 mb-4">Instant access ï¿½&euro;ï¿½ Cancel anytime</p>

                                <button type="button" class="btn-secondary px-6 py-2 rounded-md text-sm font-medium" onclick="showUnlockDialog()">
                                    <i class="fas fa-key mr-2"></i>
                                    Already paid? Enter unlock code
                                </button>
                            </div>

                            <div class="border-t border-gray-200 pt-4">
                                <button type="button" class="text-blue-600 hover:text-blue-700 text-sm font-medium hover:underline transition-colors" onclick="showLicenseRecoveryModal()">
                                    <i class="fas fa-envelope mr-1"></i>
                                    Lost your license key? Recover it here
                                </button>
                            </div>
                        </div>

                        <!-- Loading State -->
                        <div id="license-loading" class="text-center py-8 hidden">
                            <div class="inline-flex items-center text-gray-600">
                                <i class="fas fa-spinner fa-spin mr-2"></i>
                                <span>Loading subscription information...</span>
                            </div>
                        </div>
                    </div>

                    
                    <!-- Device & Advanced Controls -->
                    <div class="mb-6 grid gap-6 lg:grid-cols-2">
                        <div class="bg-white rounded-xl border border-gray-200 p-6 shadow-sm">
                            <h4 class="text-lg font-semibold text-gray-800 mb-2">Device Session</h4>
                            <p class="text-sm text-gray-600 mb-4">This terminal is currently signed in. Release it before moving POSPal to replacement hardware.</p>
                            <div class="space-y-3">
                                <div class="flex items-center justify-between bg-gray-50 border rounded-lg px-4 py-3 text-sm text-gray-700">
                                    <span class="font-medium">Current Device</span>
                                    <span id="license-session-label" class="text-gray-500">Active</span>
                                </div>
                                <button onclick="showDisconnectLicenseModal()"
                                        id="disconnect-license-btn"
                                        class="w-full btn-outline py-2 px-3 text-sm rounded-md text-left text-red-600 hover:bg-red-50 border-red-300 transition-colors">
                                    <i class="fas fa-unlink mr-2"></i>
                                    Release This Device
                                </button>
                                <p class="text-xs text-gray-500">Releasing ends this session immediately and clears cached license data on this device.</p>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl border border-gray-200 p-6 shadow-sm">
                            <h4 class="text-lg font-semibold text-gray-800 mb-2">Advanced Details</h4>
                            <p class="text-sm text-gray-600 mb-4">Support may request these identifiers when troubleshooting activations.</p>
                            <div class="bg-gray-50 p-4 rounded-lg flex items-center justify-between border">
                                <code id="hardware-id-display" class="text-sm font-mono text-gray-800 flex-1 mr-4 break-all">Loading...</code>
                                <button id="copy-hwid-btn" class="copy-btn flex-shrink-0 px-3 py-2 text-sm" onclick="copyHardwareId()">
                                    <i class="far fa-copy mr-1"></i>
                                    Copy
                                </button>
                            </div>
                            <p class="text-xs text-gray-500 mt-2">POSPal shares this fingerprint automatically during validation. Copy it only if Support asks for it.</p>
                        </div>
                    </div>

                    <!-- About Section -->
                    <div class="bg-gray-50 rounded-xl p-6 border border-gray-200">
                        <h4 class="text-lg font-semibold text-gray-800 mb-3" data-i18n="ui.license.about">About POSPal</h4>
                        <p class="text-sm text-gray-600 mb-4">Â© 2025 Anastasia Palamoutsi & Robert Zoumboulis-Airey. All rights reserved.</p>
                        <div class="flex flex-wrap gap-4 text-sm">
                            <a href="https://github.com/Radot1/POSPal/blob/main/EULA.md" target="_blank" class="text-blue-600 hover:underline transition-colors" data-i18n="ui.license.viewEula">EULA</a>
                            <a href="https://github.com/Radot1/POSPal/blob/main/PRIVACY.md" target="_blank" class="text-blue-600 hover:underline transition-colors" data-i18n="ui.license.privacyPolicy">Privacy Policy</a>
                            <a href="https://github.com/Radot1/POSPal/releases/latest" target="_blank" class="text-blue-600 hover:underline transition-colors" data-i18n="ui.license.releases">Releases</a>
                        </div>
                    </div>
                </div>
                <div id="hardwarePrintingManagement" class="hidden">
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">Hardware &amp; Printing</h3>
                    <div class="space-y-4">
                        <div class="bg-purple-50 border border-purple-200 rounded-lg p-3 text-sm text-gray-700">
                            <div class="font-semibold text-purple-800 flex items-center gap-2">
                                <i class="fas fa-map-signs"></i>
                                Hardware setup checklist
                            </div>
                            <ol class="mt-2 list-decimal list-inside space-y-1 text-xs text-gray-600">
                                <li>Start with the global <strong>Server Printer</strong>: select the thermal printer, tweak cut/copy options, and run a test print.</li>
                                <li>Complete the <strong>Business Profile</strong> card so every receipt shows the correct venue, contact, and tax/ABN details.</li>
                                <li>Name each tablet inside <strong>This Device Settings</strong> and choose whether it prints locally, echoes the server, or stays silent.</li>
                                <li>Enable <strong>Table Management</strong> when you need floor plans, then add tables so they appear inside Table Mode.</li>
                                <li>Finish by rotating the management password and using <strong>Mobile Connection Fix</strong> if phones or tablets cannot reach POSPal.</li>
                            </ol>
                        </div>
                        <!-- Server Printer Configuration (Global - affects all devices) -->
                        <div class="bg-white p-4 rounded-lg border-2 border-blue-200">
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="font-semibold text-gray-800 flex items-center">
                                    <i class="fas fa-server mr-2 text-blue-600"></i>
                                    Server Printer
                                </h4>
                                <span class="text-xs text-gray-500 bg-blue-50 px-2 py-1 rounded">Global Setting</span>
                            </div>
                            <p class="text-xs text-gray-600 mb-3">This printer is used by all devices connected to this server.</p>

                            <div class="space-y-3">
                                <div class="flex items-center gap-2 flex-wrap">
                                    <select id="printerSelect" class="px-3 py-2 border border-gray-300 rounded-md bg-white text-sm flex-1 min-w-[250px]"></select>
                                    <button class="btn-secondary px-3 py-2 rounded text-sm" onclick="refreshPrinters()">
                                        <i class="fas fa-sync-alt mr-1"></i>Refresh
                                    </button>
                                    <button class="btn-primary px-3 py-2 rounded text-sm" onclick="saveSelectedPrinter()">
                                        <i class="fas fa-save mr-1"></i>Save
                                    </button>
                                </div>

                                <div class="flex items-center justify-between bg-gray-50 rounded p-2">
                                    <span class="text-sm text-gray-700">Status:</span>
                                    <span id="printerStatusDot" class="inline-flex items-center text-xs"></span>
                                </div>

                                <div class="flex items-center gap-2">
                                    <button class="btn-secondary px-4 py-2 rounded text-sm" onclick="testPrint()">
                                        <i class="fas fa-print mr-1"></i>Test Print
                                    </button>
                                    <span id="lastTestPrintResult" class="text-xs text-gray-600"></span>
                                </div>

                                <div class="flex items-center gap-4 text-sm pt-2 border-t border-gray-200">
                                    <label class="inline-flex items-center gap-2 text-sm"><input type="checkbox" id="cutAfterPrintToggle" class="h-4 w-4"> <span data-i18n="ui.printing.cutAfterPrint">Cut after print</span></label>
                                    <label class="inline-flex items-center gap-2 text-sm">
                                        <span>Copies per order</span>
                                        <input type="number" id="copiesPerOrderInput" min="1" max="10" step="1" class="px-2 py-1 border border-gray-300 rounded w-20" />
                                    </label>
                                </div>
                                <details class="text-xs text-gray-600">
                                    <summary class="cursor-pointer text-blue-600 hover:text-blue-800 font-medium">
                                        <i class="fas fa-question-circle mr-1"></i>Need help finding your thermal printer?
                                    </summary>
                                    <div class="mt-2 p-3 bg-blue-50 rounded border border-blue-200">
                                        <p class="font-medium mb-2 text-blue-900">Look for these printer names:</p>
                                        <ul class="list-disc list-inside space-y-1 ml-2 text-blue-800">
                                            <li>Epson TM-T20, TM-T82, TM-T88 series</li>
                                            <li>Star TSP100, TSP143, TSP650, TSP700</li>
                                            <li>POS-80, POS-58 (common thermal printers)</li>
                                            <li>"Generic / Text Only" (may work)</li>
                                        </ul>
                                        <p class="mt-2 text-blue-700"><i class="fas fa-print mr-1"></i>ðŸ–¨ï¸ icon indicates a detected thermal printer (recommended)</p>
                                    </div>
                                </details>
                        </div>
                    </div>

                    <!-- Business Profile -->
                    <div class="bg-white p-4 rounded-lg border-2 border-purple-200">
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="font-semibold text-gray-800 flex items-center gap-2">
                                <i class="fas fa-receipt text-purple-600"></i>
                                Business Profile (Receipts)
                            </h4>
                            <span class="text-xs text-gray-500">Printed on customer receipts</span>
                        </div>
                        <p class="text-xs text-gray-600 mb-4">
                            Keep these details current so every customer receipt shows the correct venue information.
                        </p>
                        <div class="grid gap-3 md:grid-cols-2">
                            <div>
                                <label for="businessNameInput" class="block text-sm font-medium text-gray-700">Business Name<span class="text-red-500">*</span></label>
                                <input id="businessNameInput" type="text" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md text-sm" placeholder="Cafe Flora">
                            </div>
                            <div>
                                <label for="businessPhoneInput" class="block text-sm font-medium text-gray-700">Phone</label>
                                <input id="businessPhoneInput" type="text" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md text-sm" placeholder="+61 3 5555 1234">
                            </div>
                            <div>
                                <label for="businessEmailInput" class="block text-sm font-medium text-gray-700">Email</label>
                                <input id="businessEmailInput" type="email" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md text-sm" placeholder="hello@example.com">
                            </div>
                            <div>
                                <label for="businessWebsiteInput" class="block text-sm font-medium text-gray-700">Website</label>
                                <input id="businessWebsiteInput" type="text" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md text-sm" placeholder="example.com">
                            </div>
                            <div class="md:col-span-2">
                                <label for="businessAddressInput" class="block text-sm font-medium text-gray-700">Address</label>
                                <textarea id="businessAddressInput" rows="2" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md text-sm" placeholder="123 High Street&#10;Melbourne VIC 3000"></textarea>
                            </div>
                            <div>
                                <label for="businessTaxInput" class="block text-sm font-medium text-gray-700">Tax / ABN / VAT</label>
                                <input id="businessTaxInput" type="text" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md text-sm" placeholder="ABN 12 345 678 901">
                            </div>
                            <div class="md:col-span-2">
                                <label for="businessFooterInput" class="block text-sm font-medium text-gray-700">Footer Message</label>
                                <textarea id="businessFooterInput" rows="2" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md text-sm" placeholder="Thank you for supporting local!"></textarea>
                            </div>
                        </div>
                        <div class="mt-3 flex items-center gap-3 flex-wrap">
                            <span id="businessProfileStatus" class="text-xs text-gray-500">Not configured</span>
                            <button id="businessProfileSaveBtn" onclick="saveBusinessProfile()" class="btn-primary px-4 py-2 rounded text-sm flex items-center gap-2">
                                <i class="fas fa-save"></i> Save Profile
                            </button>
                        </div>
                    </div>

                    <!-- Device Settings (Local - this device only) -->
                    <div id="deviceSettingsManagementMount">
                        <div id="deviceSettingsPanel" class="bg-white p-4 rounded-lg border-2 border-green-200">
                            <div class="flex items-center justify-between mb-3">
                                <h4 class="font-semibold text-gray-800 flex items-center">
                                    <i class="fas fa-tablet-alt mr-2 text-green-600"></i>
                                    This Device Settings
                                </h4>
                                <span class="text-xs text-gray-500 bg-green-50 px-2 py-1 rounded">Local Only</span>
                            </div>
                            <p class="text-xs text-gray-600 mb-3">These settings apply only to this device and are stored locally in the browser.</p>

                            <div class="space-y-4">
                                <!-- Device Name -->
                                <div>
                                    <label for="deviceNameInput" class="block text-sm font-medium text-gray-700 mb-2">
                                        Device Name
                                    </label>
                                    <div class="flex items-center gap-2">
                                        <input
                                            type="text"
                                            id="deviceNameInput"
                                            class="flex-1 px-3 py-2 border border-gray-300 rounded-md text-sm focus:ring-2 focus:ring-green-500 focus:border-green-500"
                                            placeholder="e.g., Kitchen Tablet 1"
                                            maxlength="50"
                                        >
                                        <button class="btn-primary px-4 py-2 rounded text-sm" onclick="saveDeviceName()">
                                            <i class="fas fa-save mr-1"></i>Save
                                        </button>
                                    </div>
                                    <p class="text-xs text-gray-500 mt-1">
                                        <i class="fas fa-info-circle mr-1"></i>
                                        Helps identify which device printed each order
                                    </p>
                                </div>

                                <!-- Print Behavior -->
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        Print Behavior
                                    </label>
                                    <div class="space-y-2">
                                        <label class="flex items-start p-2 border-2 border-gray-200 rounded cursor-pointer hover:border-green-500 hover:bg-green-50 transition">
                                            <input type="radio" name="devicePrintBehavior" value="auto" class="mt-1 mr-3">
                                            <div class="flex-1">
                                                <div class="font-medium text-gray-800 text-sm">Auto-print orders</div>
                                                <div class="text-xs text-gray-600">Orders print automatically (recommended for kitchen stations)</div>
                                            </div>
                                        </label>
                                        <label class="flex items-start p-2 border-2 border-gray-200 rounded cursor-pointer hover:border-green-500 hover:bg-green-50 transition">
                                            <input type="radio" name="devicePrintBehavior" value="confirm" class="mt-1 mr-3">
                                            <div class="flex-1">
                                                <div class="font-medium text-gray-800 text-sm">Confirm before printing</div>
                                                <div class="text-xs text-gray-600">Asks for confirmation (useful for training)</div>
                                            </div>
                                        </label>
                                        <label class="flex items-start p-2 border-2 border-gray-200 rounded cursor-pointer hover:border-green-500 hover:bg-green-50 transition">
                                            <input type="radio" name="devicePrintBehavior" value="disabled" class="mt-1 mr-3">
                                            <div class="flex-1">
                                                <div class="font-medium text-gray-800 text-sm">Don't print from this device</div>
                                                <div class="text-xs text-gray-600">Display only (for waiter tablets)</div>
                                            </div>
                                        </label>
                                    </div>
                                    <button class="btn-primary px-4 py-2 rounded text-sm mt-2" onclick="saveDevicePrintBehavior()">
                                        <i class="fas fa-save mr-1"></i>Save Print Behavior
                                    </button>
                                </div>

                                <!-- Device Info Summary -->
                                <div class="bg-gray-50 rounded p-3 text-xs">
                                    <div class="font-medium text-gray-700 mb-2">
                                        <i class="fas fa-info-circle mr-1"></i>Current Device Info:
                                    </div>
                                    <div class="space-y-1 text-gray-600">
                                        <div><strong>Device ID:</strong> <span id="deviceInfoId" class="font-mono">Loading...</span></div>
                                        <div><strong>Name:</strong> <span id="deviceInfoName">Loading...</span></div>
                                        <div><strong>Behavior:</strong> <span id="deviceInfoBehavior">Loading...</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- General Settings -->
                        <div class="bg-white p-3 rounded border">
                            <div class="flex items-start justify-between gap-4">
                                <div>
                                    <h4 class="font-medium text-gray-700 mb-1">General Settings</h4>
                                    <p class="text-xs text-gray-500">Choose the interface language your staff will see inside POS.</p>
                                </div>
                            </div>
                            <div class="flex items-center gap-3 flex-wrap mt-4">
                                <label for="languageSelect" class="text-sm text-gray-700" data-i18n="ui.management.general.language">Language</label>
                                <select id="languageSelect" class="px-3 py-1.5 border border-gray-300 rounded-md text-sm">
                                    <option value="en" data-i18n="ui.management.general.lang_en">English</option>
                                    <option value="el" data-i18n="ui.management.general.lang_el">Greek</option>
                                </select>
                            </div>
                        </div>
                    </div>

                        <!-- Table Management -->
                        <div class="bg-white p-3 rounded border">
                            <div class="flex items-start justify-between gap-4">
                                <div>
                                    <h4 class="font-medium text-gray-700 mb-1">Table Management</h4>
                                    <p class="text-xs text-gray-500">Unlock dine-in layouts, monitor table turns, and use Table Mode inside the POS.</p>
                                </div>
                                <label class="inline-flex items-center gap-2 text-sm cursor-pointer select-none">
                                    <span class="font-medium text-gray-700">Enable</span>
                                    <input type="checkbox" id="tableManagementToggle" class="h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" onchange="toggleTableManagement(this.checked)">
                                </label>
                            </div>
                            <div class="mt-3 text-xs text-gray-500 flex items-center gap-2 border border-dashed border-gray-300 rounded px-3 py-2">
                                <i class="fas fa-chair text-blue-500"></i>
                                <span>Keep this on to manage floor plans and assign orders to tables.</span>
                            </div>

                            <!-- Table Configuration Section (shown when table management is enabled) -->
                            <div id="tableConfigSection" style="display: none;" class="mt-4 bg-gray-50 rounded-lg p-3 border border-gray-200">
                                <div class="flex items-center justify-between mb-3">
                                    <h5 class="font-medium text-gray-700 text-sm flex items-center">
                                        <i class="fas fa-chair mr-2"></i>Configure Tables
                                    </h5>
                                    <button onclick="addNewTable()" class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-xs font-medium flex items-center gap-1">
                                        <i class="fas fa-plus"></i> Add Table
                                    </button>
                                </div>

                                <div id="tableConfigList" class="space-y-2 max-h-64 overflow-y-auto">
                                    <!-- Table items will be dynamically loaded here -->
                                </div>

                                <div class="mt-3 pt-3 border-t border-gray-300 text-xs text-gray-500 flex items-center gap-2">
                                    <i class="fas fa-info-circle"></i>
                                    <span>Tables configured here will be available in the Table Mode view.</span>
                                </div>
                            </div>
                        </div>
                        <div class="bg-white p-3 rounded border">
                            <h4 class="font-medium text-gray-700 mb-2" data-i18n="ui.password.changePassword">Change Password</h4>
                            <p class="text-xs text-gray-500 mb-3">Protect these management settings by rotating the password and only sharing it with trusted staff.</p>
                            <div class="grid gap-2 md:grid-cols-3">
                                <input id="currentPasswordInput" type="password" class="px-3 py-2 border border-gray-300 rounded-md text-sm" data-i18n-attr='{"placeholder":"ui.password.current"}' placeholder="Current">
                                <input id="newPasswordInput" type="password" class="px-3 py-2 border border-gray-300 rounded-md text-sm" data-i18n-attr='{"placeholder":"ui.password.new"}' placeholder="New">
                                <input id="confirmPasswordInput" type="password" class="px-3 py-2 border border-gray-300 rounded-md text-sm" data-i18n-attr='{"placeholder":"ui.password.confirm"}' placeholder="Confirm">
                            </div>
                            <button class="btn-primary mt-2 px-4 py-2 rounded" onclick="changeManagementPassword()" data-i18n="ui.password.savePassword">Save Password</button>
                        </div>
                        <div class="bg-white p-3 rounded border">
                            <h4 class="font-medium text-gray-700 mb-2">
                                <i class="fas fa-network-wired mr-2"></i>Mobile Connection Fix
                            </h4>
                            <p class="text-xs text-gray-500 mb-3">If phones and tablets cannot reach POSPal, quickly test ports here without leaving the app.</p>
                            
                            <!-- Collapsible Instructions -->
                            <div class="mb-3">
                                <button onclick="toggleInstructions()" class="flex items-center gap-2 text-sm text-blue-600 hover:text-blue-800">
                                    <i id="instructionsArrow" class="fas fa-chevron-right transition-transform"></i>
                                    <span>Click here for setup instructions</span>
                                </button>
                                <div id="instructionsPanel" class="hidden mt-2 bg-blue-50 border border-blue-200 rounded p-3 text-sm">
                                    <div class="font-medium text-blue-900 mb-2"><i class="fas fa-info-circle mr-1"></i>How to Use This Feature</div>
                                    <div class="space-y-1 text-blue-800 text-xs">
                                        <div><strong><i class="fas fa-exclamation-triangle mr-1 text-blue-600"></i>Problem:</strong> Mobile devices can't access POSPal (white screen, timeout)</div>
                                        <div><strong><i class="fas fa-toolbox mr-1 text-blue-600"></i>Try this:</strong> Change the server port until one works on your network</div>
                                        <div><strong><i class="fas fa-list-ol mr-1 text-blue-600"></i>Steps:</strong></div>
                                        <div class="ml-4 space-y-0.5">
                                            <div>1. Make sure POSPal is running as Administrator</div>
                                            <div>2. Pick a different port below</div>  
                                            <div>3. Click "Change Port"</div>
                                            <div>4. Try connecting from mobile again</div>
                                            <div>5. If still doesn't work, try another port</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Admin Status -->
                            <div id="adminStatus" class="p-2 rounded text-sm mb-3">
                                <span id="adminStatusText" class="font-medium"></span>
                            </div>
                            
                            <!-- Port Selection -->
                            <div id="portSelectionArea" class="space-y-3">
                                <div class="font-medium text-sm">
                                    Current Port: <span id="currentPortDisplay" class="font-mono bg-gray-100 px-2 py-1 rounded">5000</span>
                                </div>
                                
                                <div>
                                    <div class="text-sm text-gray-700 mb-2">Try a different port:</div>
                                    <div class="space-y-2">
                                        <label class="flex items-center gap-2 p-2 border rounded hover:bg-gray-50 cursor-pointer">
                                            <input type="radio" name="selectedPort" value="8080" class="h-4 w-4">
                                            <span class="font-mono">8080</span>
                                            <span class="text-xs text-gray-500">- Most common alternative</span>
                                        </label>
                                        <label class="flex items-center gap-2 p-2 border rounded hover:bg-gray-50 cursor-pointer">
                                            <input type="radio" name="selectedPort" value="3000" class="h-4 w-4">
                                            <span class="font-mono">3000</span>
                                            <span class="text-xs text-gray-500">- Development port</span>
                                        </label>
                                        <label class="flex items-center gap-2 p-2 border rounded hover:bg-gray-50 cursor-pointer">
                                            <input type="radio" name="selectedPort" value="8000" class="h-4 w-4">
                                            <span class="font-mono">8000</span>
                                            <span class="text-xs text-gray-500">- Alternative web port</span>
                                        </label>
                                        <label class="flex items-center gap-2 p-2 border rounded hover:bg-gray-50 cursor-pointer">
                                            <input type="radio" name="selectedPort" value="9000" class="h-4 w-4">
                                            <span class="font-mono">9000</span>
                                            <span class="text-xs text-gray-500">- High port option</span>
                                        </label>
                                        <label class="flex items-center gap-2 p-2 border rounded hover:bg-gray-50 cursor-pointer">
                                            <input type="radio" name="selectedPort" value="8888" class="h-4 w-4">
                                            <span class="font-mono">8888</span>
                                            <span class="text-xs text-gray-500">- Easy to remember</span>
                                        </label>
                                        <label class="flex items-center gap-2 p-2 border rounded hover:bg-gray-50 cursor-pointer">
                                            <input type="radio" name="selectedPort" value="5001" class="h-4 w-4">
                                            <span class="font-mono">5001</span>
                                            <span class="text-xs text-gray-500">- Close to default</span>
                                        </label>
                                    </div>
                                </div>
                                
                                <div class="pt-3 border-t">
                                    <button id="changePortBtn" class="btn-primary px-6 py-2 rounded w-full" onclick="changePort()" disabled>
                                        <i class="fas fa-exchange-alt mr-2"></i>Change Port
                                    </button>
                                    <div class="text-xs text-gray-500 text-center mt-1">Select a port above first</div>
                                </div>
                                
                                <div class="text-center">
                                    <span id="portChangeResult" class="text-sm"></span>
                                </div>
                            </div>
                    </div>
                </div>
                <div id="onlineMenuManagement" class="hidden">
                    <h3 class="text-lg font-semibold text-gray-800 mb-3">Online Menu</h3>
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <div class="bg-white p-4 rounded-lg border">
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Store Slug</label>
                                    <input id="cfStoreSlug" type="text" class="w-full px-3 py-2 border border-gray-300 rounded-md" placeholder="e.g., cafe-olive">
                                    <div id="cfSettingsMsg" class="text-xs text-gray-600 mt-1"></div>
                                </div>
                                <button class="btn-success px-4 py-2 rounded" onclick="publishOnlineMenu()"><i class="fas fa-cloud-upload-alt mr-2"></i>Publish Menu</button>
                            </div>
                        </div>
                        <div class="bg-white p-4 rounded-lg border">
                            <h4 class="font-semibold text-gray-700 mb-3">Share</h4>
                            <div class="space-y-3">
                                <div class="flex items-center gap-2">
                                    <input id="cfMenuUrl" readonly class="flex-1 px-3 py-2 border border-gray-300 rounded-md" placeholder="Menu URL will appear here">
                                    <button class="btn-secondary px-2 py-2 rounded text-sm whitespace-nowrap" onclick="copyCloudflareUrl()"><span class="hidden sm:inline">Copy URL</span><span class="sm:hidden">Copy</span></button>
                                </div>
                                <div>
                                    <div id="cfQrContainer" class="inline-block bg-white p-2 border rounded"></div>
                                </div>
                                <div id="cfPublishMsg" class="text-xs text-gray-600"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="appVersionContainer" class="p-3 border-t border-gray-200 bg-gradient-to-t from-gray-50 via-gray-50 to-white flex justify-between items-center text-xs text-gray-500 flex-shrink-0 rounded-b-lg mt-auto">
                <div class="flex items-center gap-4 flex-wrap"><span data-i18n="ui.footer.version">POSPal Version:</span> <span id="appVersion" class="font-medium text-gray-600">1.0.0</span><span id="footer-trial-status" class="font-medium"></span><button onclick="switchManagementTab('license', this)" class="text-gray-500 hover:text-gray-800 hover:underline focus:outline-none focus:ring-2 focus:ring-gray-400 rounded px-1" data-i18n="ui.footer.licenseInfo">License Info</button><button onclick="switchManagementTab('hardwarePrinting', this)" class="text-gray-500 hover:text-gray-800 hover:underline focus:outline-none focus:ring-2 focus:ring-gray-400 rounded px-1" data-i18n="ui.footer.settings">Settings</button><button onclick="switchManagementTab('onlineMenu', this)" class="text-gray-500 hover:text-gray-800 hover:underline focus:outline-none focus:ring-2 focus:ring-gray-400 rounded px-1">Online Menu</button></div>
                <button onclick="shutdownApplication()" class="btn-danger text-white py-1 px-3 rounded-md flex items-center text-xs font-semibold"><i class="fas fa-power-off mr-1.5"></i><span data-i18n="ui.footer.shutdown">Shutdown</span></button>
            </div>
        </div>
    </div>

    <!-- Tables Management Modal -->
    <div id="tablesModal" class="fixed inset-0 bg-black bg-opacity-50 z-[70] hidden flex-col justify-center items-center">
        <div class="bg-white shadow-xl w-full max-w-6xl h-[90vh] flex flex-col text-gray-800 rounded-lg mx-4">
            <!-- Header -->
            <div class="p-4 border-b border-gray-200 flex justify-between items-center flex-shrink-0">
                <h2 class="text-2xl font-bold text-gray-800">
                    <i class="fas fa-utensils mr-2 text-green-600"></i>Table Management
                </h2>
                <button onclick="closeTablesModal()" class="text-gray-500 hover:text-black transition">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>

            <!-- Main Content Area -->
            <div class="flex-grow overflow-y-auto p-6" id="tablesMainView">
                <!-- Loading State -->
                <div id="tablesLoading" class="text-center py-12">
                    <i class="fas fa-spinner fa-spin text-4xl text-gray-400 mb-4"></i>
                    <p class="text-gray-500">Loading tables...</p>
                </div>

                <!-- Tables Grid View -->
                <div id="tablesGridView" class="hidden">
                    <div class="mb-4 flex justify-between items-center">
                        <div class="flex gap-2 items-center">
                            <span class="text-sm text-gray-600">Status:</span>
                            <button onclick="filterTables('all')" class="table-filter-btn active px-3 py-1 rounded text-sm font-medium">All</button>
                            <button onclick="filterTables('available')" class="table-filter-btn px-3 py-1 rounded text-sm font-medium">Available</button>
                            <button onclick="filterTables('occupied')" class="table-filter-btn px-3 py-1 rounded text-sm font-medium">Occupied</button>
                            <button onclick="filterTables('paid')" class="table-filter-btn px-3 py-1 rounded text-sm font-medium">Needs Clearing</button>
                        </div>
                        <button onclick="refreshTables()" class="btn-secondary px-4 py-2 rounded-lg flex items-center gap-2">
                            <i class="fas fa-sync-alt"></i>Refresh
                        </button>
                    </div>

                    <!-- Tables Grid -->
                    <div id="tablesGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
                        <!-- Table cards will be inserted here -->
                    </div>

                    <!-- Empty State -->
                    <div id="tablesEmptyState" class="hidden text-center py-12">
                        <i class="fas fa-table text-6xl text-gray-300 mb-4"></i>
                        <p class="text-gray-500 text-lg">No tables found</p>
                        <p class="text-gray-400 text-sm mt-2">Tables will appear here when configured</p>
                    </div>
                </div>

                <!-- Table Detail View -->
                <div id="tableDetailView" class="hidden">
                    <button onclick="showTablesGrid()" class="mb-4 text-gray-600 hover:text-gray-800 flex items-center gap-2">
                        <i class="fas fa-arrow-left"></i>Back to Tables
                    </button>

                    <!-- Table Header -->
                    <div class="bg-gray-50 rounded-lg p-6 mb-6">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="text-3xl font-bold text-gray-800 mb-2">
                                    Table <span id="detailTableNumber">-</span>
                                </h3>
                                <div id="detailTableStatus" class="inline-block px-3 py-1 rounded-full text-sm font-medium">
                                    <!-- Status badge -->
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="text-sm text-gray-600 mb-1">Current Total</p>
                                <p id="detailTableTotal" class="text-3xl font-bold text-gray-800">0.00</p>
                            </div>
                        </div>
                    </div>

                    <!-- Orders List -->
                    <div class="mb-6">
                        <h4 class="text-lg font-semibold text-gray-800 mb-3">Orders</h4>
                        <div id="tableOrdersList" class="space-y-3">
                            <!-- Orders will be inserted here -->
                        </div>
                        <div id="tableOrdersEmpty" class="hidden text-center py-8 bg-gray-50 rounded-lg">
                            <i class="fas fa-receipt text-4xl text-gray-300 mb-2"></i>
                            <p class="text-gray-500">No orders for this table</p>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="flex gap-3 flex-wrap">
                        <button onclick="viewTableBill()" class="btn-secondary px-6 py-3 rounded-lg flex items-center gap-2">
                            <i class="fas fa-file-invoice"></i>View Bill
                        </button>
                        <button onclick="showSplitBillModal()" class="btn-secondary px-6 py-3 rounded-lg flex items-center gap-2" id="splitBillBtn">
                            <i class="fas fa-scissors"></i>Split Bill
                        </button>
                        <button onclick="markTableAsPaid()" class="btn-success px-6 py-3 rounded-lg flex items-center gap-2" id="markPaidBtn">
                            <i class="fas fa-check"></i>Mark as Paid
                        </button>
                        <button onclick="clearTable()" class="btn-warning px-6 py-3 rounded-lg flex items-center gap-2" id="clearTableBtn">
                            <i class="fas fa-broom"></i>Clear Table
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Split Bill Modal -->
    <div id="splitBillModal" class="fixed inset-0 bg-black bg-opacity-50 z-[75] hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] flex flex-col">
            <div class="p-4 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-xl font-semibold">Split Bill</h3>
                <button onclick="closeSplitBillModal()" class="text-gray-500 hover:text-black">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>

            <!-- Tab Navigation -->
            <div class="border-b border-gray-200 px-6">
                <div class="flex gap-4">
                    <button id="equalSplitTab" onclick="switchSplitTab('equal')" class="px-4 py-3 font-medium text-sm border-b-2 border-blue-600 text-blue-600 transition-colors">
                        Equal Split
                    </button>
                    <button id="byItemsTab" onclick="switchSplitTab('byItems')" class="px-4 py-3 font-medium text-sm border-b-2 border-transparent text-gray-500 hover:text-gray-700 transition-colors">
                        By Items
                    </button>
                </div>
            </div>

            <div class="flex-grow overflow-y-auto p-6">
                <!-- Equal Split Content -->
                <div id="equalSplitContent">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Number of Ways to Split</label>
                        <input type="number" id="splitWaysInput" min="2" max="10" value="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg" onchange="updateSplitPreview()">
                    </div>
                    <div id="splitPreview" class="bg-gray-50 p-4 rounded-lg mb-6">
                        <!-- Split preview will be shown here -->
                    </div>

                    <!-- Payment Recording Section -->
                    <div class="border-t border-gray-200 pt-4">
                        <h4 class="text-sm font-semibold text-gray-700 mb-3">Record Payments</h4>
                        <div id="equalSplitPayments" class="space-y-3">
                            <!-- Payment cards generated by JavaScript -->
                        </div>
                    </div>
                </div>

                <!-- By Items Content -->
                <div id="byItemsContent" class="hidden">
                    <div class="mb-4">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Number of People</label>
                        <select id="numPeopleSelect" class="w-full px-3 py-2 border border-gray-300 rounded-lg" onchange="updateNumPeople()">
                            <option value="2">2 People</option>
                            <option value="3">3 People</option>
                            <option value="4">4 People</option>
                            <option value="5">5 People</option>
                            <option value="6">6 People</option>
                            <option value="7">7 People</option>
                            <option value="8">8 People</option>
                            <option value="9">9 People</option>
                            <option value="10">10 People</option>
                        </select>
                    </div>

                    <div class="mb-4">
                        <h4 class="text-sm font-semibold text-gray-700 mb-3">Assign items to each person:</h4>
                        <div id="itemsListForSplit" class="space-y-3 max-h-64 overflow-y-auto">
                            <!-- Item assignment cards will be generated here -->
                        </div>
                    </div>

                    <!-- Split Summary Panel -->
                    <div id="splitSummaryPanel" class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                        <h4 class="text-sm font-semibold text-gray-700 mb-3">Split Summary</h4>
                        <div id="splitSummaryContent">
                            <!-- Summary will be shown here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Payment Method Modal -->
    <div id="paymentMethodModal" class="fixed inset-0 bg-black bg-opacity-50 z-[75] hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
            <div class="p-6">
                <h3 class="text-xl font-semibold mb-6 text-gray-800">Complete Payment</h3>

                <div class="mb-6">
                    <div class="text-center text-3xl font-bold text-gray-800" id="paymentTotalDisplay">
                        &euro;0.00
                    </div>
                    <div class="text-center text-sm text-gray-500 mt-1">
                        Total Amount
                    </div>
                </div>

                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-3">
                        Payment Method:
                    </label>
                    <div class="grid grid-cols-2 gap-3">
                        <!-- Cash Button -->
                        <button onclick="selectPaymentMethod('cash')"
                                id="paymentMethodCash"
                                class="payment-method-btn selected-payment"
                                type="button">
                            <span class="text-4xl mb-2">ðŸ’µ</span>
                            <span class="font-medium">Cash</span>
                        </button>

                        <!-- Card Button -->
                        <button onclick="selectPaymentMethod('card')"
                                id="paymentMethodCard"
                                class="payment-method-btn"
                                type="button">
                            <span class="text-4xl mb-2">ðŸ’³</span>
                            <span class="font-medium">Card</span>
                        </button>
                    </div>
                </div>

                <div class="flex gap-3">
                    <button onclick="closePaymentMethodModal()" class="flex-1 btn-secondary py-3 rounded-lg">
                        Cancel
                    </button>
                    <button onclick="confirmPayment()" class="flex-1 btn-success py-3 rounded-lg">
                        <i class="fas fa-check mr-2"></i>Confirm Payment
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Table Modal -->
    <div id="addTableModal" class="fixed inset-0 bg-black bg-opacity-50 z-[75] hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md flex flex-col">
            <div class="p-4 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-xl font-semibold text-gray-800">
                    <i class="fas fa-chair mr-2 text-green-600"></i>Add New Table
                </h3>
                <button onclick="closeAddTableModal()" class="text-gray-500 hover:text-black">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <div class="p-6 space-y-4">
                <div>
                    <label for="newTableName" class="block text-sm font-medium text-gray-700 mb-2">
                        Table Name <span class="text-red-500">*</span>
                    </label>
                    <input type="text" id="newTableName" placeholder="e.g., Table 4, VIP Lounge"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                           onkeypress="if(event.key==='Enter') document.getElementById('newTableSeats').focus()"
                           required>
                    <p class="text-xs text-gray-500 mt-1">Enter a unique name for this table</p>
                </div>
                <div>
                    <label for="newTableSeats" class="block text-sm font-medium text-gray-700 mb-2">
                        Number of Seats <span class="text-red-500">*</span>
                    </label>
                    <input type="number" id="newTableSeats" min="1" max="20" value="4"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500"
                           onkeypress="if(event.key==='Enter') saveNewTable()"
                           required>
                    <p class="text-xs text-gray-500 mt-1">Enter the seating capacity (1-20)</p>
                </div>
            </div>
            <div class="p-4 border-t border-gray-200 flex gap-3">
                <button onclick="closeAddTableModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg font-medium transition">
                    Cancel
                </button>
                <button onclick="saveNewTable()" class="flex-1 bg-green-600 hover:bg-green-700 text-white py-2 px-4 rounded-lg font-medium transition">
                    <i class="fas fa-check mr-2"></i>Add Table
                </button>
            </div>
        </div>
    </div>

    <!-- Edit Table Modal -->
    <div id="editTableModal" class="fixed inset-0 bg-black bg-opacity-50 z-[75] hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md flex flex-col">
            <div class="p-4 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-xl font-semibold text-gray-800">
                    <i class="fas fa-edit mr-2 text-blue-600"></i>Edit Table
                </h3>
                <button onclick="closeEditTableModal()" class="text-gray-500 hover:text-black">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>
            <div class="p-6 space-y-4">
                <input type="hidden" id="editTableId">
                <div>
                    <label for="editTableName" class="block text-sm font-medium text-gray-700 mb-2">
                        Table Name <span class="text-red-500">*</span>
                    </label>
                    <input type="text" id="editTableName" placeholder="e.g., Table 4, VIP Lounge"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                           onkeypress="if(event.key==='Enter') document.getElementById('editTableSeats').focus()"
                           required>
                    <p class="text-xs text-gray-500 mt-1">Enter a unique name for this table</p>
                </div>
                <div>
                    <label for="editTableSeats" class="block text-sm font-medium text-gray-700 mb-2">
                        Number of Seats <span class="text-red-500">*</span>
                    </label>
                    <input type="number" id="editTableSeats" min="1" max="20" value="4"
                           class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
                           onkeypress="if(event.key==='Enter') saveEditedTable()"
                           required>
                    <p class="text-xs text-gray-500 mt-1">Enter the seating capacity (1-20)</p>
                </div>
            </div>
            <div class="p-4 border-t border-gray-200 flex gap-3">
                <button onclick="closeEditTableModal()" class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-2 px-4 rounded-lg font-medium transition">
                    Cancel
                </button>
                <button onclick="saveEditedTable()" class="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-2 px-4 rounded-lg font-medium transition">
                    <i class="fas fa-save mr-2"></i>Save Changes
                </button>
            </div>
        </div>
    </div>

    <!-- Item Form Modal -->
    <div id="itemFormModal" class="fixed inset-0 bg-black bg-opacity-70 z-[80] hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] flex flex-col">
            <div class="p-4 border-b border-gray-300 flex justify-between items-center"><h2 id="itemFormModalTitle" class="text-xl font-semibold">Add/Edit Item</h2><button onclick="closeItemFormModal()" class="text-gray-500 hover:text-black"><i class="fas fa-times text-2xl"></i></button></div>
            <div class="flex-grow overflow-y-auto p-4">
                <form id="itemManagementForm" class="space-y-4 management-form">
                    <input type="hidden" id="itemId" name="itemId">
                    <div class="grid gap-4 md:grid-cols-2">
                        <div><label for="itemName" class="block text-sm font-medium text-gray-700">Item Name</label><input type="text" id="itemName" name="itemName" class="mt-1 block w-full px-3 py-2 border border-gray-400 rounded-md shadow-sm sm:text-sm" required></div>
                        <div><label for="itemPrice" class="block text-sm font-medium text-gray-700">Base Price (&euro;)</label><input type="number" step="0.01" id="itemPrice" name="itemPrice" inputmode="decimal" class="mt-1 block w-full px-3 py-2 border border-gray-400 rounded-md shadow-sm sm:text-sm" required></div>
                    </div>
                    <div><label for="itemCategory" class="block text-sm font-medium text-gray-700">Category</label><select id="itemCategory" name="itemCategory" class="mt-1 block w-full px-3 py-2 border border-gray-400 bg-white rounded-md shadow-sm sm:text-sm" required></select></div>

                    <!-- Enhanced Menu Fields -->
                    <div class="space-y-4 p-3 border border-gray-300 rounded-md bg-gray-50">
                        <h4 class="text-sm font-semibold text-gray-700 mb-2">ðŸ“ Enhanced Menu Information</h4>

                        <!-- Description -->
                        <div>
                            <label for="itemDescription" class="block text-sm font-medium text-gray-700">Description</label>
                            <textarea id="itemDescription" name="itemDescription" rows="2" placeholder="Brief description of the item..." class="mt-1 block w-full px-3 py-2 border border-gray-400 rounded-md shadow-sm sm:text-sm resize-none"></textarea>
                        </div>

                        <!-- Preparation Time -->
                        <div class="grid gap-4 md:grid-cols-2">
                            <div>
                                <label for="itemPrepTime" class="block text-sm font-medium text-gray-700">Prep Time (minutes)</label>
                                <input type="number" id="itemPrepTime" name="itemPrepTime" min="0" max="120" placeholder="15" class="mt-1 block w-full px-3 py-2 border border-gray-400 rounded-md shadow-sm sm:text-sm">
                            </div>
                        </div>

                        <!-- Dietary Tags -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">ðŸŒ± Dietary Information</label>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
                                <label class="inline-flex items-center text-sm">
                                    <input type="checkbox" id="dietary-vegetarian" name="dietary-vegetarian" class="h-4 w-4 text-green-600 border-gray-400 rounded focus:ring-green-500 accent-green-600">
                                    <span class="ml-2">ðŸ¥¬ Vegetarian</span>
                                </label>
                                <label class="inline-flex items-center text-sm">
                                    <input type="checkbox" id="dietary-vegan" name="dietary-vegan" class="h-4 w-4 text-green-600 border-gray-400 rounded focus:ring-green-500 accent-green-600">
                                    <span class="ml-2">ðŸŒ± Vegan</span>
                                </label>
                                <label class="inline-flex items-center text-sm">
                                    <input type="checkbox" id="dietary-gluten-free" name="dietary-gluten-free" class="h-4 w-4 text-green-600 border-gray-400 rounded focus:ring-green-500 accent-green-600">
                                    <span class="ml-2">ðŸŒ¾ Gluten-Free</span>
                                </label>
                                <label class="inline-flex items-center text-sm">
                                    <input type="checkbox" id="dietary-dairy-free" name="dietary-dairy-free" class="h-4 w-4 text-green-600 border-gray-400 rounded focus:ring-green-500 accent-green-600">
                                    <span class="ml-2">ðŸ¥› Dairy-Free</span>
                                </label>
                                <label class="inline-flex items-center text-sm">
                                    <input type="checkbox" id="dietary-spicy" name="dietary-spicy" class="h-4 w-4 text-red-600 border-gray-400 rounded focus:ring-red-500 accent-red-600">
                                    <span class="ml-2">ðŸŒ¶ï¸ Spicy</span>
                                </label>
                                <label class="inline-flex items-center text-sm">
                                    <input type="checkbox" id="dietary-popular" name="dietary-popular" class="h-4 w-4 text-yellow-600 border-gray-400 rounded focus:ring-yellow-500 accent-yellow-600">
                                    <span class="ml-2">â­ Popular</span>
                                </label>
                            </div>
                        </div>

                        <!-- Allergen Information -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">âš ï¸ Allergen Information</label>
                            <div class="grid grid-cols-2 md:grid-cols-3 gap-2">
                                <label class="inline-flex items-center text-sm">
                                    <input type="checkbox" id="allergen-nuts" name="allergen-nuts" class="h-4 w-4 text-orange-600 border-gray-400 rounded focus:ring-orange-500 accent-orange-600">
                                    <span class="ml-2">ðŸ¥œ Nuts</span>
                                </label>
                                <label class="inline-flex items-center text-sm">
                                    <input type="checkbox" id="allergen-dairy" name="allergen-dairy" class="h-4 w-4 text-orange-600 border-gray-400 rounded focus:ring-orange-500 accent-orange-600">
                                    <span class="ml-2">ðŸ¥› Dairy</span>
                                </label>
                                <label class="inline-flex items-center text-sm">
                                    <input type="checkbox" id="allergen-gluten" name="allergen-gluten" class="h-4 w-4 text-orange-600 border-gray-400 rounded focus:ring-orange-500 accent-orange-600">
                                    <span class="ml-2">ðŸŒ¾ Gluten</span>
                                </label>
                                <label class="inline-flex items-center text-sm">
                                    <input type="checkbox" id="allergen-seafood" name="allergen-seafood" class="h-4 w-4 text-orange-600 border-gray-400 rounded focus:ring-orange-500 accent-orange-600">
                                    <span class="ml-2">ðŸŸ Seafood</span>
                                </label>
                                <label class="inline-flex items-center text-sm">
                                    <input type="checkbox" id="allergen-eggs" name="allergen-eggs" class="h-4 w-4 text-orange-600 border-gray-400 rounded focus:ring-orange-500 accent-orange-600">
                                    <span class="ml-2">ðŸ¥š Eggs</span>
                                </label>
                                <label class="inline-flex items-center text-sm">
                                    <input type="checkbox" id="allergen-soy" name="allergen-soy" class="h-4 w-4 text-orange-600 border-gray-400 rounded focus:ring-orange-500 accent-orange-600">
                                    <span class="ml-2">ðŸ«˜ Soy</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-4">
                        <div class="flex items-center space-x-4"><div class="flex items-center"><input type="checkbox" id="itemHasOptionsModal" name="itemHasOptionsModal" onchange="toggleItemOptionsUIInModal()" class="h-4 w-4 text-black border-gray-400 rounded focus:ring-black accent-black"><label for="itemHasOptionsModal" class="ml-2 block text-sm text-gray-800">Has General Options</label></div></div>
                        <div id="itemOptionsModalContainer" class="hidden space-y-3 p-3 border border-gray-300 rounded-md bg-gray-50">
                            <label class="block text-sm font-medium text-gray-700">General Item Options:</label>
                            <div id="itemOptionsListDisplayModal" class="flex flex-wrap gap-2 mb-2 min-h-[40px] border border-gray-200 p-2 rounded-md bg-white"><p class="text-xs text-gray-500 italic w-full">No general options added</p></div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-2 items-end">
                                <div class="md:col-span-2"><label for="newOptionNameInputModal" class="block text-xs font-medium text-gray-600">Option Name</label><input type="text" id="newOptionNameInputModal" placeholder="e.g., Peppercorn Sauce" class="mt-1 w-full px-3 py-2 border border-gray-400 rounded-md shadow-sm sm:text-sm"></div>
                                <div><label for="newOptionPriceInputModal" class="block text-xs font-medium text-gray-600">Price Change (&euro;)</label><input type="number" step="0.01" id="newOptionPriceInputModal" placeholder="e.g., 2.00 or -0.50" inputmode="decimal" class="mt-1 w-full px-3 py-2 border border-gray-400 rounded-md shadow-sm sm:text-sm"></div>
                            </div>
                            <button type="button" onclick="addOptionToItemFormTempModal()" class="mt-2 px-4 py-2 btn-secondary text-sm w-full md:w-auto">Add Option</button>
                        </div>
                    </div>
                    <div class="flex gap-2 pt-4 border-t border-gray-200">
                        <button type="button" id="saveItemBtn" onclick="saveItem()" class="w-full py-2 px-4 btn-success">Save</button>
                        <button type="button" onclick="closeItemFormModal()" class="w-full py-2 px-4 btn-secondary">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Unlock Token Dialog -->
    <div id="unlockTokenDialog" class="fixed inset-0 bg-black bg-opacity-90 z-[110] hidden items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md">
            <!-- Dialog Header -->
            <div class="p-6 text-center border-b border-gray-200">
                <div class="text-4xl text-green-600 mb-3">
                    <i class="fas fa-key"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-900 mb-2">Activate Server License</h2>
                <p class="text-gray-600">Activate once for <strong>ALL devices</strong> on this server</p>
            </div>
            
            <!-- Dialog Content -->
            <div class="p-6">
                <form id="unlockTokenForm">
                    <div class="space-y-4">
                        <div>
                            <label for="unlockEmail" class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                            <input type="email" id="unlockEmail" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-600 focus:border-green-600 transition-colors"
                                   placeholder="your@email.com">
                        </div>
                        
                        <div>
                            <label for="unlockToken" class="block text-sm font-medium text-gray-700 mb-2">Unlock Token</label>
                            <input type="text" id="unlockToken" required maxlength="35"
                                   class="w-full px-4 py-4 border border-gray-300 rounded-lg uppercase focus:ring-2 focus:ring-green-600 focus:border-green-600 transition-colors text-lg"
                                   placeholder="POSPAL-XXXX-XXXX-XXXX-XXXX"
                                   style="font-family: 'Courier New', monospace !important; min-height: 60px; min-width: 400px; letter-spacing: 1px;">
                        </div>

                        <div>
                            <label for="unlockPassword" class="block text-sm font-medium text-gray-700 mb-2">
                                Management Password
                                <span class="text-xs text-gray-500">(default: 9999)</span>
                            </label>
                            <input type="password" id="unlockPassword" required
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-600 focus:border-green-600 transition-colors"
                                   placeholder="Enter management password">
                        </div>
                    </div>

                    <div id="unlockError" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mt-4 text-sm"></div>
                    
                    <div class="mt-6 space-y-3">
                        <button type="submit" id="unlockSubmitBtn"
                                class="w-full bg-green-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-green-700 transition-colors flex items-center justify-center">
                            <i class="fas fa-unlock mr-2"></i>
                            <span id="unlockBtnText">Activate for All Devices</span>
                        </button>
                        
                        <button type="button" onclick="hideUnlockDialog()" 
                                class="w-full bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors">
                            Cancel
                        </button>
                    </div>
                </form>
                
                <div class="mt-6 pt-4 border-t border-gray-200 text-center">
                    <p class="text-sm text-gray-600 mb-3">Don't have an unlock code yet?</p>
                    <div class="space-y-2">
                        <button onclick="hideUnlockDialog(); showEmbeddedPayment();"
                                class="block w-full text-green-600 hover:text-green-700 font-medium text-sm">
                            <i class="fas fa-credit-card mr-1"></i>
                            Subscribe for &euro;20/month
                        </button>
                        <button onclick="showLicenseRecoveryModal()" 
                                class="block w-full text-blue-600 hover:text-blue-700 font-medium text-sm">
                            <i class="fas fa-envelope mr-1"></i>
                            Forgot License Key? Resend to Email
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- License Key Recovery Modal -->
    <div id="licenseRecoveryModal" class="fixed inset-0 bg-black bg-opacity-90 z-[120] hidden items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-md">
            <!-- Modal Header -->
            <div class="p-6 text-center border-b border-gray-200">
                <div class="text-4xl text-blue-600 mb-3">
                    <i class="fas fa-envelope"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-900 mb-2">Recover License Key</h2>
                <p class="text-gray-600">Enter your email to receive your license key</p>
            </div>
            
            <!-- Modal Content -->
            <div class="p-6">
                <form id="licenseRecoveryForm">
                    <div class="space-y-4">
                        <div>
                            <label for="recoveryEmail" class="block text-sm font-medium text-gray-700 mb-2">Email Address</label>
                            <input type="email" id="recoveryEmail" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-600 focus:border-blue-600 transition-colors"
                                   placeholder="your@email.com">
                            <p class="mt-1 text-xs text-gray-500">We'll send your license key to this email address</p>
                        </div>
                    </div>
                    
                    <!-- Messages -->
                    <div id="recoveryError" class="hidden bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg mt-4 text-sm"></div>
                    <div id="recoverySuccess" class="hidden bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg mt-4 text-sm"></div>
                    <div id="recoveryWarning" class="hidden bg-yellow-50 border border-yellow-200 text-yellow-700 px-4 py-3 rounded-lg mt-4 text-sm"></div>
                    
                    <!-- Buttons -->
                    <div class="mt-6 space-y-3">
                        <button type="submit" id="recoverySubmitBtn" 
                                class="w-full bg-blue-600 text-white py-3 px-4 rounded-lg font-semibold hover:bg-blue-700 transition-colors flex items-center justify-center">
                            <i class="fas fa-paper-plane mr-2"></i>
                            <span id="recoveryBtnText">Send License Key</span>
                        </button>
                        
                        <button type="button" onclick="hideLicenseRecoveryModal()" 
                                class="w-full bg-gray-300 text-gray-700 py-2 px-4 rounded-lg hover:bg-gray-400 transition-colors">
                            Cancel
                        </button>
                    </div>
                </form>
                
                <!-- Help Text -->
                <div class="mt-6 pt-4 border-t border-gray-200 text-center">
                    <p class="text-xs text-gray-500">
                        If you don't receive the email within 5 minutes, check your spam folder or 
                        <a href="#" onclick="contactSupport()" class="text-blue-600 hover:underline">contact support</a>.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Day Summary Modal -->
    <div id="daySummaryModal" class="fixed inset-0 bg-black bg-opacity-70 z-[80] hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md flex flex-col text-gray-800">
            <div class="p-4 border-b border-gray-300 flex justify-between items-center"><h2 class="text-xl font-semibold" data-i18n="ui.daySummary.title">Day Summary</h2><button onclick="closeDaySummaryModal()" class="text-gray-500 hover:text-black"><i class="fas fa-times text-2xl"></i></button></div>
            <div id="daySummaryContent" class="p-6 space-y-4"><p class="text-center italic" data-i18n="ui.daySummary.loading">Loading summary...</p></div>
        </div>
    </div>

    <!-- Subscription Modal -->
    <!-- Subscription Modal - Stacked Card Design -->
    <div id="subscriptionModal" class="fixed inset-0 bg-black bg-opacity-90 z-[110] hidden items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-[520px] max-h-[90vh] overflow-hidden flex flex-col">
            <!-- Modal Header -->
            <div class="relative bg-gradient-to-br from-green-600 to-green-500 p-6 text-white">
                <!-- Close Button -->
                <button onclick="closeSubscriptionModal()"
                        class="absolute top-4 right-4 text-white hover:text-gray-200 transition-colors p-2 rounded-full hover:bg-white/10">
                    <i class="fas fa-times text-xl"></i>
                </button>

                <div class="flex items-center gap-3 mb-2">
                    <div class="w-12 h-12 bg-white bg-opacity-20 rounded-xl flex items-center justify-center">
                        <i class="fas fa-unlock text-white text-2xl"></i>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold">POSPal Professional</h2>
                        <p class="text-green-50 text-sm">Subscribe to unlock all features</p>
                    </div>
                </div>
            </div>

            <!-- Modal Content - Scrollable -->
            <div class="overflow-y-auto flex-1">
                <div class="p-6">
                    <!-- Subscription Form -->
                    <form id="subscriptionForm" class="space-y-4">
                        <!-- Restaurant Name -->
                        <div>
                            <label for="sub-restaurant-name" class="block text-sm font-semibold text-gray-700 mb-1.5">
                                Restaurant Name <span class="text-red-500">*</span>
                            </label>
                            <input type="text"
                                   id="sub-restaurant-name"
                                   required
                                   class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 transition-all outline-none"
                                   placeholder="e.g., The Golden Fork">
                        </div>

                        <!-- Customer Name -->
                        <div>
                            <label for="sub-customer-name" class="block text-sm font-semibold text-gray-700 mb-1.5">
                                Your Name <span class="text-red-500">*</span>
                            </label>
                            <input type="text"
                                   id="sub-customer-name"
                                   required
                                   class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all outline-none"
                                   placeholder="John Smith">
                        </div>

                        <!-- Email Address -->
                        <div>
                            <label for="sub-customer-email" class="block text-sm font-semibold text-gray-700 mb-1.5">
                                Email Address <span class="text-red-500">*</span>
                            </label>
                            <input type="email"
                                   id="sub-customer-email"
                                   required
                                   class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all outline-none"
                                   placeholder="your@email.com">

                            <!-- Duplicate validation messages (preserved from original) -->
                            <div id="email-validation-loading" class="hidden mt-2 text-sm text-gray-600 flex items-center">
                                <i class="fas fa-spinner fa-spin mr-2"></i>
                                Checking email...
                            </div>
                            <div id="email-duplicate-active" class="hidden mt-2 p-3 bg-blue-50 border-l-4 border-blue-500 text-blue-800 text-sm rounded-lg flex items-start gap-2">
                                <i class="fas fa-info-circle mt-0.5 flex-shrink-0"></i>
                                <span>You already have an active subscription. <a href="#" id="redirect-to-portal" class="underline font-semibold hover:text-blue-900">Manage your subscription here</a>.</span>
                            </div>
                            <div id="email-duplicate-returning" class="hidden mt-2 p-3 bg-green-50 border-l-4 border-green-500 text-green-800 text-sm rounded-lg flex items-start gap-2">
                                <i class="fas fa-check-circle mt-0.5 flex-shrink-0"></i>
                                <span>Welcome back! You can resubscribe to continue using POSPal.</span>
                            </div>
                            <div id="email-validation-error" class="hidden mt-2 p-3 bg-yellow-50 border-l-4 border-yellow-400 text-yellow-800 text-sm rounded-lg flex items-start gap-2">
                                <i class="fas fa-exclamation-triangle mt-0.5 flex-shrink-0"></i>
                                <span>Unable to validate email. You can still proceed with subscription.</span>
                            </div>
                            <div id="email-validation-success" class="hidden mt-2 p-3 bg-green-50 border-l-4 border-green-500 text-green-800 text-sm rounded-lg flex items-start gap-2">
                                <i class="fas fa-check-circle mt-0.5 flex-shrink-0"></i>
                                <span>Email is available for new subscription.</span>
                            </div>
                        </div>

                        <!-- Phone Number -->
                        <div>
                            <label for="sub-customer-phone" class="block text-sm font-semibold text-gray-700 mb-1.5">
                                Phone Number <span class="text-gray-400 text-xs font-normal">(Optional)</span>
                            </label>
                            <input type="tel"
                                   id="sub-customer-phone"
                                   class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 transition-all outline-none"
                                   placeholder="+30 123 456 7890">
                        </div>

                        <!-- Error & Loading Messages -->
                        <div id="subscription-error" class="hidden bg-red-50 border-l-4 border-red-500 text-red-700 px-4 py-3 rounded-lg text-sm flex items-start gap-2">
                            <i class="fas fa-exclamation-circle mt-0.5 flex-shrink-0"></i>
                            <span id="subscription-error-text"></span>
                        </div>

                        <div id="subscription-loading" class="hidden text-center text-gray-600 py-3 text-sm">
                            <i class="fas fa-spinner fa-spin mr-2"></i>
                            Creating secure checkout session...
                        </div>

                        <!-- Submit Button with Price -->
                        <div class="pt-2">
                            <button type="submit"
                                    class="w-full bg-gradient-to-r from-green-600 to-green-500 text-white py-4 px-6 rounded-xl font-bold text-lg hover:from-green-700 hover:to-green-600 transition-all shadow-lg hover:shadow-xl transform hover:scale-[1.02] active:scale-[0.98]">
                                <div class="flex items-center justify-center gap-2">
                                    <i class="fas fa-lock text-sm"></i>
                                    <span>Subscribe for &euro;20/month</span>
                                </div>
                            </button>
                            <p class="text-center text-xs text-gray-500 mt-2">
                                Secure payment via Stripe ï¿½&euro;ï¿½ Cancel anytime
                            </p>
                        </div>
                    </form>

                    <!-- Features Section -->
                    <div class="mt-6 pt-6 border-t border-gray-200">
                        <h3 class="text-sm font-semibold text-gray-700 mb-3 uppercase tracking-wide">What's Included</h3>
                        <div class="grid grid-cols-1 gap-2.5">
                            <div class="flex items-center gap-3 text-gray-700">
                                <div class="w-6 h-6 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0">
                                    <i class="fas fa-check text-green-600 text-xs"></i>
                                </div>
                                <span class="text-sm">Unlimited tables & orders</span>
                            </div>
                            <div class="flex items-center gap-3 text-gray-700">
                                <div class="w-6 h-6 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0">
                                    <i class="fas fa-check text-green-600 text-xs"></i>
                                </div>
                                <span class="text-sm">Kitchen printing & order management</span>
                            </div>
                            <div class="flex items-center gap-3 text-gray-700">
                                <div class="w-6 h-6 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0">
                                    <i class="fas fa-check text-green-600 text-xs"></i>
                                </div>
                                <span class="text-sm">Offline operation (no internet required)</span>
                            </div>
                            <div class="flex items-center gap-3 text-gray-700">
                                <div class="w-6 h-6 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0">
                                    <i class="fas fa-check text-green-600 text-xs"></i>
                                </div>
                                <span class="text-sm">Priority email support</span>
                            </div>
                            <div class="flex items-center gap-3 text-gray-700">
                                <div class="w-6 h-6 rounded-full bg-green-100 flex items-center justify-center flex-shrink-0">
                                    <i class="fas fa-check text-green-600 text-xs"></i>
                                </div>
                                <span class="text-sm">Cancel anytime, no commitment</span>
                            </div>
                        </div>
                    </div>

                    <!-- Trust Badges -->
                    <div class="mt-6 pt-6 border-t border-gray-200 text-center">
                        <div class="flex items-center justify-center gap-2 text-gray-500 text-sm">
                            <i class="fab fa-stripe text-2xl text-blue-600"></i>
                            <span class="text-xs">Secured by Stripe</span>
                        </div>
                        <div class="mt-2 flex items-center justify-center gap-3 text-gray-400 text-xs">
                            <span class="flex items-center gap-1">
                                <i class="fas fa-shield-alt"></i>
                                SSL Encrypted
                            </span>
                            <span>ï¿½&euro;ï¿½</span>
                            <span class="flex items-center gap-1">
                                <i class="fas fa-credit-card"></i>
                                All cards accepted
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Disconnect License Warning Modal -->
    <div id="disconnectLicenseModal" class="fixed inset-0 bg-black bg-opacity-70 z-[90] hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md flex flex-col text-gray-800">
            <div class="p-4 border-b border-gray-300 flex justify-between items-center">
                <h2 class="text-xl font-semibold text-red-600 flex items-center">
                    <i class="fas fa-exclamation-triangle mr-2"></i>
                    Disconnect License?
                </h2>
                <button onclick="closeDisconnectLicenseModal()" class="text-gray-500 hover:text-black">
                    <i class="fas fa-times text-2xl"></i>
                </button>
            </div>

            <div class="p-6 space-y-4 max-h-[70vh] overflow-y-auto">
                <!-- Warning Section -->
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                    <p class="text-sm text-gray-700 mb-3">
                        This will deactivate POSPal on this device. You'll be able to activate it on another computer.
                    </p>

                    <div class="space-y-2 text-sm">
                        <p class="font-semibold text-red-600">âš ï¸ This action will:</p>
                        <ul class="list-disc list-inside text-gray-700 space-y-1 ml-2">
                            <li>End your current session</li>
                            <li>Clear all license data from this device</li>
                            <li>Remove local cached credentials</li>
                        </ul>
                    </div>
                </div>

                <!-- Reassurance Section -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <p class="font-semibold text-blue-800 mb-2">â„¹ï¸ Your subscription remains active:</p>
                    <ul class="list-disc list-inside text-sm text-blue-700 space-y-1 ml-2">
                        <li>No data loss on cloud/server</li>
                        <li>Menu items preserved</li>
                        <li>Order history preserved</li>
                        <li>Can re-activate on any device</li>
                    </ul>
                </div>

                <!-- Device Info -->
                <div class="bg-gray-50 rounded-lg p-3">
                    <p class="text-xs text-gray-500 mb-1">Current License:</p>
                    <p class="text-sm font-mono text-gray-800" id="disconnect-modal-email">Loading...</p>
                    <p class="text-xs text-gray-500 mt-2">Device:</p>
                    <p class="text-sm font-mono text-gray-800" id="disconnect-modal-device">Loading...</p>
                </div>

                <!-- Confirmation Checkbox -->
                <label class="flex items-start cursor-pointer">
                    <input type="checkbox" id="disconnect-confirm-checkbox"
                           class="mt-1 mr-3 h-4 w-4 rounded border-gray-300">
                    <span class="text-sm text-gray-700">
                        I understand this will disconnect POSPal from this device
                    </span>
                </label>
            </div>

            <div class="p-4 border-t border-gray-200 flex gap-2">
                <button onclick="closeDisconnectLicenseModal()" class="flex-1 py-2 px-4 btn-secondary">
                    Cancel
                </button>
                <button id="confirm-disconnect-btn"
                        onclick="confirmDisconnectLicense()"
                        disabled
                        class="flex-1 py-2 px-4 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed">
                    Disconnect License
                </button>
            </div>
        </div>
    </div>

    <!-- Disconnect Success Modal -->
    <div id="disconnectSuccessModal" class="fixed inset-0 bg-black bg-opacity-70 z-[90] hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md flex flex-col text-gray-800">
            <div class="p-4 border-b border-gray-300">
                <h2 class="text-xl font-semibold text-green-600 flex items-center">
                    <i class="fas fa-check-circle mr-2"></i>
                    License Disconnected Successfully
                </h2>
            </div>

            <div class="p-6 space-y-4">
                <p class="text-gray-700">
                    Your license has been removed from this device.
                </p>

                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <p class="font-semibold text-blue-800 mb-2">Next Steps:</p>
                    <ol class="list-decimal list-inside text-sm text-blue-700 space-y-1 ml-2">
                        <li>POSPal will restart in trial mode</li>
                        <li>To use on another device, install POSPal there</li>
                        <li>Enter your email and unlock token</li>
                    </ol>
                </div>

                <div class="bg-gray-50 rounded-lg p-3">
                    <p class="text-xs text-gray-500 mb-1">Your Unlock Token:</p>
                    <div class="flex items-center gap-2">
                        <code id="disconnect-unlock-token" class="flex-1 text-sm font-mono bg-white px-2 py-1 rounded border">
                            Loading...
                        </code>
                        <button onclick="copyDisconnectToken()" class="btn-secondary py-1 px-2 text-xs">
                            <i class="far fa-copy mr-1"></i>Copy
                        </button>
                    </div>
                </div>

                <div class="text-center">
                    <p class="text-sm text-gray-600 mb-3">
                        POSPal will restart in <span id="restart-countdown">30</span> seconds...
                    </p>
                </div>
            </div>

            <div class="p-4 border-t border-gray-200">
                <button onclick="restartAppNow()" class="w-full py-2 px-4 btn-primary">
                    Close & Restart Now
                </button>
            </div>
        </div>
    </div>

    <!-- Print Confirmation Modal (Phase 6: Multi-device printer redesign) -->
    <div id="printConfirmModal" class="fixed inset-0 bg-black bg-opacity-70 z-[90] hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md flex flex-col text-gray-800">
            <div class="p-4 border-b border-gray-200">
                <h2 class="text-lg font-semibold text-gray-800 flex items-center">
                    <i class="fas fa-print mr-2 text-blue-600"></i>
                    Print this order?
                </h2>
            </div>

            <div class="p-6">
                <p class="text-gray-700 mb-4">
                    Do you want to print this order to the kitchen?
                </p>

                <div class="bg-gray-50 rounded-lg p-4 text-sm">
                    <div class="flex justify-between mb-2">
                        <span class="text-gray-600">Table:</span>
                        <span id="printConfirmTable" class="font-medium text-gray-900">-</span>
                    </div>
                    <div class="flex justify-between mb-2">
                        <span class="text-gray-600">Items:</span>
                        <span id="printConfirmItems" class="font-medium text-gray-900">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">Total:</span>
                        <span id="printConfirmTotal" class="font-medium text-gray-900">-</span>
                    </div>
                </div>

                <div class="mt-4 p-3 bg-blue-50 border border-blue-200 rounded text-xs text-blue-800">
                    <i class="fas fa-info-circle mr-1"></i>
                    <strong>Tip:</strong> You can change this behavior in Settings â†’ This Device Settings â†’ Print Behavior
                </div>
            </div>

            <div class="p-4 border-t border-gray-200 flex gap-2">
                <button onclick="printConfirmNo()" class="flex-1 py-2 px-4 btn-secondary">
                    <i class="fas fa-times mr-1"></i>No, Skip Print
                </button>
                <button onclick="printConfirmYes()" class="flex-1 py-2 px-4 btn-primary">
                    <i class="fas fa-check mr-1"></i>Yes, Print
                </button>
            </div>
        </div>
    </div>

    <div id="offlineStatusStrip" class="offline-status-strip" style="display:none;">
        <span class="badge" data-i18n="ui.offlineStatusStrip.offline">Offline</span>
        <span class="text-sm" id="offlineStatusMessage"></span>
        <button id="offlineStripRetryButton" class="retry-btn" type="button">
            <i class="fas fa-sync-alt"></i>
            <span data-i18n="ui.offlineStatusStrip.retry">Retry</span>
        </button>
        <span id="offlineStripCountdown" class="text-xs text-slate-300"></span>
        <span id="offlineStripHelpLink" class="help-link" data-i18n="ui.offlineStatusStrip.help">Troubleshoot</span>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const managementModal = document.getElementById('managementModal');
            if (!managementModal) return;

            const modalIds = [
                'tablesModal',
                'splitBillModal',
                'paymentMethodModal',
                'addTableModal',
                'editTableModal',
                'itemFormModal',
                'unlockTokenDialog',
                'licenseRecoveryModal',
                'daySummaryModal',
                'subscriptionModal',
                'disconnectLicenseModal',
                'disconnectSuccessModal',
                'printConfirmModal'
            ];

            modalIds.forEach((id) => {
                const modal = document.getElementById(id);
                if (modal && managementModal.contains(modal)) {
                    document.body.appendChild(modal);
                }
            });
        });
    </script>

    <script src="./static/js/qrcode.min.js" defer></script>
    <script src="i18n.js" defer></script>
    <script src="/assets/desktop-support.js" defer></script>
    <script src="pospalCore.js" defer></script>
</body>
</html>









